<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>springboot | 蒙大拿</title>
    <meta name="generator" content="VuePress 1.9.5">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script charset="utf-8" src="https://my.openwrite.cn/js/readmore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <meta name="description" content="蒙大拿的博客">
    
    <link rel="preload" href="/mengqizhang/assets/css/0.styles.a1d09170.css" as="style"><link rel="preload" href="/mengqizhang/assets/js/app.a8d21a83.js" as="script"><link rel="preload" href="/mengqizhang/assets/js/2.e69c46bd.js" as="script"><link rel="preload" href="/mengqizhang/assets/js/17.8a25e983.js" as="script"><link rel="prefetch" href="/mengqizhang/assets/js/10.11174a82.js"><link rel="prefetch" href="/mengqizhang/assets/js/100.bd6553c3.js"><link rel="prefetch" href="/mengqizhang/assets/js/101.ac07962b.js"><link rel="prefetch" href="/mengqizhang/assets/js/102.79bec0af.js"><link rel="prefetch" href="/mengqizhang/assets/js/103.0c0a0808.js"><link rel="prefetch" href="/mengqizhang/assets/js/104.3ed6d392.js"><link rel="prefetch" href="/mengqizhang/assets/js/105.be22e8c8.js"><link rel="prefetch" href="/mengqizhang/assets/js/106.efa39ac4.js"><link rel="prefetch" href="/mengqizhang/assets/js/107.545ffb45.js"><link rel="prefetch" href="/mengqizhang/assets/js/108.cf23c097.js"><link rel="prefetch" href="/mengqizhang/assets/js/109.3339ffad.js"><link rel="prefetch" href="/mengqizhang/assets/js/11.08defbae.js"><link rel="prefetch" href="/mengqizhang/assets/js/110.bafd2f00.js"><link rel="prefetch" href="/mengqizhang/assets/js/12.25a3365c.js"><link rel="prefetch" href="/mengqizhang/assets/js/13.9b88bf7d.js"><link rel="prefetch" href="/mengqizhang/assets/js/14.c4d7ed3a.js"><link rel="prefetch" href="/mengqizhang/assets/js/15.b407b696.js"><link rel="prefetch" href="/mengqizhang/assets/js/16.1c08698a.js"><link rel="prefetch" href="/mengqizhang/assets/js/18.e34bf6a6.js"><link rel="prefetch" href="/mengqizhang/assets/js/19.68d7669f.js"><link rel="prefetch" href="/mengqizhang/assets/js/20.de14558d.js"><link rel="prefetch" href="/mengqizhang/assets/js/21.56869e5e.js"><link rel="prefetch" href="/mengqizhang/assets/js/22.aea26c9b.js"><link rel="prefetch" href="/mengqizhang/assets/js/23.4a0b2ea3.js"><link rel="prefetch" href="/mengqizhang/assets/js/24.58c270f0.js"><link rel="prefetch" href="/mengqizhang/assets/js/25.413aed44.js"><link rel="prefetch" href="/mengqizhang/assets/js/26.5ebfde8b.js"><link rel="prefetch" href="/mengqizhang/assets/js/27.48dd442a.js"><link rel="prefetch" href="/mengqizhang/assets/js/28.d2afcf03.js"><link rel="prefetch" href="/mengqizhang/assets/js/29.b928e199.js"><link rel="prefetch" href="/mengqizhang/assets/js/3.7aafc190.js"><link rel="prefetch" href="/mengqizhang/assets/js/30.4c1cbe1a.js"><link rel="prefetch" href="/mengqizhang/assets/js/31.77073e2d.js"><link rel="prefetch" href="/mengqizhang/assets/js/32.5f66f7a2.js"><link rel="prefetch" href="/mengqizhang/assets/js/33.a8272e84.js"><link rel="prefetch" href="/mengqizhang/assets/js/34.3b8ea135.js"><link rel="prefetch" href="/mengqizhang/assets/js/35.100b34a0.js"><link rel="prefetch" href="/mengqizhang/assets/js/36.06cb633d.js"><link rel="prefetch" href="/mengqizhang/assets/js/37.f3d4b763.js"><link rel="prefetch" href="/mengqizhang/assets/js/38.733d311d.js"><link rel="prefetch" href="/mengqizhang/assets/js/39.8434909a.js"><link rel="prefetch" href="/mengqizhang/assets/js/4.000c3dbd.js"><link rel="prefetch" href="/mengqizhang/assets/js/40.dd341745.js"><link rel="prefetch" href="/mengqizhang/assets/js/41.1fcf309c.js"><link rel="prefetch" href="/mengqizhang/assets/js/42.1cc69bad.js"><link rel="prefetch" href="/mengqizhang/assets/js/43.fefa3ac7.js"><link rel="prefetch" href="/mengqizhang/assets/js/44.d284f8c1.js"><link rel="prefetch" href="/mengqizhang/assets/js/45.2564339d.js"><link rel="prefetch" href="/mengqizhang/assets/js/46.23627a8c.js"><link rel="prefetch" href="/mengqizhang/assets/js/47.cecbf290.js"><link rel="prefetch" href="/mengqizhang/assets/js/48.bad75ece.js"><link rel="prefetch" href="/mengqizhang/assets/js/49.2fa60a3e.js"><link rel="prefetch" href="/mengqizhang/assets/js/5.9832e234.js"><link rel="prefetch" href="/mengqizhang/assets/js/50.f3159852.js"><link rel="prefetch" href="/mengqizhang/assets/js/51.738bce4a.js"><link rel="prefetch" href="/mengqizhang/assets/js/52.efc0fa7e.js"><link rel="prefetch" href="/mengqizhang/assets/js/53.8d0c00f1.js"><link rel="prefetch" href="/mengqizhang/assets/js/54.a519e682.js"><link rel="prefetch" href="/mengqizhang/assets/js/55.9652e586.js"><link rel="prefetch" href="/mengqizhang/assets/js/56.c88f759b.js"><link rel="prefetch" href="/mengqizhang/assets/js/57.c6f3cd20.js"><link rel="prefetch" href="/mengqizhang/assets/js/58.0c040aca.js"><link rel="prefetch" href="/mengqizhang/assets/js/59.fc5ce388.js"><link rel="prefetch" href="/mengqizhang/assets/js/6.48810bdc.js"><link rel="prefetch" href="/mengqizhang/assets/js/60.a50c0285.js"><link rel="prefetch" href="/mengqizhang/assets/js/61.ab6648f5.js"><link rel="prefetch" href="/mengqizhang/assets/js/62.f589c0b8.js"><link rel="prefetch" href="/mengqizhang/assets/js/63.df4a0587.js"><link rel="prefetch" href="/mengqizhang/assets/js/64.e5f1a0d6.js"><link rel="prefetch" href="/mengqizhang/assets/js/65.94e94ec2.js"><link rel="prefetch" href="/mengqizhang/assets/js/66.9a0f92dc.js"><link rel="prefetch" href="/mengqizhang/assets/js/67.15d5b718.js"><link rel="prefetch" href="/mengqizhang/assets/js/68.ca0d798d.js"><link rel="prefetch" href="/mengqizhang/assets/js/69.4de863fa.js"><link rel="prefetch" href="/mengqizhang/assets/js/7.2f8cbddd.js"><link rel="prefetch" href="/mengqizhang/assets/js/70.7c1bcd59.js"><link rel="prefetch" href="/mengqizhang/assets/js/71.70f3e9ec.js"><link rel="prefetch" href="/mengqizhang/assets/js/72.ca361407.js"><link rel="prefetch" href="/mengqizhang/assets/js/73.95c0b000.js"><link rel="prefetch" href="/mengqizhang/assets/js/74.673e240c.js"><link rel="prefetch" href="/mengqizhang/assets/js/75.f5cf8815.js"><link rel="prefetch" href="/mengqizhang/assets/js/76.30b8a8fb.js"><link rel="prefetch" href="/mengqizhang/assets/js/77.0bdfd82b.js"><link rel="prefetch" href="/mengqizhang/assets/js/78.a21a9dee.js"><link rel="prefetch" href="/mengqizhang/assets/js/79.5c55aff9.js"><link rel="prefetch" href="/mengqizhang/assets/js/8.507fce61.js"><link rel="prefetch" href="/mengqizhang/assets/js/80.aa70b0e8.js"><link rel="prefetch" href="/mengqizhang/assets/js/81.1cb55142.js"><link rel="prefetch" href="/mengqizhang/assets/js/82.50b720b1.js"><link rel="prefetch" href="/mengqizhang/assets/js/83.85834849.js"><link rel="prefetch" href="/mengqizhang/assets/js/84.e2f1cab8.js"><link rel="prefetch" href="/mengqizhang/assets/js/85.c154565c.js"><link rel="prefetch" href="/mengqizhang/assets/js/86.c5dbbd95.js"><link rel="prefetch" href="/mengqizhang/assets/js/87.2b62cc5e.js"><link rel="prefetch" href="/mengqizhang/assets/js/88.5deb957d.js"><link rel="prefetch" href="/mengqizhang/assets/js/89.fbed7b0f.js"><link rel="prefetch" href="/mengqizhang/assets/js/9.70c1c418.js"><link rel="prefetch" href="/mengqizhang/assets/js/90.8efb35d5.js"><link rel="prefetch" href="/mengqizhang/assets/js/91.a3da2ba6.js"><link rel="prefetch" href="/mengqizhang/assets/js/92.1f9bf6c0.js"><link rel="prefetch" href="/mengqizhang/assets/js/93.862f4101.js"><link rel="prefetch" href="/mengqizhang/assets/js/94.1a0c5762.js"><link rel="prefetch" href="/mengqizhang/assets/js/95.6df0f77b.js"><link rel="prefetch" href="/mengqizhang/assets/js/96.90bef310.js"><link rel="prefetch" href="/mengqizhang/assets/js/97.fa2b5f10.js"><link rel="prefetch" href="/mengqizhang/assets/js/98.d84c6b84.js"><link rel="prefetch" href="/mengqizhang/assets/js/99.785b4a31.js">
    <link rel="stylesheet" href="/mengqizhang/assets/css/0.styles.a1d09170.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mengqizhang/" class="home-link router-link-active"><!----> <span class="site-name">蒙大拿</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mengqizhang/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://gitee.com/DemoMeng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mengqizhang/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://gitee.com/DemoMeng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试 📖🔥🔥</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/环境配置/" class="sidebar-heading clickable"><span>环境配置 🔧</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/消息队列/" class="sidebar-heading clickable"><span>消息队列 🔥🔥🔥</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/数据层/" class="sidebar-heading clickable"><span>数据层 🔥🔥🔥</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/容器化/" class="sidebar-heading clickable"><span>容器化 🐳</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java ☕️</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mengqizhang/java/" aria-current="page" class="sidebar-link">Java</a></li><li><a href="/mengqizhang/java/jvm/jvm.html" class="sidebar-link">JVM</a></li><li><a href="/mengqizhang/java/springboot/" aria-current="page" class="active sidebar-link">springboot</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mengqizhang/java/springboot/#springboot" class="sidebar-link">springboot</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/java/springboot/#spring-boot执行流程" class="sidebar-link">Spring boot执行流程</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/java/springboot/#spring和springboot的区别" class="sidebar-link">spring和springboot的区别</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/java/springboot/#springboot中的logback" class="sidebar-link">springboot中的logback</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/java/springboot/#springboot-mdc-全链路调用日志追踪" class="sidebar-link">springboot + MDC 全链路调用日志追踪</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/java/springboot/#事务不生效的场景" class="sidebar-link">事务不生效的场景</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/java/springboot/#异步任务调度" class="sidebar-link">异步任务调度</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/java/springboot/#springboot常用注解" class="sidebar-link">SpringBoot常用注解</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/java/springboot/#接口幂等性" class="sidebar-link">接口幂等性</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/java/springboot/#springboot项目中的日期问题" class="sidebar-link">springBoot项目中的日期问题</a></li></ul></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>多线程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/mengqizhang/java/集合/" class="sidebar-heading clickable"><span>java集合</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式事务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式系统 ☁️</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webSocket</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ELK 🔍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx 🇷🇺</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>jenkins 👴</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器 💰</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>测试 😓</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>监控告警</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="springboot"><a href="#springboot" class="header-anchor">#</a> springboot</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>#### 简介
    springboot是基于spring+java+web容器，微服务框架的杰出代表。微服务其实就是将服务粒度做小，使之可以独立承担对外服务的的职责。

##### 特征
    * 遵循“约定胜于配置”的原则，使用spring boot只需要很少的配置，大部分时候可以使用默认配置 （spring组件代码是轻量级的，但是xml配置确实重量级的）
    * 开箱即用、项目快速搭建，可以配置整合第三方框架
    * 可完全不使用xml配置，借助java config
    * 内嵌Servlet（如 Tomcat）容器，可以jar包运行
    * 运行中的应用状态监控、安全、指标、健康检测

##### 核心功能
    * 起步依赖： spring-boot-starter-web
    * 自动配置： 约定胜于配置，springboot默认配置
    
#####  微服务优势

    *	独立性。每个微服务都是一个独立的项目。可以独立对外提供服务，可以将研发人力资源很好的分摊，避免人力资源密集带来的沟通、协作成本。（低耦合原则）
    *	稳定性。任何一个微服务的失败都将只影响自己或少量其他微服务，不会影响整个服务运行体系。


1.定时任务器、调度 ：  Quartz
2.AOP、IOC
3.事务的传播性
    A方法里面调用了B方法导致事务不生效，可以使用当前类调用B方法，并且当前的类需要注册到springBean管理容器中，原因事务是由spring容器管理的。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="spring-boot执行流程"><a href="#spring-boot执行流程" class="header-anchor">#</a> Spring boot执行流程</h2> <ul><li><ol><li>springboot 源码</li></ol></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>public ConfigurableApplicationContext run(String... args) {
        // 创建 StopWatch 用于统计程序启动耗时
        StopWatch stopWatch = new StopWatch();
        stopWatch.start();
        // 创建配置上下文对象
        ConfigurableApplicationContext context = null;
        Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = new ArrayList&lt;&gt;();
        configureHeadlessProperty();
        // 开启一个监听器
        SpringApplicationRunListeners listeners = getRunListeners(args);
        listeners.starting();
        try {
        
            // 创建默认配置项
            ApplicationArguments applicationArguments = new DefaultApplicationArguments(
                    args);
            // 将默认配置项放到全局配置变量中        
            ConfigurableEnvironment environment = prepareEnvironment(listeners,
                    applicationArguments);
            configureIgnoreBeanInfo(environment);
            // 设置启动 banner 图片
            Banner printedBanner = printBanner(environment);
            // 创建 ApplicationContext 上下文对象
            context = createApplicationContext();
            exceptionReporters = getSpringFactoriesInstances(
                    SpringBootExceptionReporter.class,
                    new Class[] { ConfigurableApplicationContext.class }, context);
            // 准备上下文对象，默认配置项，监听事件，环境变量，banner图片
            // 加载 application.yml配置文件： 		postProcessApplicationContext(context); // 使用 Resouce加载application.yml 配置文件
            // 调用 ApplicationContextInitializer.initialize() 对applicationContext上下文进行初始化
            // beanFactory.registerSingleton(&quot;springApplicationArguments&quot;, applicationArguments); // 添加需要特定单例模式的bean
            prepareContext(context, environment, listeners, applicationArguments,
                    printedBanner);
            refreshContext(context);
            afterRefresh(context, applicationArguments);
            stopWatch.stop();
            if (this.logStartupInfo) {
                new StartupInfoLogger(this.mainApplicationClass)
                        .logStarted(getApplicationLog(), stopWatch);
            }
            listeners.started(context);
            callRunners(context, applicationArguments);
        }
        catch (Throwable ex) {
            handleRunFailure(context, ex, exceptionReporters, listeners);
            throw new IllegalStateException(ex);
        }
       
        try {
            listeners.running(context);
        }
        catch (Throwable ex) {
            handleRunFailure(context, ex, exceptionReporters, null);
            throw new IllegalStateException(ex);
        }
        return context;
}



</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><p>-2 主要的启动步骤</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. 准备阶段：初始化阶段，会创建 SpringBoot的 ApplicationContext，并且加载应用程序的初始化配置信息
2. 应用上下文 ApplicationContext 创建阶段：根据自动装配配置，Resource 加载 application.yml 的配置文件信息，配置各种组件和 需要特定单例模式的bean
3. 刷新上下文阶段：创建web容器、执行启动任务开启监听器、初始化器
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="spring和springboot的区别"><a href="#spring和springboot的区别" class="header-anchor">#</a> spring和springboot的区别</h2> <ul><li>spring解决了什么问题 ？ spring这里指的是SSM中的那套框架</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>解决的问题；（优点）
    1. spring是Java企业版本（Java Enterprise Edition JEE也叫J2EE）的轻量级替代品。
    2. spring无需开发重量级的EnterpriseJavaBean （EJB），提供了一套简单的方法。
    3. 通过DI、IOC 和 AOP（面向切面编程）用简单的java对象实现了EJB的功能。
    
    1. spring的IOC容器，把对象之间的依赖关系交给spring管理，降低了服务之间的耦合性，让开发者更多的关注服务的具体业务逻辑。
    2. spring提供了 事务滚利、WS（webService）
    3. spring的AOP面向切面编程
    4. 对主流框架有比较好的支持：mybatis、hibernate、struts，jpa等
    5. spring的DI降低业务对象替换的复杂性
    6. spring侵入性小、代码污染少
    
未解决的问题：
    1. 繁杂的XML配置：
    2. 项目依赖管理： 依赖库的版本冲突一直是一个大问题、版本兼容性问题
    3. spring不支持分布式
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="springboot中的logback"><a href="#springboot中的logback" class="header-anchor">#</a> springboot中的logback</h2> <ul><li>日志框架、日志门面</li> <li>项目： https://gitee.com/DemoMeng/better-skills/a-logback</li> <li>JUL、JCL、Log4j、Slf4j、Logback、Log4j2</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>日志框架：
  JUL： Java Util Log： java官方提供的log lib，但是使用不够广泛-原因： 
                            1 开发出的时间晚（2002年）第三方log lib广泛 、 
                            2 性能问题不如Logback/Log4j、
                            3 功能不够丰富比如默认没有从classpath加载文件
                            
  Log4j： Apache的一个开源项目、创始人：Ceki Gulcu。 java领域的元老项目。高度可配置、并通过运行时外部文件配置。
           它根据记录的优先级别，并提供机制，以指示记录信息到许多的目的地，诸如：数据库，文件，控制台，UNIX 系统日志等
           三个主要组成部分： 
                loggers： 负责捕获记录信息
                appenders： 负责发布日志信息、以不同的首选目的地
                layouts： 负责格式化不同风格的日志信息
           缺点： 性能低，在logback出来之后，log4j使用也减少了         
                
  Logback： 创始人： Ceki Gulcu ，另外一个开源日志组件，是作为Log4j的继承者来开发的，提供了更好的性能实现，异步logger，filter更多特性
               三个模块：
                    logback-core：是下面两个模块的基础模块
                    logback-classic： 扩展了核心模块（logback-core），是log4j的一个改良版本、并且完整实现了 Slf4j 的api（可以实现和其他日志系统的来回切换），这样可以很方便更换日志系统为 log4j或者JDK1.4 Logging、或者JUL （java util logging）
                    logback-access：  访问模块与 Servlet 容器集成、为tomcat等提供通过Http来访问日志的功能

               
               主要关键：
                     Logger：（logback-classic）
                     Appender：（logback-core）
                     Layout：（logback-core）
                     Root
                     
                     filter: 过滤器，用于配置过滤不同的日志级别，主要使用的有： 临界值过滤器（ThresholdFilter），级别过滤器 （LevelFilter） 
                     level
                     logger
                    
                    
  Log4j2： 基于 Log4j 上为了提高其性能而开发出了 Log4j2             
            Log4j2 和 Log4j并不兼容，并且设计模仿 Logback，性能倒是提高了不少
            Log4j2 也做了 Facade（门面）/Implementation（实现） 分离的设计，分成了 log4j-api 和 log4j-core。

  ******对比
性能上 Log4j2 要强，但是生态上 Logback是优先的  
1 log4j2比logback更新：log4j2的GA版在2014年底才推出，比logback晚了好几年，这期间log4j2确实吸收了slf4j和logback的一些优点（比如日志模板），同时应用了不少的新技术 
2 由于采用了更先进的锁机制和LMAX Disruptor库，log4j2的性能优于logback，特别是在多线程环境下和使用异步日志的环境下 
3 二者都支持Filter（应该说是log4j2借鉴了logback的Filter），能够实现灵活的日志记录规则（例如仅对一部分用户记录debug级别的日志） 
4 二者都支持对配置文件的动态更新 
5 二者都能够适配slf4j，logback与slf4j的适配应该会更好一些，毕竟省掉了一层适配库 
6 logback能够自动压缩/删除旧日志 
7 logback提供了对日志的HTTP访问功能 
8 log4j2实现了“无垃圾”和“低垃圾”模式。简单地说，log4j2在记录日志时，能够重用对象（如String等），尽可能避免实例化新的临时对象，减少因日志记录产生的垃圾对象，减少垃圾回收带来的性能下降 
9 log4j2和logback各有长处，总体来说，如果对性能要求比较高的话，log4j2相对还是较优的选择。

日志门面：
  JCL： common-logging 是apache的一个开源项目，也叫做 Jakarta Common Logging，缩写 JCL
        common-logging 的功能是提供日志功能的 API 接口，本身并不提供日志的具体实现（当然，common-logging 内部有一个 Simple logger 的简单实现，但是功能很弱，直接忽略），
        而是在运行时动态的绑定日志实现组件来工作（如 log4j、java.util.loggin）。
  
  Slf4j： Simple Logging Facade For Java： 简单java日志门面，创始人： Ceki Gulcu
          类似于 Common-Logging，slf4j 是对不同日志框架提供的一个 API 封装，可以在部署的时候不修改任何配置即可接入一种日志实现方案。
          但是，slf4j 在编译时静态绑定真正的 Log 库。使用 SLF4J 时，如果你需要使用某一种日志实现，那么你必须选择正确的 SLF4J 的 jar 包的集合（各种桥接包）。
          
            
  ********对比*********
  slf4j 库类似于 Apache Common-Logging。但是，他在编译时静态绑定真正的日志库。这点似乎很麻烦，其实也不过是导入桥接 jar 包而已。
  不需要使用logger.isDebugEnabled()来解决日志因为字符拼接产生的性能问题。slf4j 的方式是使用{}作为字符串替换符，形式如： logger.debug(&quot;id: {}, name: {} &quot;, id, name);
  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><ul><li>搭配使用</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>
slf4j + logback 

common-logging + log4j

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="springboot-mdc-全链路调用日志追踪"><a href="#springboot-mdc-全链路调用日志追踪" class="header-anchor">#</a> springboot + MDC 全链路调用日志追踪</h2> <ul><li>MDC: Mapped Diagnostic Context 映射调试上下文，是 Log4j， Logback 、 Log4j2 提供的一种方便下多线程下记录日志的功能。
MDC可以看作一个与当前线程绑定的哈希表。可以往里面添加键值对。</li> <li>MDC的相关API ：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>clear() ：移除所有MDC
get (String key) ：获取当前线程MDC中指定key的值
getContext() ：获取当前线程MDC的MDC
put(String key, Object o) ：往当前线程的MDC中存入指定的键值对
remove(String key) ：删除当前线程MDC中指定的键值对
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>解决方案</li> <li><ol><li>调整Hystrix隔离策略</li></ol></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>Hystrix的资源隔离策略分为两种： 线程池（Thread） 和 信号量（Semaphore）
    hystrix.command.default.execution.isolation.strategy: SEMAPHORE
    Hystrix默认的隔离配置是Thread，但是无法获取到MDC（不是同一个线程）、也无法获取到相同请求的HttpServletRequest对象（不是同一个线程）
    设置隔离策略为信号量后Feign拦截器中就能获取MDC值，但该方案不是特别好。原因是Hystrix官方强烈建议使用THREAD作为隔离策略。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><ol start="2"><li>自定义策略扩展 HystrixConcurrencyStrategy 并且通过 HystrixPlugins 注册</li></ol></li></ul> <ul><li>具体配置：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>相关依赖： web依赖、hystrix-core依赖
&lt;dependency&gt;
 &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
 &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;!-- 包含了hystrix-core依赖 --&gt;
&lt;dependency&gt;
 &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
 &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
 &lt;version&gt;2.1.3.RELEASE&lt;/version&gt;
&lt;/dependency&gt;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>一：  RequestContextHystrixStrategy 继承 HystrixPlugins，目的把当前Request对象传递给Feign上下文</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.qingwang.mars.springcloud.hystrix;

import com.netflix.hystrix.strategy.concurrency.HystrixConcurrencyStrategy;
import org.springframework.web.context.request.RequestAttributes;
import org.springframework.web.context.request.RequestContextHolder;

import java.util.concurrent.Callable;

/**
 * 版权所有  copyright© 蒙大拿
 *
 * @author mqz
 * @date 2022/3/28
 * @about https://www.gitee.com/DemoMeng
 * @description
 */
public class RequestContextHystrixStrategy extends HystrixConcurrencyStrategy {

    @Override
    public &lt;T&gt; Callable&lt;T&gt; wrapCallable(Callable&lt;T&gt; callable) {
        return new RequestAttributeAwareCallable&lt;&gt;(callable, RequestContextHolder.getRequestAttributes());
    }

    static class RequestAttributeAwareCallable&lt;T&gt; implements Callable&lt;T&gt; {

        private final Callable&lt;T&gt; delegate;
        private final RequestAttributes requestAttributes;

        public RequestAttributeAwareCallable(Callable&lt;T&gt; callable, RequestAttributes requestAttributes) {
            this.delegate = callable;
            this.requestAttributes = requestAttributes;
        }

        @Override
        public T call() throws Exception {
            try {
                RequestContextHolder.setRequestAttributes(requestAttributes);
                return delegate.call();
            } finally {
                RequestContextHolder.resetRequestAttributes();
            }
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><ul><li>二：  重写Feign的拦截器（RequestInterceptor），只要feign调用就会走拦截器，并把上面的设置进来的Request，获取logId，传递给feign被调用系统</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.qingwang.mars.springcloud.openfeign;

import com.qingwang.mars.base.constants.LocalConstant;
import feign.RequestInterceptor;
import feign.RequestTemplate;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.context.annotation.Configuration;
import org.springframework.util.StringUtils;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import javax.servlet.http.HttpServletRequest;

/**
 * 版权所有  copyright© 蒙大拿
 *
 * @author mqz
 * @date 2022/3/28
 * @about https://www.gitee.com/DemoMeng
 * @description
 */
@Configuration
public class GlobalFeignInterceptor implements RequestInterceptor {

    private final static Logger log = LoggerFactory.getLogger(GlobalFeignInterceptor.class);

    @Override
    public void apply(RequestTemplate template) {
        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        if(attributes != null){
            HttpServletRequest request = attributes.getRequest();
            String requestId = request.getParameter(LocalConstant.LOG_ID);
            log.info(&quot;requestInterceptor: requestId: {} &quot;,requestId);
            if(! StringUtils.isEmpty(requestId)){
                template.query(&quot;logId&quot;,requestId);
            }
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><ul><li>三： 将自定义的Hystrix策略注册到当前策略中</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>@PostConstruct
public void init() {
    HystrixPlugins.getInstance().registerConcurrencyStrategy(new RequestContextHystrixStrategy());
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>三.1 : application.yml配置自定义的Hystrix策略所在的包位置 （似乎可以不用配置！！）</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>hystrix:
 plugin:
   HystrixConcurrencyStrategy:
     implementation: com.qingwang.mars.springcloud.hystrix.RequestContextHystrixStrategy
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>三.2 : logback获取logId：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;property name=&quot;log.pattern&quot; value=&quot;[%X{requestId}]-%d{yyyy-MM-dd HH:mm:ss} %-5level %thread %logger %msg%n&quot;/&gt;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><p>四： feign调用方
<a data-fancybox="" title="111" href="springboot+mdc链路调用-feign调用方拦截器配置.png"><img src="springboot+mdc%E9%93%BE%E8%B7%AF%E8%B0%83%E7%94%A8-feign%E8%B0%83%E7%94%A8%E6%96%B9%E6%8B%A6%E6%88%AA%E5%99%A8%E9%85%8D%E7%BD%AE.png" alt="springboot+mdc链路调用-feign调用方拦截器配置.png"></a></p></li> <li><p>五： feign被调用方</p></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>和调用方一致，从request中获取logId，并且设置到ThreadLocal、MDC中
  String requestId = request.getParameter(LocalConstant.LOG_ID);
  LocalContext.addArgument(LocalConstant.LOG_ID,requestId);
  MDC.put(&quot;requestId&quot;, requestId);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><a data-fancybox="" title="111" href="springboot+mdc链路调用-效果.png"><img src="springboot+mdc%E9%93%BE%E8%B7%AF%E8%B0%83%E7%94%A8-%E6%95%88%E6%9E%9C.png" alt="springboot+mdc链路调用-效果.png"></a></p> <p>##【spring中的IOC和DI的注入方式】
##IOC Inverse Of Control 控制反转。
它的作用是解除代码之间的耦合性，让程序专注核心的功能业务，其余杂事全部统一处理。
那么作为spring的容器管理了各个实例，所以设计到实例的管理，和依赖关系。
##DI Dependency Injection 依赖注入
说的是实例和实例之间依赖关系的存在方式，以及如何使用示例的方法。</p> <div class="language- extra-class"><pre><code>注入方式的分类

1.XML注入：
    a.构造方法注入：构造方法中带参数并且赋值到静态变量，配置文件中使用标签&lt;construct-arg&gt;&lt;/construct-arg&gt;

          @Service
          public class InstanceB{
                  private InstanceA a;
                  public Demo(InstanceA ia){
                      this.a = ia;
                  }
          }

          xml配置文件：
           &lt;bean name=&quot;xxx&quot; class=&quot;xxx.xxx.InstanceB&quot;&gt;
                &lt;construct-arg name=&quot;a&quot; class=&quot;xxx.xxx.InstanceA&quot;&gt;&lt;/construct-arg&gt;
           &lt;/bean&gt;

    b.setter方法注入：构造方法中定义全局变量，并且使用setter方法，配置文件中使用&lt;property&gt;&lt;/property&gt;


2.注解注入：

    a.属性注入：
        @Autowired
        private InstanceB b;
    b.setter方法注入：
        private InstanceB b;

        @Autowired
        private void setB(InstanceB ib){
             this.b = ib;
        }
    c.构造方法注入：
        private InstanceB b;

        @Autowired
        public Demo(InstanceB ib){
            this.b = ib;
        }

3. resource 注入

        @Resource
        private InstanceB b;

@Resource  和  @Autowired 的区别
    @Autowired是使用byType方式注入对象，若对象有多个则需要使用 @Quailfer(&quot;beanName)
            @Autowired
            @Quailfer(&quot;instanceB&quot;)
            private InstanceB b;

      或者在对象上加上 @Primary

    @Resource 是根据bean的名称和类型注入对西那个
</code></pre></div><h2 id="事务不生效的场景"><a href="#事务不生效的场景" class="header-anchor">#</a> 事务不生效的场景</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>    
    
    
    事务特性：
        原子性：atomicity:同时成功，同时失败。
        一致性：consistency:事务执行之前，数据库需要保持一致性，即使执行了失败，也不能更新一张表，另外一张表却没有更新。（前后都是一致的）
        隔离性：isolation：每个事务之间相互不影响。
        持久性：durability事务执行成功之后，数据会及时更行到数据库


    事务分类：
        1.编程式事务：使用工厂获取到事务执行实例，分别调用 beginTransaction() 、commit() 、rollBack() 等事务管理方法，注意这些是写在代码中的
                    优点： 1. 可以精细话控制事务的范围
        2.声明式事务：使用spring的容器管理事务。可以使用
                                       a.注解@Transactional
                                       b.tx配置xml配置的方式-对于SSM项目比较常见
                    缺点： 
                        1. 是对整个方法进行事务控制，无法精细化控制                   
                    
                                       

    @Transactional注解：
        1.作用范围：类，类方法，接口
        2.作用范围作用意义：
            类：当注解在类上时，标明该类下的所有public方法都配置相同的事务属性信息。
            类方法：public方法下才能生效，如果类上有注解，方法上也有注解，那么方法的事务配置会覆盖类的事务的配置信息。
            接口：不推荐使用这种方法，因为一旦在接口上配置了springAOP使用CGLib动态代理
            
        
        @Transactional是使用 AOP 实现的，本质就是在目标方法执行前后进行拦截。在目标方法执行前加入或创建一个事务，在执行方法执行后，根据实际情况选择提交或是回滚事务。
         当 Spring 遇到该注解时，会自动从数据库连接池中获取 connection，并开启事务然后绑定到 ThreadLocal 上，
         对于@Transactional注解包裹的整个方法都是使用同一个connection连接。如果我们出现了耗时的操作，比如第三方接口调用，业务逻辑复杂，大批量数据处理等就会导致我们我们占用这个connection的时间会很长，
         数据库连接一直被占用不释放。一旦类似操作过多，就会导致数据库连接池耗尽。在一个事务中执行RPC操作导致数据库连接池撑爆属于是典型的长事务问题，类似的操作还有在事务中进行大量数据查询，业务规则处理等...
        @Transactional注解的声明式事务是通过spring aop起作用的，而spring aop需要生成代理对象，直接在同一个类中方法调用使用的还是原始对象，事务不生效。 
        
        长事务：   运行时间较长，并且长时间未提交的事务，也称之为大事务。
        长事务会引发哪些问题：
            1 数据库连接池被占满，长时间没有close释放资源，应用无法获取连接资源。
            2 容易引发数据库死锁。
            3 数据库回滚时间较长
            4 在主从架构重导致主从延迟变大
        如何避免长事务： 
            1 拆分事务的方法，不需要事务管理的的逻辑抽离成独立方法，变小事务，减少事务的颗粒度
            

    @Transactional 属性：
        propagation属性（冒泡属性）
            propagation 代表事务的传播行为，默认值为 Propagation.REQUIRED，其他的属性信息如下：
            Propagation.REQUIRED：如果当前存在事务，则加入该事务，如果当前不存在事务，则创建一个新的事务。( 也就是说如果A方法和B方法都添加了注解，在默认传播模式下，A方法内部调用B方法，会把两个方法的事务合并为一个事务 ）
            Propagation.SUPPORTS：如果当前存在事务，则加入该事务；如果当前不存在事务，则以非事务的方式继续运行。
            Propagation.MANDATORY：如果当前存在事务，则加入该事务；如果当前不存在事务，则抛出异常。
            Propagation.REQUIRES_NEW：重新创建一个新的事务，如果当前存在事务，暂停当前的事务。( 当类A中的 a 方法用默认Propagation.REQUIRED模式，类B中的 b方法加上采用 Propagation.REQUIRES_NEW模式，然后在 a 方法中调用 b方法操作数据库，然而 a方法抛出异常后，b方法并没有进行回滚，因为Propagation.REQUIRES_NEW会暂停 a方法的事务 )
            Propagation.NOT_SUPPORTED：以非事务的方式运行，如果当前存在事务，暂停当前的事务。
            Propagation.NEVER：以非事务的方式运行，如果当前存在事务，则抛出异常。
            Propagation.NESTED ：和 Propagation.REQUIRED 效果一样。

        isolation 属性 ： 当spring设置它自己的隔离级别，会覆盖mysql设置的隔离级别
            isolation ：spring事务的隔离级别，默认值为 Isolation.DEFAULT。
            Isolation.DEFAULT：使用底层数据库默认的隔离级别。
            Isolation.READ_UNCOMMITTED ： 读未提交 ，容易产生脏读
            Isolation.READ_COMMITTED ：读已经提交，容易产生不可
            Isolation.REPEATABLE_READ
            Isolation.SERIALIZABLE

        timeout 属性
            timeout ：事务的超时时间，默认值为 -1。如果超过该时间限制但事务还没有完成，则自动回滚事务。

        readOnly 属性
            readOnly ：指定事务是否为只读事务，默认值为 false；为了忽略那些不需要事务的方法，比如读取数据，可以设置 read-only 为 true。

        rollbackFor 属性
            rollbackFor ：用于指定能够触发事务回滚的异常类型，可以指定多个异常类型。

        noRollbackFor 属性
            noRollbackFor：抛出指定的异常类型，不回滚事务，也可以指定多个异常类型。

    不生效的场景：
        1.数据库引擎：myISAM引擎是不支持事务机制。innoDB支持事务机制
        2.修饰的方法必须是public的（spring+aop），如果非要在public的方法上加上事务，可以使用AspectJ代理:
            原因：在Spring AOP 代理时，如上图所示 TransactionInterceptor （事务拦截器）在目标方法执行前后进行拦截，
                 DynamicAdvisedInterceptor（CglibAopProxy 的内部类）的 intercept 方法或 JdkDynamicAopProxy 的 invoke 方法会间接调用
                 AbstractFallbackTransactionAttributeSource的computeTransactionAttribute 方法，获取Transactional 注解的事务配置信息。
            注意：protected、private 修饰的方法上使用 @Transactional 注解，虽然事务无效，但不会有任何报错，这是我们很容犯错的一点。

        3.@Transactional中的propagation属性设置错
            TransactionDefinition.PROPAGATION_SUPPORTS：如果当前存在事务，则加入该事务；如果当前没有事务，则以非事务的方式继续运行。
            TransactionDefinition.PROPAGATION_NOT_SUPPORTED：以非事务方式运行，如果当前存在事务，则把当前事务挂起。
            TransactionDefinition.PROPAGATION_NEVER：以非事务方式运行，如果当前存在事务，则抛出异常。

        3.异常被捕获了，没有异常抛出。
        4.异常类型错误：事务回滚的正常类型是RuntimeException:
            Spring默认抛出了未检查unchecked异常（继承自 RuntimeException 的异常）或者 Error才回滚事务
            其他异常不会触发回滚事务。如果在事务中抛出其他类型的异常，但却期望 Spring 能够回滚事务，就需要指定rollbackFor属性。

                @Service
                public class OrderServiceImpl implements OrderService {
                    @Transactional
                    public void updateOrder(Order order) {
                        try {
                            // update order
                        } catch {
                            throw new Exception(&quot;更新错误&quot;);
                        }
                    }
                }
                //如果想要事务生效 ，@Transactional(rollbackFor = Exception.class)

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br></div></div><h2 id="异步任务调度"><a href="#异步任务调度" class="header-anchor">#</a> 异步任务调度</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>
【Application的配置】
    ******其他的配置*******
    @EnableAsync
    @EnableScheduling
    public class HlwManageApplication {
        public static void main(String[] args) {
            SpringApplication.run(HlwManageApplication.class, args);
        }
        @Bean(name = &quot;threadPoolTaskExecutor&quot;)
        public Executor threadPoolTaskExecutor() {
            return new ThreadPoolTaskExecutor();
        }
    }

【异步调度相关配置】

    @Configuration
    @EnableAsync
    @EnableScheduling
    public class SchedulingConfiguration implements SchedulingConfigurer, AsyncConfigurer {
        private Logger logger = LoggerFactory.getLogger(SchedulingConfiguration.class);
        @Bean
        public TaskScheduler taskScheduler() {
            ThreadPoolTaskScheduler taskScheduler = new ThreadPoolTaskScheduler();
            taskScheduler.setPoolSize(10);/**配置线程池大小，根据任务数量定制*/
            taskScheduler.setThreadNamePrefix(&quot;spring-task-scheduler-thread-&quot;);/**线程名称前缀*/
            taskScheduler.setAwaitTerminationSeconds(60);/**线程池关闭前最大等待时间，确保最后一定关闭*/
            taskScheduler.setWaitForTasksToCompleteOnShutdown(true);/**线程池关闭时等待所有任务完成*/
            taskScheduler.setRejectedExecutionHandler(new ThreadPoolExecutor.AbortPolicy());/**任务丢弃策略*/
            return taskScheduler;
        }
        @Override
        public void configureTasks(ScheduledTaskRegistrar scheduledTaskRegistrar) {
        }
        @Override
        public Executor getAsyncExecutor() {
            ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
            executor.setCorePoolSize(20);/**配置核心线程数*/
            executor.setMaxPoolSize(50);/**配置最大线程数*/
            executor.setQueueCapacity(100);/**配置缓存队列大小*/
            executor.setKeepAliveSeconds(15);/**空闲线程存活时间*/
            executor.setThreadNamePrefix(&quot;spring-task-executor-thread-&quot;);
            /**线程池对拒绝任务的处理策略：这里采用了CallerRunsPolicy策略，当线程池没有处理能力的时候，该策略会直接在execute方法的调用线程中运行被拒绝的任务；如果执行程序已关闭，则会丢弃该任务*/
            executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());/**AbortPolicy()*/
            /**等待所有任务结束后再关闭线程池*/
            executor.setWaitForTasksToCompleteOnShutdown(true);
            /**设置线程池中任务的等待时间，如果超过这个时候还没有销毁就强制销毁，以确保应用最后能够被关闭，而不是被没有完成的任务阻塞*/
            executor.setAwaitTerminationSeconds(60);
            executor.initialize();
            return executor;
        }
        @Override
        public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {
            return new SpringAsyncExceptionHandler();
        }
        class SpringAsyncExceptionHandler implements AsyncUncaughtExceptionHandler {
            @Override
            public void handleUncaughtException(Throwable throwable, Method method, Object... objects) {
                logger.error(&quot;Exception occurs in async method&quot;, throwable);
            }
        }
    }

 【使用异步调度执行具体任务-A:异步调用】
    @Component
    @EnableScheduling
    @Async
    public class AsyncTaskExecute {

        private static final Logger log = LoggerFactory.getLogger(AsyncTaskExecute.class);

        @Autowired
        private IHlwManageRoleService roleService;

        @Autowired
        private IHlwManageUserService userService;

        @Value(&quot;${my.token.expire}&quot;)
        private long tokenExpireTime;



        @Async
        public void pushCurrentRole(Long id){
            HlwManageRole role = roleService.currentRole(id);
            RedisService.set(CommonConstants.Current.CURRENT_ROLE+id,role,tokenExpireTime);
            log.info(&quot;当前用户角色已经存入缓存中&quot;);
        }

        @Async
        public void updateLogin(Long currentId, Date date,String ip) {
            try {
                Thread.sleep(10000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            HlwManageUser user = new HlwManageUser()
                    .setId(currentId)
                    .setLoginDate(date)
                    .setLoginIp(ip)
                    .setArea(AddressUtils.getAreaWithGD(ip));
            userService.updateById(user);
            log.info(&quot;登录信息已更新&quot;);
        }
    }
    
 【使用异步调度执行具体任务-B:定时执行】
 @Component
 @EnableScheduling
 @EnableAsync
 public class ScheduleTask {

     private static final Logger log = LoggerFactory.getLogger(ScheduleTask.class);

     @Autowired
     private IHlwManageUserService userService;

     @Autowired
     private IHlwManageUserRoleService userRoleService;

     @Autowired
     private IHlwManageLogService logService;

     @Async
     @Scheduled(cron = &quot;0/60 * *  * * ? &quot;) // 每60秒执行
     public void autoLog2(){
         List&lt;MessageBean&gt; mbList = (List&lt;MessageBean&gt;) RedisService.get(CommonConstants.KEY_FOR_MESSAGE_LIST);
         List&lt;MessageBean&gt; left = new ArrayList&lt;&gt;();
         if(mbList != null &amp;&amp; mbList.size() &gt;0) {
             log.info(&quot;【信息】执行定时任务...&quot;+mbList.size());
             for (MessageBean model : mbList) {
                 HlwManageUser user = userService.getById(model.getUserId());
                 if (user != null) {
                     HlwManageLog hlwManageLog = new HlwManageLog()
                             .setIp(model.getIp())
                             //.setRequestMethod(request.getMethod())
                             .setCreateDate(model.getCreateDate())
                             //.setRequestUri(request.getRequestURL().toString())
                             .setOperator(user.getId())
                             .setOperatorName(user.getName())
                             //.setRequestParams(WebCommonUtils.getRequestParams())
                             .setOperateAccount(user.getLoginName())
                             .setOperatorRole(userRoleService.getByUserId(user.getId()))
                             .setDescription(model.getDescription())
                             .setResult(model.getResult());
                     if(logService.save(hlwManageLog)) {
                         log.info(&quot;*****************消息保存成功：&quot; + hlwManageLog.getId() + &quot; ***************&quot;);
                         continue;
                     }
                     log.info(&quot;*****************消息保存未能成功：&quot; + model.getUserId()+model.getDescription() + &quot; ***************&quot;);
                     left.add(model);
                 }
             }
             RedisService.del(CommonConstants.KEY_FOR_MESSAGE_LIST);
             RedisService.set(CommonConstants.KEY_FOR_MESSAGE_LIST,left);
          }
     }
 }

More than one TaskExecutor bean found within the context, and none is named 'taskExecutor'. Mark one of them as primary or name it 'taskExecutor' (possibly as an alias) in order to use it for async processing: [taskScheduler, applicationTaskExecutor]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br></div></div><h2 id="springboot常用注解"><a href="#springboot常用注解" class="header-anchor">#</a> SpringBoot常用注解</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>一、常见注解
    @SpringBootConfiguration  &lt;==&gt;  @Configuration + @ComponentScan + @EnableAutoConfiguration
    @EnableAutoConfiguration 自动配置。
    @ImportResource    加载xml配置，一般是放在启动main类上， @ImportResource(&quot;classpath*:/spring/*.xml&quot;)  单个 、 @ImportResource({&quot;classpath*:/spring/1.xml&quot;,&quot;classpath*:/spring/2.xml&quot;})   多个
    @Value    获取application.yml 中的属性
    @ConfigurationProperties(prefix=&quot;user&quot;) 获取application.yml 对象属性
    @EnableConfigurationProperties   用 @EnableConfigurationProperties注解使 @ConfigurationProperties生效，并从IOC容器中获取bean。
    @RestController  注解是@Controller和@ResponseBody的合集,表示这是个控制器bean,并且是将函数的返回值直 接填入HTTP响应体中,是REST风格的控制器。
    @RequestMapping
    @GetMapping
    @PostMapping
    @RequestParam   URL的请求参数
    @ResponseBody  支持将返回值放在response体内，而不是返回一个页面
    @Bean     @Bean(name=&quot;bean的名字&quot;,initMethod=&quot;初始化时调用方法名字&quot;,destroyMethod=&quot;close&quot;)
    @Controller
    @Service
    @Repository
    @Component:   可配合CommandLineRunner使用，在程序启动后执行一些基础任务
    @PostContruct   spring容器初始化时，要执行该方法
    @PathVariable      用来获得请求url中的动态参数
    @ComponentScan:   让spring Boot扫描到Configuration类并把它加入到程序上下文
    @EnableZuulProxy:  路由网关的主要目的是为了让所有的微服务对外只有一个接口，我们只需访问一个网关地址，即可由网关将所有的请求代理到不同的服务中。Spring Cloud是通过Zuul来实现的，支持自动路由映射到在Eureka Server上注册的服务。Spring Cloud提供了注解@EnableZuulProxy来启用路由代理。
    @Autowired ：    在默认情况下使用 @Autowired 注释进行自动注入时，Spring 容器中匹配的候选 Bean 数目必须有且仅有一个。当找不到一个匹配的 Bean 时，Spring 容器将抛出 BeanCreationException 异常，并指出必须至少拥有一个匹配的 Bean。 
                     当不能确定 Spring 容器中一定拥有某个类的 Bean 时，可以在需要自动注入该类 Bean 的地方可以使用 @Autowired(required = false)，这等于告诉 Spring: 在找不到匹配 Bean 时也不报错 
    @Resource
    @Configuration: 声明这是一个配制
    @Import(Config.class)
    @Order  值越小优先级超高，越先运行
    @ConditionalOnExpression  @ConditionalOnExpression(&quot;${enabled:false}&quot;) 开关为true的时候才实例化bean
    @ConditionalOnProperty  
    @ConditionalOnClass 
    @ConditionalOnMissingClass({ApplicationManager.class})   如果存在它修饰的类的bean，则不需要再创建这个bean；
    @ConditionOnMissingBean(name=&quot;example&quot;)   表示如果name为“example”的bean存在，该注解修饰的代码块不执行。
    @Configuration 等同于spring的XML配置文件；使用Java代码可以检查类型安全。
    @JsonBackReference   解决嵌套外链问题。
    @RepositoryRestResourcepublic    配合spring-boot-starter-data-rest使用。
        
二、注解(annotations)详解
    @SpringBootApplication：申明让spring boot自动给程序进行必要的配置，这个配置等同于：@Configuration ，@EnableAutoConfiguration 和 @ComponentScan 三个配置。

        package com.example.myproject;
        import org.springframework.boot.SpringApplication;
        import org.springframework.boot.autoconfigure.SpringBootApplication;
        @SpringBootApplication // same as @Configuration @EnableAutoConfiguration @ComponentScan
        public class Application {
            public static void main(String[] args) {
                SpringApplication.run(Application.class, args);
            }
        }

    @ResponseBody：表示该方法的返回结果直接写入HTTP response body中，一般在异步获取数据时使用，用于构建RESTful的api。
    在使用@RequestMapping后，返回值通常解析为跳转路径，加上@responsebody后返回结果不会被解析为跳转路径，而是直接写入HTTP response body中。
    比如异步获取json数据，加上@responsebody后，会直接返回json数据。
    该注解一般会配合@RequestMapping一起使用。示例代码：
    
        @RequestMapping(“/test”)
        @ResponseBody
        public String test(){
            return”ok”;
        }

    @Controller：用于定义控制器类，在spring 项目中由控制器负责将用户发来的URL请求转发到对应的服务接口（service层）
    一般这个注解在类中，通常方法需要配合注解@RequestMapping。
    示例代码：
    
        @Controller
        @RequestMapping(“/demoInfo”)
        publicclass DemoController {
            @Autowired
            private DemoInfoService demoInfoService;
        
            @RequestMapping(&quot;/hello&quot;)
            public String hello(Map map){
                System.out.println(&quot;DemoController.hello()&quot;);
                map.put(&quot;hello&quot;,&quot;from TemplateController.helloHtml&quot;);
                //会使用hello.html或者hello.ftl模板进行渲染显示.
                return&quot;/hello&quot;;
            }
        }

    @RestController：用于标注控制层组件(如struts中的action)，@ResponseBody和@Controller的合集。
    示例代码：
        package com.kfit.demo.web;
        
        import org.springframework.web.bind.annotation.RequestMapping;
        import org.springframework.web.bind.annotation.RestController;
        
        @RestController
        @RequestMapping(“/demoInfo2”)
        public class DemoController2 {
            @RequestMapping(&quot;/test&quot;)
            public String test(){
                return&quot;ok&quot;;
            }
        }
    
    @RequestMapping：提供路由信息，负责URL到Controller中的具体函数的映射。
    
    @EnableAutoConfiguration：Spring Boot自动配置（auto-configuration）：尝试根据你添加的jar依赖自动配置你的Spring应用。
    例如，如果你的classpath下存在HSQLDB，并且你没有手动配置任何数据库连接beans，那么我们将自动配置一个内存型（in-memory）数据库”。
    你可以将@EnableAutoConfiguration或者@SpringBootApplication注解添加到一个@Configuration类上来选择自动配置。
    如果发现应用了你不想要的特定自动配置类，你可以使用@EnableAutoConfiguration注解的排除属性来禁用它们。
    @ComponentScan：表示将该类自动发现扫描组件。
    个人理解相当于，如果扫描到有@Component、@Controller、@Service等这些注解的类，并注册为Bean，可以自动收集所有的Spring组件，包括@Configuration类。
    我们经常使用@ComponentScan注解搜索beans，并结合@Autowired注解导入。可以自动收集所有的Spring组件，包括@Configuration类。
    如果没有配置的话，Spring Boot会扫描启动类所在包下以及子包下的使用了@Service,@Repository等注解的类。
    @Configuration：相当于传统的xml配置文件，如果有些第三方库需要用到xml文件，建议仍然通过@Configuration类作为项目的配置主类——可以使用@ImportResource注解加载xml配置文件。
    @Import：用来导入其他配置类。
    @ImportResource：用来加载xml配置文件。
    @Autowired：自动导入依赖的bean
    @Service：一般用于修饰service层的组件
    @Repository：使用@Repository注解可以确保DAO或者repositories提供异常转译，这个注解修饰的DAO或者repositories类会被ComponetScan发现并配置，同时也不需要为它们提供XML配置项。
    @Bean：用@Bean标注方法等价于XML中配置的bean。
    @Value：注入Spring boot application.properties配置的属性的值。示例代码：
    @Value(value = “#{message}”)
    private String message;
    @Inject：等价于默认的@Autowired，只是没有required属性；
    @Component：泛指组件，当组件不好归类的时候，我们可以使用这个注解进行标注。
    @Bean：相当于XML中的,放在方法的上面，而不是类，意思是产生一个bean,并交给spring管理。
    @AutoWired：自动导入依赖的bean。byType方式。把配置好的Bean拿来用，完成属性、方法的组装，它可以对类成员变量、方法及构造函数进行标注，完成自动装配的工作。当加上（required=false）时，就算找不到bean也不报错。
    @Qualifier：当有多个同一类型的Bean时，可以用@Qualifier(“name”)来指定。与@Autowired配合使用。@Qualifier限定描述符除了能根据名字进行注入，但能进行更细粒度的控制如何选择候选者，具体使用方式如下：
    @Autowired
    @Qualifier(value = “demoInfoService”)
    private DemoInfoService demoInfoService;
    @Resource(name=”name”,type=”type”)：没有括号内内容的话，默认byName。与@Autowired干类似的事。
    
    
    
三、JPA注解

    @Entity：@Table(name=”“)：表明这是一个实体类。一般用于jpa这两个注解一般一块使用，但是如果表名和实体类名相同的话，@Table可以省略
    @MappedSuperClass:用在确定是父类的entity上。父类的属性子类可以继承。
    @NoRepositoryBean:一般用作父类的repository，有这个注解，spring不会去实例化该repository。
    @Column：如果字段名与列名相同，则可以省略。
    @Id：表示该属性为主键。
    @GeneratedValue(strategy=GenerationType.SEQUENCE,generator= “repair_seq”)：表示主键生成策略是sequence（可以为Auto、IDENTITY、native等，Auto表示可在多个数据库间切换），指定sequence的名字是repair_seq。
    @SequenceGeneretor(name = “repair_seq”, sequenceName = “seq_repair”, allocationSize = 1)：name为sequence的名称，以便使用，sequenceName为数据库的sequence名称，两个名称可以一致。
    @Transient：表示该属性并非一个到数据库表的字段的映射,ORM框架将忽略该属性。
                如果一个属性并非数据库表的字段映射,就务必将其标示为@Transient,否则,ORM框架默认其注解为@Basic。@Basic(fetch=FetchType.LAZY)：标记可以指定实体属性的加载方式
    @JsonIgnore：作用是json序列化时将Java bean中的一些属性忽略掉,序列化和反序列化都受影响。
    @JoinColumn（name=”loginId”）:一对一：本表中指向另一个表的外键。一对多：另一个表指向本表的外键。
    @OneToOne、@OneToMany、@ManyToOne：对应hibernate配置文件中的一对一，一对多，多对一。
    
四、springMVC相关注解
    1.@RequestMapping：@RequestMapping(“/path”)表示该控制器处理所有“/path”的UR L请求。
        RequestMapping是一个用来处理请求地址映射的注解，可用于类或方法上。用于类上，表示类中的所有响应请求的方法都是以该地址作为父路径。该注解有六个属性：
        params:指定request中必须包含某些参数值是，才让该方法处理。
        headers:指定request中必须包含某些指定的header值，才能让该方法处理请求。
        value:指定请求的实际地址，指定的地址可以是URI Template 模式
        method:指定请求的method类型， GET、POST、PUT、DELETE等
        consumes:指定处理请求的提交内容类型（Content-Type），如application/json,text/html;
        produces:指定返回的内容类型，仅当request请求头中的(Accept)类型中包含该指定类型才返回
    2@RequestParam：用在方法的参数前面。
        @RequestParam
        String a =request.getParameter(“a”)。
    3.@PathVariable:路径变量。如
        RequestMapping(“user/get/mac/{macAddress}”)
        public String getByMacAddress(@PathVariable String macAddress){
            //do something;
        }
        参数与大括号里的名字一样要相同。

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br></div></div><h2 id="接口幂等性"><a href="#接口幂等性" class="header-anchor">#</a> 接口幂等性</h2> <ul><li>定义</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>以相同的请求（请求参数、请求路径）调用这个接口，一次和多次调用，对系统产生的影响是相同的

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>接口幂等性和防止重复提交是一回事情吗？</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>幂等： 是指的请求已经发生，或者已经无法避免的情况下，采取一定的技术手段，让这些重复的请求不给系统带来副作用

防止重复： 让用户不发起多次一样的请求，比如在线购物点击了下单按钮，但是由于网络延迟或者其他原因导致响应很慢，此时用户心急多次点击下单按钮，这种情况下可能会造成多次下单（若不做处理）
         一般防止重复提交方案： 将下单按钮置灰色禁止多次重复点击、跳转到结果页。主要是在客户端解决这个问题
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>哪些情况无法防止重复提交</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. 接口重试调用 ： 因为某些不可逆原因导致调用接口失败，出于容错性考虑会加入失败重试机制，需要重复调用接口。
2. 消息重复消费 ： 消息队列情况下
3. 请求重发 ： 网络抖动引发的nginx重发请求，造成重复调用

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>常见保证幂等性的方式</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>数据库层面：
    悲观锁： for update
            1. 当线程A执行 select * from user where id = 1 for update 的时候会对这条记录加锁，当其他线程执行到这行代码的时候，会等待A线程释放锁之后，才能获取锁，继续后续操作
            2. 事务提交的时候，for update 获取的锁会自动释放
            缺点： 这种方式比较少使用，因为当业务处理比较耗时的时候，并发情况下，后面的线程会长期出于等待前线程释放锁的状态。web服务中的线程数量都是有限的。若大量的线程由于for upate锁出于等待状态。并发性极低。
            
    唯一ID/索引： 主键id、创建唯一约束：
                                ALTER TABLE user_sys_role ADD CONSTRAINT unique_no UNIQUE(no);
                                ALTER TABLE user_sys_role DROP INDEX unique_no;
    乐观锁：  表新建version字段，update携带version字段作为区别标识
    
其他：     
    分布式锁： zookeeper 、 redis 
    token机制
    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="springboot项目中的日期问题"><a href="#springboot项目中的日期问题" class="header-anchor">#</a> springBoot项目中的日期问题</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>springboot 从数据库中取出来的日期，数据库字段定义的是timestamp，实体中定义的Date。
1.如果实体中是用String定义这个日期，那么前端接收到的是 ：2020-02-17 08:45:23.0，会发现多个一个 .0
    解决办法：使用Date定义。并且加上springBoot的日期配置

2.如果定义的Date，但是前端接的是：2020-02-17T08:45:23.000+0000
    解决方法：在配置文件中加上日期配置参数：
            spring.jackson.date-format=yyyy-MM-dd HH:mm:  #指定日期输出的格式
            spring.jackson.time-zone=GMT+8 #解决差八小时的问题

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>#【Spring-Cloud】</p> <p>#【SpringMVC】</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mengqizhang/java/jvm/jvm.html" class="prev">
        JVM
      </a></span> <span class="next"><a href="/mengqizhang/java/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">
        简介
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/mengqizhang/assets/js/app.a8d21a83.js" defer></script><script src="/mengqizhang/assets/js/2.e69c46bd.js" defer></script><script src="/mengqizhang/assets/js/17.8a25e983.js" defer></script>
  </body>
</html>
