(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{481:function(e,s,a){"use strict";a.r(s);var n=a(54),r=Object(n.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"rocketmq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq"}},[e._v("#")]),e._v(" rocketmq")]),e._v(" "),a("p",[e._v("RocketMQ是一个分布式消息和流数据平台，具有低延迟、高性能、高可靠性、万亿级容量和灵活的扩展性。RocketMQ是2012年阿里巴巴的第三代分布式消息中间件，\n2016年11月21日，阿里巴巴向阿Apache软件基金会捐赠了RocketMQ，实现了面向世界开源。第二年2月20日，Apache软件基金会宣布Apache RocketMQ成为顶级项目。")]),e._v(" "),a("h2",{attrs:{id:"核心概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#核心概念"}},[e._v("#")]),e._v(" 核心概念")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Topic ： 消息主题，一级消息类型，生产者向其发送消息")])]),e._v(" "),a("li",[a("p",[e._v("生产者 ： 负责生产消息发送消息至 Topic")])]),e._v(" "),a("li",[a("p",[e._v("消费者 ： 消息订阅者，负责从Topic接收消息，并且消费消息")])]),e._v(" "),a("li",[a("p",[e._v("消息  ：  数据和属性的组合")])]),e._v(" "),a("li",[a("p",[e._v("消息属性 ： 生产者可以为消息定义的属性，包含 Message Key 和 Tag")]),e._v(" "),a("ul",[a("li",[e._v("Message Key ： 消息业务的标识，唯一标识某个业务逻辑，可以根据设置的 Message Key进行查询")]),e._v(" "),a("li",[e._v("Tag ：  消息标签，二级消息类型，用来进一步区分某个 Topic下的消息分类，消费者可以通过 Tag对消息进行过滤")]),e._v(" "),a("li",[e._v("Message ID ： 消息的唯一标识，由RocketMQ服务自动生成")])])]),e._v(" "),a("li",[a("p",[e._v("Group ： 一类生产者 或 消费者，这类生产者或消费者通产是产生或者消费同一类消息，并且消息发布或订阅逻辑一致\nGroup ID ： group的id")])]),e._v(" "),a("li",[a("p",[e._v("Name Server ： 注册中心的角色，可以集群部署，负责管理 Broker的ip端口等元数据")])]),e._v(" "),a("li",[a("p",[e._v("Broker ： 负责处理消息、存储消息、转发消息。分为 MasterBroker、SlaveBroker，一个MasterBroker可以对应多个SlaveBroker\n但是，一个SlaveBroker只能对应一个MasterBroker。\nBroker启动后要完成一次将自己注册至Name Server的操作，长连接，每30s发送一条心跳（汇报topic路由信息）")])]),e._v(" "),a("li",[a("p",[e._v("分区 ： 即Topic Partition，物理上的概念。每个Topic包含一个或多个分区。")])])]),e._v(" "),a("h2",{attrs:{id:"应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[e._v("#")]),e._v(" 应用场景")]),e._v(" "),a("ul",[a("li",[e._v("应用解耦 ：\n用户注册动作，调用用户系统，注册成功后，发送短信（通知系统）、增加积分（积分系统）、邀请分销（分销系统）等，均可使用消息队列来做异步操作。\n若其中一个系统出现异常则无法完成注册流程。")]),e._v(" "),a("li",[e._v("流量削峰\n秒杀场景下只允许队列的部分用户进行秒杀，避免过多请求打到应用。")]),e._v(" "),a("li",[e._v("顺序收发\n"),a("ul",[a("li",[e._v("全区顺序：对于同一个topic，所有的消息都需要按照先进先出（FIFO）的顺序，进行顺序发布、顺序消费")]),e._v(" "),a("li",[e._v("分区顺序：对于同一个topic，所有的消息根据 Sharding key进行区块分区，同一个分区的消息按照FIFO顺序进行消息发送、消息消费。可以保证一个消息被一个进行消费")])])]),e._v(" "),a("li",[e._v("分布式事务一致性")]),e._v(" "),a("li",[e._v("分布式缓存同步： 电商系统中，每个商品的架构都会事实变化，使用缓存技术也无法满足对商品价格访问的需求。\n使用 RocketMQ的广播机制，一条消息可以被所有节点消息一次，相当于把最新的价格信息同步到了每台的机器上，取代了缓存的作用。")])]),e._v(" "),a("h2",{attrs:{id:"架构模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#架构模型"}},[e._v("#")]),e._v(" 架构模型")]),e._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"111",href:"rocketmq架构模型.png"}},[a("img",{attrs:{src:"rocketmq%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B.png",alt:"架构模型"}})])]),e._v(" "),a("ul",[a("li",[e._v("Name Server ： 注册中心的角色，可以集群部署，负责管理 Broker的ip端口等元数据")]),e._v(" "),a("li",[e._v("Broker ： 负责处理消息、存储消息、转发消息。分为 MasterBroker、SlaveBroker，一个MasterBroker可以对应多个SlaveBroker\n但是，一个SlaveBroker只能对应一个MasterBroker。\nBroker启动后要完成一次将自己注册至Name Server的操作，长连接，每30s发送一条心跳（汇报topic路由信息）")]),e._v(" "),a("li",[e._v("消息生产者：与Name Server中的其中一个节点（随机）建立连接 （长连接），定期从 Name server中读取 Topic路由信息，并向提供Topic服务的Master Broker建立长连接，定时向 Master Broker发送心跳包")]),e._v(" "),a("li",[e._v("消息消费者：与Name Server中的其中一个节点（随机）建立连接 （长连接），定期从 Name server中读取 Topic路由信息，并向提供Topic服务的Master Broker、 Slave Broker建立长连接，定时向 Master Broker、Slave Broker发送心跳包\n消息消费者既可以从Master Broker订阅消息，也可以从Slave Broker订阅消息，订阅规则由Broker配置决定。")])]),e._v(" "),a("h2",{attrs:{id:"普通消息发送的三种方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#普通消息发送的三种方式"}},[e._v("#")]),e._v(" 普通消息发送的三种方式")]),e._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"111",href:"普通消息-异步发送.png"}},[a("img",{attrs:{src:"%E4%B8%89%E7%A7%8D%E5%8F%91%E9%80%81%E6%96%B9%E5%BC%8F%E6%AF%94%E8%BE%83.png",alt:"img.png"}})])]),e._v(" "),a("ul",[a("li",[e._v("同步发送 （Sync） ： 指的消息发送方发出一条消息后，会收到RocketMQ服务端同步响应之后才发下一条消息的通讯方式。")])]),e._v(" "),a("ul",[a("li",[e._v("应用场景： 重要的邮件通知、报名短信通知、营销短信系统等\n"),a("a",{attrs:{"data-fancybox":"",title:"111",href:"普通消息-同步发送.png"}},[a("img",{attrs:{src:"%E6%99%AE%E9%80%9A%E6%B6%88%E6%81%AF-%E5%90%8C%E6%AD%A5%E5%8F%91%E9%80%81.png",alt:"img.png"}})])])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('SendResult sendResult = rocketMQTemplate.syncSend("broker-a", message);\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("ul",[a("li",[e._v("异步发送 （Async） ： 指的发送方发送消息后，不等RocketMQ服务端响应，就能发下一条消息的通讯方式。\n"),a("ul",[a("li",[e._v("应用场景： 异步发送一般用于链路耗时较长、对于响应时间较为敏感的场景，比如： 视频上传后通知启动转码服务，转码完成后推送转码通知等。")])])])]),e._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"111",href:"普通消息-异步发送.png"}},[a("img",{attrs:{src:"%E6%99%AE%E9%80%9A%E6%B6%88%E6%81%AF-%E5%BC%82%E6%AD%A5%E5%8F%91%E9%80%81.png",alt:"img_1.png"}})])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('rocketMQTemplate.asyncSend("broker-a", message, new SendCallback() {\n    @Override\n    public void onSuccess(SendResult sendResult) {\n        log.info("异步发送消息结果：{}",sendResult);\n    }\n\n    @Override\n    public void onException(Throwable throwable) {\n        log.info("异步发送消息异常：{}",throwable);\n    }\n});\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br")])]),a("ul",[a("li",[e._v("单向发送 （Oneway）:  发送方只负责发送消息，不等服务端返回响应且没有回调函数出发，即只发送请求不等待应答，此方式耗时非常短，一般在微秒级别")])]),e._v(" "),a("ul",[a("li",[e._v("应用场景： 适用于耗时非常短，但是对可靠型要求不高的场景 ：比如 ： 日志收集")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('rocketMQTemplate.sendOneWay("broker-a", message);\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[a("a",{attrs:{"data-fancybox":"",title:"111",href:"普通消息-单向发送.png"}},[a("img",{attrs:{src:"%E6%99%AE%E9%80%9A%E6%B6%88%E6%81%AF-%E5%8D%95%E5%90%91%E5%8F%91%E9%80%81.png",alt:"img_2.png"}})])]),e._v(" "),a("h2",{attrs:{id:"定时消息和延迟消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定时消息和延迟消息"}},[e._v("#")]),e._v(" 定时消息和延迟消息")]),e._v(" "),a("p",[e._v("定时消息：Producer将消息发送到RocketMQ服务端，但是不希望立马投递这条消息，而是推迟到当前时间后的后某一个时间再投递给Consumer进行消费。\n延迟消息：Producer将消息发送到RocketMQ服务端，但是不希望立马投递这条消息，而是延迟一定时间后再投递给Consumer进行消费。")]),e._v(" "),a("p",[e._v("使用场景： 购物车的商品 30分钟失效、订单送到后7天内自动确认收货")]),e._v(" "),a("h2",{attrs:{id:"顺序消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#顺序消息"}},[e._v("#")]),e._v(" 顺序消息")]),e._v(" "),a("p",[e._v("顺序消息常用于金融证券、电商业务对于消息指令顺序有严格要求的场景。\n顺序消息指的是消息队列的消息对于一个指定的Topic，消息严格按照先进先出（FIFO）的规则进行消息发布和消息消费。即先发布的先消费，后发布的后消费\n顺序消息分为 分区顺序消息 和 全局顺序消息")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("全局顺序消息：对于同一个topic，所有的消息都需要按照先进先出（FIFO）的顺序，进行顺序发布、顺序消费")])]),e._v(" "),a("li",[a("p",[e._v("分区顺序消费：对于同一个topic，所有的消息根据 Sharding key进行区块分区，同一个分区的消息按照FIFO顺序进行消息发送、消息消费。可以保证一个消息被一个进行消费")])])]),e._v(" "),a("h2",{attrs:{id:"集群消费-和-广播消费"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集群消费-和-广播消费"}},[e._v("#")]),e._v(" 集群消费 和 广播消费")]),e._v(" "),a("p",[e._v("消费者使用相同的Group ID属于同一个集群，同一个集群下的消费者消费逻辑必须一致（包含Tag的使用）。")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("集群消费 ： 任意一条消息只要被消费者集群（相同的Group ID）中任意一个消费处理几个")]),e._v(" "),a("ul",[a("li",[e._v("适用场景： 适合消费端集群部署的情况下，每条消息只需要被处理一次的场景")])])]),e._v(" "),a("li",[a("p",[e._v("广播消费 ： 会将消息推送给集群内的的所有消费者，保证至少每个消费者都能消费一次")]),e._v(" "),a("ul",[a("li",[e._v("适用场景：适合消费端集群部署的情况下，每条消费都要被集群下的每个消费者处理的场景")])])])]),e._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"111",href:"集群消费和广播消费.png"}},[a("img",{attrs:{src:"%E9%9B%86%E7%BE%A4%E6%B6%88%E8%B4%B9%E5%92%8C%E5%B9%BF%E6%92%AD%E6%B6%88%E8%B4%B9.png",alt:"img.png"}})])]),e._v(" "),a("h2",{attrs:{id:"消息过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消息过滤"}},[e._v("#")]),e._v(" 消息过滤")]),e._v(" "),a("p",[e._v("-表达式过滤：")]),e._v(" "),a("ul",[a("li",[e._v('Tag过滤:\n消费者 ：配置消息过滤规则，selectorType = SelectorType.TAG , selectorExpression = "tag1||tag2"')])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('@Component\n@RocketMQMessageListener(consumerGroup = "mengqizhang-group",\n        topic = "mengqizhang",\n        selectorExpression = "tag1||tag2",\n        selectorType = SelectorType.TAG)\n@Slf4j\npublic class ConsumerFilter implements RocketMQListener<MessageExt> {\n    @Override\n    public void onMessage(MessageExt message) {\n        String tag = message.getTags();\n        String msg = new String(message.getBody());\n        log.info("tag: {},msg :{} ",tag,msg);\n    }\n}\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br")])]),a("p",[e._v("生产者 ：添加tag，使用topic:tag的方式")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('rocketMQTemplate.syncSend("topic:tag1",MessageBuilder.withPayload("消息过滤tag1").build());\nrocketMQTemplate.syncSend("topic:tag2",MessageBuilder.withPayload("消息过滤tag2").build());\nrocketMQTemplate.syncSend("topic:tag3",MessageBuilder.withPayload("消息过滤tag3").build());\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("ul",[a("li",[e._v("SQL过滤")])]),e._v(" "),a("ul",[a("li",[e._v("表达式")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("数字比较，如>，>=，<，<=，BETWEEN，=；\n字符比较，如：=，<>，IN；\nIS NULL or IS NOT NULL;\n逻辑运算符：AND, OR, NOT;\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("常量类型:\n数值，如：123, 3.1415；\n字符, 如：‘abc’, 必须使用单引号;\nNULL，特殊常量\nBoolean, TRUE or FALSE;\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("ul",[a("li",[e._v("生产者")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('rocketMQTemplate.convertAndSend("mengqizhang-sql-topic",MessageBuilder.withPayload("sql92过滤：mengqizhang在广州").build(),new HashMap<String,Object>(){{put("name","mengqizhang");put("address","guangzhou");}});\nrocketMQTemplate.convertAndSend("mengqizhang-sql-topic",MessageBuilder.withPayload("sql92过滤：mengqizhang在杭州").build(),new HashMap<String,Object>(){{put("name","mengqizhang");put("address","hangzhou");}});\nrocketMQTemplate.convertAndSend("mengqizhang-sql-topic",MessageBuilder.withPayload("sql92过滤：mengqizhang在赣州").build(),new HashMap<String,Object>(){{put("name","mengqizhang");put("address","ganzhou");}});\nrocketMQTemplate.convertAndSend("mengqizhang-sql-topic",MessageBuilder.withPayload("sql92过滤：mengqizhang在珠海").build(),new HashMap<String,Object>(){{put("name","mengqizhang");put("address","zhuhai");}});\n\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("ul",[a("li",[e._v("消费者")])]),e._v(" "),a("p",[e._v("selectorType：指明了消息过滤使用SQL92方式\nselectorExpression：指明了只能接收消息属性（header）中a=1的消息， 默认值*，代表全部\nmessageModel:指明了消息消费的模式，\n默认值为MessageModel.CLUSTERING（每条消息只能有一个消费者进行消费）；\nMessageModel.BROADCASTING(广播消息，所有订阅者都能收到消息)")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('@Component\n@RocketMQMessageListener(consumerGroup = "mengqizhang-sql-group",\n        topic = "mengqizhang-sql-topic",\n        messageModel = MessageModel.BROADCASTING,\n        selectorExpression = "name= \'mengqizhang\' AND address = \'hangzhou\' ",\n        selectorType = SelectorType.SQL92)\n@Slf4j\npublic class ConsumerFilterSQL implements RocketMQListener<MessageExt> {\n    @Override\n    public void onMessage(MessageExt message) {\n        String tag = message.getTags();\n        String msg = new String(message.getBody());\n        log.info("sql filter : {},msg :{} ",tag,msg);\n    }\n}\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br")])]),a("p",[e._v("问题:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Caused by: java.lang.IllegalStateException: Failed to start RocketMQ push consumer\n\tat org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer.start(DefaultRocketMQListenerContainer.java:281) ~[rocketmq-spring-boot-2.1.1.jar:2.1.1]\n\tat org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration.registerContainer(ListenerContainerConfiguration.java:120) ~[rocketmq-spring-boot-2.1.1.jar:2.1.1]\n\t... 13 common frames omitted\nCaused by: org.apache.rocketmq.client.exception.MQClientException: CODE: 1  DESC: The broker does not support consumer to filter message by SQL92\nFor more information, please visit the url, http://rocketmq.apache.org/docs/faq/\n\tat org.apache.rocketmq.client.impl.MQClientAPIImpl.checkClientInBroker(MQClientAPIImpl.java:2240) ~[rocketmq-client-4.7.1.jar:4.7.1]\n\tat org.apache.rocketmq.client.impl.factory.MQClientInstance.checkClientInBroker(MQClientInstance.java:449) ~[rocketmq-client-4.7.1.jar:4.7.1]\n\tat org.apache.rocketmq.client.impl.consumer.DefaultMQPushConsumerImpl.start(DefaultMQPushConsumerImpl.java:654) ~[rocketmq-client-4.7.1.jar:4.7.1]\n\tat org.apache.rocketmq.client.consumer.DefaultMQPushConsumer.start(DefaultMQPushConsumer.java:698) ~[rocketmq-client-4.7.1.jar:4.7.1]\n\tat org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer.start(DefaultRocketMQListenerContainer.java:279) ~[rocketmq-spring-boot-2.1.1.jar:2.1.1]\n\t... 14 common frames omitted    \n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br")])]),a("p",[e._v("解决 ： 默认情况下broke没有开启对SQL语法的支持，需要修改配置，配置 broker.conf")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("enablePropertyFilter=true\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h1",{attrs:{id:"rocketmq-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq-2"}},[e._v("#")]),e._v(" RocketMQ")]),e._v(" "),a("h2",{attrs:{id:"server和broker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#server和broker"}},[e._v("#")]),e._v(" server和broker")]),e._v(" "),a("p",[e._v("server ： 保存broker的信息，ip，端口，等元数据信息（类似注册中心）\nbroker ： 实际处理消息")]),e._v(" "),a("h2",{attrs:{id:"启动-namesrv"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动-namesrv"}},[e._v("#")]),e._v(" 启动 namesrv")]),e._v(" "),a("p",[e._v("nohup sh bin/mqnamesrv -n 192.168.2.11:9876 > server.out &")]),e._v(" "),a("h2",{attrs:{id:"启动-broker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动-broker"}},[e._v("#")]),e._v(" 启动 broker")]),e._v(" "),a("p",[e._v("nohup sh bin/mqbroker ‐n 192.168.2.11:9876 autoCreateTopicEnable=true ‐c conf/broker.conf > broker.out &")]),e._v(" "),a("ul",[a("li",[e._v("conf/broker.conf\n编辑broker配置文件 conf/broker.conf")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("namesrvAddr=127.0.0.1:9876\nbrokerIP1=192.168.2.11\nbrokerClusterName = DefaultCluster\nbrokerName = broker-a\nbrokerId = 0\ndeleteWhen = 04\nfileReservedTime = 48\nbrokerRole = ASYNC_MASTER\nflushDiskType = ASYNC_FLUSH\nautoCreateTopicEnable=true\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br")])]),a("h2",{attrs:{id:"停止-namesrv-和-broker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#停止-namesrv-和-broker"}},[e._v("#")]),e._v(" 停止 namesrv 和 broker")]),e._v(" "),a("p",[e._v("sh bin/mqshutdown broker")]),e._v(" "),a("p",[e._v("sh bin/mqshutdown namesrv")]),e._v(" "),a("h2",{attrs:{id:"测试启动消息生产者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试启动消息生产者"}},[e._v("#")]),e._v(" 测试启动消息生产者")]),e._v(" "),a("p",[e._v('export NAMESRV_ADDR="localhost:9876"\nsh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer')]),e._v(" "),a("h2",{attrs:{id:"控制面板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#控制面板"}},[e._v("#")]),e._v(" 控制面板")]),e._v(" "),a("p",[e._v("docker pull apacherocketmq/rocketmq-dashboard:latest")]),e._v(" "),a("p",[e._v('docker run -d --name rocketmq-dashboard-MQZ -e "JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.2.11:9876" -p 8080:8080 -t apacherocketmq/rocketmq-dashboard:latest')]),e._v(" "),a("h2",{attrs:{id:"docker-启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-启动"}},[e._v("#")]),e._v(" docker 启动")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('version: \'3.5\'\nservices:\n  rmqnamesrv:\n    image: rocketmqinc/rocketmq\n    container_name: rmqnamesrv\n    restart: always\n    ports:\n      - 9876:9876\n    environment:\n      JAVA_OPT_EXT: "-server -Xms1g -Xmx1g"\n    volumes:\n      - ./logs:/root/logs\n    command: sh mqnamesrv\n    networks:\n      rmq:\n        aliases:\n          - rmqnamesrv\n          \n  rmqbroker:\n    image: rocketmqinc/rocketmq\n    container_name: rmqbroker\n    restart: always\n    depends_on:\n      - rmqnamesrv\n    ports:\n      - 10909:10909\n      - 10911:10911\n    volumes:\n      - ./logs:/root/logs\n      - ./store:/root/store\n      - /root/mqz/rocketmq/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf\n    command: sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf\n    environment:\n      NAMESRV_ADDR: "rmqnamesrv:9876"\n      JAVA_OPT_EXT: "-server -Xms1g -Xmx1g -Xmn1g"\n    networks:\n      rmq:\n        aliases:\n          - rmqbroker\n          \n  rmqconsole:\n    image: styletang/rocketmq-console-ng\n    container_name: rocketmq-console\n    restart: always\n    ports:\n      - 8080:8080\n    depends_on:\n      - rmqnamesrv\n    volumes:\n      - /etc/localtime:/etc/localtime:ro\n      - /home/rocketmq/console/logs:/root/logs\n    environment:\n      JAVA_OPTS: "-Drocketmq.namesrv.addr=rmqnamesrv:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false"\n    networks:\n      rmq:\n        aliases:\n          - rmqconsole\n          \nnetworks:\n  rmq:\n    name: rmq\n    driver: bridge\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br"),a("span",{staticClass:"line-number"},[e._v("29")]),a("br"),a("span",{staticClass:"line-number"},[e._v("30")]),a("br"),a("span",{staticClass:"line-number"},[e._v("31")]),a("br"),a("span",{staticClass:"line-number"},[e._v("32")]),a("br"),a("span",{staticClass:"line-number"},[e._v("33")]),a("br"),a("span",{staticClass:"line-number"},[e._v("34")]),a("br"),a("span",{staticClass:"line-number"},[e._v("35")]),a("br"),a("span",{staticClass:"line-number"},[e._v("36")]),a("br"),a("span",{staticClass:"line-number"},[e._v("37")]),a("br"),a("span",{staticClass:"line-number"},[e._v("38")]),a("br"),a("span",{staticClass:"line-number"},[e._v("39")]),a("br"),a("span",{staticClass:"line-number"},[e._v("40")]),a("br"),a("span",{staticClass:"line-number"},[e._v("41")]),a("br"),a("span",{staticClass:"line-number"},[e._v("42")]),a("br"),a("span",{staticClass:"line-number"},[e._v("43")]),a("br"),a("span",{staticClass:"line-number"},[e._v("44")]),a("br"),a("span",{staticClass:"line-number"},[e._v("45")]),a("br"),a("span",{staticClass:"line-number"},[e._v("46")]),a("br"),a("span",{staticClass:"line-number"},[e._v("47")]),a("br"),a("span",{staticClass:"line-number"},[e._v("48")]),a("br"),a("span",{staticClass:"line-number"},[e._v("49")]),a("br"),a("span",{staticClass:"line-number"},[e._v("50")]),a("br"),a("span",{staticClass:"line-number"},[e._v("51")]),a("br"),a("span",{staticClass:"line-number"},[e._v("52")]),a("br"),a("span",{staticClass:"line-number"},[e._v("53")]),a("br"),a("span",{staticClass:"line-number"},[e._v("54")]),a("br"),a("span",{staticClass:"line-number"},[e._v("55")]),a("br"),a("span",{staticClass:"line-number"},[e._v("56")]),a("br"),a("span",{staticClass:"line-number"},[e._v("57")]),a("br"),a("span",{staticClass:"line-number"},[e._v("58")]),a("br"),a("span",{staticClass:"line-number"},[e._v("59")]),a("br"),a("span",{staticClass:"line-number"},[e._v("60")]),a("br"),a("span",{staticClass:"line-number"},[e._v("61")]),a("br"),a("span",{staticClass:"line-number"},[e._v("62")]),a("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);