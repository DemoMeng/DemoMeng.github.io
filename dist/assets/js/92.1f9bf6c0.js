(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{486:function(s,a,n){"use strict";n.r(a);var t=n(54),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"rabbitmq"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq"}},[s._v("#")]),s._v(" Rabbitmq")]),s._v(" "),n("p",[s._v("Rabbitmq本身是基于 Erlang编写的，Erlang 语言天生就具有分布式的特性（.erlange.cookie实现集群并且集群节点的通信）")]),s._v(" "),n("h1",{attrs:{id:"rabbitmq集群和高可用方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq集群和高可用方案"}},[s._v("#")]),s._v(" RabbitMQ集群和高可用方案")]),s._v(" "),n("ul",[n("li",[s._v("普通集群模式")]),s._v(" "),n("li",[s._v("镜像复制模式")])]),s._v(" "),n("h2",{attrs:{id:"普通集群模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#普通集群模式"}},[s._v("#")]),s._v(" 普通集群模式")]),s._v(" "),n("p",[s._v("每台机器中部署一个RabbitMQ服务节点，进而由多个机器组成一个RabbitMQ集群\n普通模式中，消息数据是不会同步的，因为它们之间只同步 元数据，元数据中不包含消息数据。\n若 客户端连接到 A节点，但是消息又在 B节点。这种情况下，普通集群模式无法实现消息在节点中的转发，\n所以普通集群模式无法实现高可用，在这种情况下，可以使用镜像复制模式实现这种需求。")]),s._v(" "),n("p",[s._v("流程图\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"普通集群模式.png"}},[n("img",{attrs:{src:"%E6%99%AE%E9%80%9A%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F.png",alt:"img.png"}})])]),s._v(" "),n("p",[s._v("元数据包含：（不包含消息）\n队列元数据： 队列名称、属性等\n交换器数据： 交换器名称、属性\n绑定元数据： 交换器绑定队列数据、交换器和交换器绑定数据\nvhost元数据： vhost内的队列、和交换器绑定的数据、命名空间、安全属性之间的绑定关系数据")]),s._v(" "),n("h2",{attrs:{id:"镜像复制模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#镜像复制模式"}},[s._v("#")]),s._v(" 镜像复制模式")]),s._v(" "),n("p",[s._v("镜像复制模式是在普通集群模式基础上，通过 policy 模块来实现，使用镜像复制模式可以实现RabbitMQ的高可用方案\n流程图\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"镜像复制模式.png"}},[n("img",{attrs:{src:"%E9%95%9C%E5%83%8F%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F.png",alt:"img.png"}})])]),s._v(" "),n("p",[s._v("镜像复制模式相比于普通集群模式，会占用比较多的带宽，因为需要实现主节点到从节点的数据复制，所以镜像复制模式吞吐量会稍逊普通模式，\n但是普通模式不能实现高可用，某个节点挂掉之后后，这个节点上的消息无法被消费，需要等待节点启动后才能被消费")]),s._v(" "),n("h2",{attrs:{id:"节点类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#节点类型"}},[s._v("#")]),s._v(" 节点类型")]),s._v(" "),n("p",[s._v("ram：内存节点 元数据存在内存中。如果消息持久化会存放在磁盘中，因为内存节点的读取速度块，一般客户端会连接内存节点\ndisc：磁盘节点 默认节点类型，需要保证至少一个磁盘节点，否则一旦宕机，则无法恢复数据，从而无法达到高可用！")]),s._v(" "),n("h2",{attrs:{id:"普通集群模式搭建步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#普通集群模式搭建步骤"}},[s._v("#")]),s._v(" 普通集群模式搭建步骤")]),s._v(" "),n("ul",[n("li",[s._v("3台centos7服务器：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("192.168.2.9\n192.168.2.11\n192.168.2.7\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("修改host文件")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("192.168.2.9 rabbit_host11\n192.168.2.11 rabbit_host22\n192.168.2.7 rabbit_host33\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("或者单独设置每台机器的：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("hostnamectl set-hostname rabbit_host11\nhostnamectl set-hostname rabbit_host22\nhostnamectl set-hostname rabbit_host33\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[n("p",[s._v("docker-compose 安装rabbitmq，参考 yml 配置文件。先后启动 rabbitmq1 、 rabbitmq2 、 rabbitmq3")])]),s._v(" "),n("li",[n("p",[s._v("统一三个rabbitmq的 /var/lib/rabbitmq/.erlang.cookie （也可能是在 $HOME/.erlang.cookie 目录） 文件，注意它是一个隐藏文件，就像我电脑里又隐藏的 .avi 文件一样🐶\nRabbitMQ 的集群是依赖 erlang 集群，而 erlang 集群是通过这个 cookie 进行通信认证\n将rabbitmq2 、 rabbitmq3 的 .erlang.cookie文件内容以 rabbitmq1的为主，拷贝时需要停止rabbitmq实例\n注意权限 ： chmod 600 /var/lib/rabbitmq/.erlang.cookie ，否则加入集群会报错\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"rabbitmq开启插件.png"}},[n("img",{attrs:{src:"erlang.cookie%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90.png",alt:"img.png"}})]),s._v("\n随后重启rabbitmq： docker restart rabbitmq1 \\ rabbitmq2 \\ rabbitmq3")])]),s._v(" "),n("li",[n("p",[s._v("主节点执行：需要清空之前单机信息，docker则清空挂载的配置文件\nrabbitmqctl stop_app\nrabbitmqctl reset\nrabbitmqctl start_app")])]),s._v(" "),n("li",[n("p",[s._v("从节点： 执行前需要停止该 rabbitmq 即 rabbitmqctl stop_app")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("rabbitmqctl [-n nodename] join_cluster {cluster_node} [—ram]\nrabbitmqctl stop_app\nrabbitmqctl reset 如果节点类型为 disc的时候需要执行\nrabbitmqctl join_cluster --ram rabbit@rabbit_host11 或者 rabbitmqctl join_cluster --disc rabbit@rabbit_host11\nrabbitmqctl start_app\n\n\n如果节点以磁盘节点的形式加入，则需要先使用 rabbitmqctl reset 命令进行重置，然后才能加入现有群集，重置节点会删除该节点上存在的所有的历史资源和数据。\n采用内存节点的形式加入时可以略过 reset 这一步，因为内存上的数据本身就不是持久化的\n--ram 表示这是一个内存节点: 所有数据都存在内存中\n--disc表示磁盘节点（默认也是磁盘节点）：所有数据都存在磁盘中\n-n nodename： 指定需要操作的目标节点\ncluster_node：需要加入的集群节点名\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"rabbitmq管理界面.png"}},[n("img",{attrs:{src:"rabbitmq%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2.png",alt:"img.png"}})])]),s._v(" "),n("h2",{attrs:{id:"主节点执行-查看节点状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主节点执行-查看节点状态"}},[s._v("#")]),s._v(" 主节点执行 - 查看节点状态")]),s._v(" "),n("p",[s._v("rabbitmqctl status")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\nStatus of node rabbit@rabbit_host11 ...\nRuntime\n\nOS PID: 19\nOS: Linux\nUptime (seconds): 3319\nIs under maintenance?: false\nRabbitMQ version: 3.10.1\nNode name: rabbit@rabbit_host11\nErlang configuration: Erlang/OTP 24 [erts-12.3.2] [source] [64-bit] [smp:2:2] [ds:2:2:10] [async-threads:1] [jit]\nErlang processes: 444 used, 1048576 limit\nScheduler run queue: 1\nCluster heartbeat timeout (net_ticktime): 60\n\nPlugins\n\nEnabled plugin file: /etc/rabbitmq/enabled_plugins\nEnabled plugins:\n\n * rabbitmq_delayed_message_exchange\n * rabbitmq_prometheus\n * prometheus\n * accept\n * rabbitmq_management\n * amqp_client\n * rabbitmq_web_dispatch\n * cowboy\n * cowlib\n * rabbitmq_management_agent\n\nData directory\n\nNode data directory: /var/lib/rabbitmq/mnesia/rabbit@rabbit_host11\nRaft data directory: /var/lib/rabbitmq/mnesia/rabbit@rabbit_host11/quorum/rabbit@rabbit_host11\n\nConfig files\n\n * /etc/rabbitmq/conf.d/10-defaults.conf\n\nLog file(s)\n\n * /var/log/rabbitmq/rabbit@rabbit_host11_upgrade.log\n * <stdout>\n\nAlarms\n\n(none)\n\nMemory\n\nTotal memory used: 0.1404 gb\nCalculation strategy: rss\nMemory high watermark setting: 0.4 of available memory, computed to: 3.2409 gb\n\nreserved_unallocated: 0.0678 gb (48.27 %)\ncode: 0.0357 gb (25.39 %)\nother_system: 0.0252 gb (17.93 %)\nother_proc: 0.0189 gb (13.43 %)\nother_ets: 0.0033 gb (2.37 %)\nplugins: 0.0032 gb (2.28 %)\natom: 0.0014 gb (1.02 %)\nmgmt_db: 0.0011 gb (0.8 %)\nbinary: 9.0e-4 gb (0.64 %)\nconnection_other: 4.0e-4 gb (0.25 %)\nmetrics: 3.0e-4 gb (0.19 %)\nqueue_procs: 2.0e-4 gb (0.11 %)\nmnesia: 1.0e-4 gb (0.1 %)\nconnection_readers: 1.0e-4 gb (0.07 %)\nmsg_index: 0.0 gb (0.02 %)\nconnection_channels: 0.0 gb (0.02 %)\nquorum_ets: 0.0 gb (0.02 %)\nconnection_writers: 0.0 gb (0.01 %)\nquorum_queue_dlx_procs: 0.0 gb (0.0 %)\nstream_queue_procs: 0.0 gb (0.0 %)\nstream_queue_replica_reader_procs: 0.0 gb (0.0 %)\nallocated_unused: 0.0 gb (0.0 %)\nqueue_slave_procs: 0.0 gb (0.0 %)\nquorum_queue_procs: 0.0 gb (0.0 %)\nstream_queue_coordinator_procs: 0.0 gb (0.0 %)\n\nFile Descriptors\n\nTotal: 5, limit: 1048479\nSockets: 2, limit: 943629\n\nFree Disk Space\n\nLow free disk space watermark: 0.05 gb\nFree disk space: 5.5612 gb\n\nTotals\n\nConnection count: 2\nQueue count: 6\nVirtual host count: 1\n\nListeners\n\nInterface: [::], port: 15672, protocol: http, purpose: HTTP API\nInterface: [::], port: 15692, protocol: http/prometheus, purpose: Prometheus exporter API over HTTP\nInterface: [::], port: 25672, protocol: clustering, purpose: inter-node and CLI tool communication\nInterface: [::], port: 5672, protocol: amqp, purpose: AMQP 0-9-1 and AMQP 1.0\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br")])]),n("h2",{attrs:{id:"主节点执行-查看集群状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主节点执行-查看集群状态"}},[s._v("#")]),s._v(" 主节点执行 - 查看集群状态")]),s._v(" "),n("p",[s._v("rabbitmqctl cluster_status")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("root@rabbit_host11:/# rabbitmqctl cluster_status\nCluster status of node rabbit@rabbit_host11 ...\nBasics\n\nCluster name: rabbit@rabbit_host11\n\nDisk Nodes\n\nrabbit@rabbit_host11\nrabbit@rabbit_host22\n\nRunning Nodes\n\nrabbit@rabbit_host11\nrabbit@rabbit_host22\n\nVersions\n\nrabbit@rabbit_host11: RabbitMQ 3.10.1 on Erlang 24.3.4\nrabbit@rabbit_host22: RabbitMQ 3.10.1 on Erlang 24.3.4\n\nMaintenance status\n\nNode: rabbit@rabbit_host11, status: not under maintenance\nNode: rabbit@rabbit_host22, status: not under maintenance\n\nAlarms\n\n(none)\n\nNetwork Partitions\n\n(none)\n\nListeners\n\nNode: rabbit@rabbit_host11, interface: [::], port: 15672, protocol: http, purpose: HTTP API\nNode: rabbit@rabbit_host11, interface: [::], port: 15692, protocol: http/prometheus, purpose: Prometheus exporter API over HTTP\nNode: rabbit@rabbit_host11, interface: [::], port: 25672, protocol: clustering, purpose: inter-node and CLI tool communication\nNode: rabbit@rabbit_host11, interface: [::], port: 5672, protocol: amqp, purpose: AMQP 0-9-1 and AMQP 1.0\nNode: rabbit@rabbit_host22, interface: [::], port: 15672, protocol: http, purpose: HTTP API\nNode: rabbit@rabbit_host22, interface: [::], port: 15692, protocol: http/prometheus, purpose: Prometheus exporter API over HTTP\nNode: rabbit@rabbit_host22, interface: [::], port: 25672, protocol: clustering, purpose: inter-node and CLI tool communication\nNode: rabbit@rabbit_host22, interface: [::], port: 5672, protocol: amqp, purpose: AMQP 0-9-1 and AMQP 1.0\n\nFeature flags\n\nFlag: classic_mirrored_queue_version, state: enabled\nFlag: drop_unroutable_metric, state: enabled\nFlag: empty_basic_get_metric, state: enabled\nFlag: implicit_default_bindings, state: enabled\nFlag: maintenance_mode_status, state: enabled\nFlag: quorum_queue, state: enabled\nFlag: stream_queue, state: enabled\nFlag: user_limits, state: enabled\nFlag: virtual_host_metadata, state: enabled\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br")])]),n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"查看已安装的插件.png"}},[n("img",{attrs:{src:"%E6%9F%A5%E7%9C%8B%E5%B7%B2%E5%AE%89%E8%A3%85%E7%9A%84%E6%8F%92%E4%BB%B6.png",alt:"查看已安装的插件.png"}})])]),s._v(" "),n("h2",{attrs:{id:"镜像复制模式-高可用模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#镜像复制模式-高可用模式"}},[s._v("#")]),s._v(" 镜像复制模式-高可用模式")]),s._v(" "),n("ul",[n("li",[s._v("镜像队列模式相比较普通模式，镜像模式会占用更多的带宽来进行同步，所以镜像队列的吞吐量会低于普通模式。\n但普通模式不能实现高可用，某个节点挂了后，这个节点上的消息将无法被消费，需要等待节点启动后才能被消费。")]),s._v(" "),n("li",[s._v("需要使用 policy 模块，policy主要用于设置 Exchange 或者 Queue 的数据需要如何复制，同步到其他节点")]),s._v(" "),n("li",[s._v('设置主节点同步从节点 交换机、队列的策略规则\n1.命令： rabbitmqctl set_policy -p / ha "^" \'{"ha-mode":"all"}\''),n("br"),s._v('\nrabbitmqctl -n rabbit1 set_policy ha-all "^" \'{"ha-mode":"all"}\'')])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('ha ： 策略名称\n^  ： 匹配规则， ^ 则表示匹配所有 ^Q 则匹配名字\n{"ha-mode":"exactly","ha-params":2} ： 是策略的定义， ha-mode和ha-params组合使用\n\n            ha-mode   ha-params   说明 \n             all      （empty）   队列镜像到集群所有节点\n             exactly   int值      队列镜像到集群内指定数量节点，若集群内节点数少于该值，队列将会镜像到所有节点，若大于该值，而且一个包含镜像的节点停止，则新的镜像不会在其他节点创建\n             nodes     节点名称    队列镜像到指定节点，指定节点不在集群中不会报错，当队列申明时候，如果指定节点不在线，则队列会被创建在客户端连接的节点上\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v('设置策略匹配所有名称是amp开头的队列都存储在2个节点上的命令如下\nrabbitmqctl set_policy -p / ha "^amp*" \'{"ha-mode":"exactly","ha-params":2}\'')]),s._v(" "),n("li",[s._v('设置策略匹配所有名称的队列都进行高可用配置\nrabbitmqctl set_policy -p / ha "^" \'{"ha-mode":"all","ha-sync-mode":"automatic"}\'')]),s._v(" "),n("li",[s._v("查询策略 #查看vhost下的所有的策略（policies ）\nrabbitmqctl list_policies -p /")])]),s._v(" "),n("p",[s._v("2.web管理界面方式："),n("br"),s._v(" "),n("a",{attrs:{"data-fancybox":"",title:"111",href:"镜像复模式配置policy.png"}},[n("img",{attrs:{src:"%E9%95%9C%E5%83%8F%E5%A4%8D%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AEpolicy.png",alt:"img.png"}})])]),s._v(" "),n("h2",{attrs:{id:"集群的关闭和重启"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#集群的关闭和重启"}},[s._v("#")]),s._v(" 集群的关闭和重启")]),s._v(" "),n("p",[s._v("无法一条命令关闭或重启集群，需要一一进行操作！\n假设在一个三节点的集群当中，关闭的顺序为 node1，node2，node3，如果 node1 因为故障暂时没法恢复，此时 node2 和 node3 就无法启动。想要解决这个问题，可以先将 node1 节点进行剔除，命令如下：\nrabbitmqctl forget_cluster_node rabbit@node1 --offline  # --offline ： 允许节点在自己没有启动的情况下可以将其他节点删除")]),s._v(" "),n("p",[s._v("rabbitmqctl forget_cluster_node rabbit@node1 ： 强制删除节点出集群")]),s._v(" "),n("ul",[n("li",[s._v("解除集群 （主、从）\nrabbitmqctl stop_app\nrabbitmqctl reset\nrabbitmqctl start_app")])]),s._v(" "),n("h1",{attrs:{id:"基于-haproxy-keepalived-高可用集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基于-haproxy-keepalived-高可用集群"}},[s._v("#")]),s._v(" 基于 HAProxy + Keepalived 高可用集群")])])}),[],!1,null,null,null);a.default=e.exports}}]);