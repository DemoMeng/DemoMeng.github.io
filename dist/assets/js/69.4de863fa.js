(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{456:function(s,n,l){"use strict";l.r(n);var a=l(54),i=Object(a.a)({},(function(){var s=this,n=s.$createElement,l=s._self._c||n;return l("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[l("h1",{attrs:{id:"binlog日志-binary-log"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#binlog日志-binary-log"}},[s._v("#")]),s._v(" binlog日志 binary log")]),s._v(" "),l("ul",[l("li",[l("p",[s._v("定义")]),s._v(" "),l("ul",[l("li",[s._v("也可以叫做变更日志（update log），主要用于记录数据库变化的过程，即DDL（数据库表操作语言 create table、alter、drop、truncate）、DML（数据操作语言 insert、delete、update）")])])]),s._v(" "),l("li",[l("p",[s._v("默认binary log是关闭的，show variables like 'log_bin'")])])]),s._v(" "),l("div",{staticClass:"language- line-numbers-mode"},[l("pre",{pre:!0,attrs:{class:"language-text"}},[l("code",[s._v("mysql> show variables like '%log_bin%';\n+---------------------------------+--------------------------------------------+\n| Variable_name                   | Value                                      |\n+---------------------------------+--------------------------------------------+\n| log_bin                         | ON                                         |\n| log_bin_basename                | /var/lib/mysql/mall-mysql-slave1-bin       |\n| log_bin_index                   | /var/lib/mysql/mall-mysql-slave1-bin.index |\n| log_bin_trust_function_creators | OFF                                        |\n| log_bin_use_v1_row_events       | OFF                                        |\n| sql_log_bin                     | ON                                         |\n+---------------------------------+--------------------------------------------+\n6 rows in set (0.00 sec)\n\nlog_bin: ON:binary log打开状态，OFF：关闭状态\nlog_bin_basename： binary log的前缀名，第一次文件名为：mall-mysql-slave1-bin.000001，当清除一次主从关系、重启一次mysql，binary log文件名都会发生比变化\nlog_bin_index： binary log索引文件\nlog_bin_trust_function_creators: 开启binarylog后为了保证主从复制数据一致，而显示对存储函数的创建，删除和调用\nlog_bin_use_v1_row_events： 该参数代表binlog的版本信息，从5.6默认使用version2，所以该参数默认OFF\nsql_log_bin: 是否需要把sql记录到binarylog，当开启了主从复制后，有一条sql我们希望master数据库更新，而不复制到slave数据库，那么设置sql_log_bin可以解决\n             使用： master mysql>set sql_log_bin=0;  0代表OFF ，1代表ON\n                   master mysql>source xxoo.sql;\n             注意： 本命令只对session生效。\n")])]),s._v(" "),l("div",{staticClass:"line-numbers-wrapper"},[l("span",{staticClass:"line-number"},[s._v("1")]),l("br"),l("span",{staticClass:"line-number"},[s._v("2")]),l("br"),l("span",{staticClass:"line-number"},[s._v("3")]),l("br"),l("span",{staticClass:"line-number"},[s._v("4")]),l("br"),l("span",{staticClass:"line-number"},[s._v("5")]),l("br"),l("span",{staticClass:"line-number"},[s._v("6")]),l("br"),l("span",{staticClass:"line-number"},[s._v("7")]),l("br"),l("span",{staticClass:"line-number"},[s._v("8")]),l("br"),l("span",{staticClass:"line-number"},[s._v("9")]),l("br"),l("span",{staticClass:"line-number"},[s._v("10")]),l("br"),l("span",{staticClass:"line-number"},[s._v("11")]),l("br"),l("span",{staticClass:"line-number"},[s._v("12")]),l("br"),l("span",{staticClass:"line-number"},[s._v("13")]),l("br"),l("span",{staticClass:"line-number"},[s._v("14")]),l("br"),l("span",{staticClass:"line-number"},[s._v("15")]),l("br"),l("span",{staticClass:"line-number"},[s._v("16")]),l("br"),l("span",{staticClass:"line-number"},[s._v("17")]),l("br"),l("span",{staticClass:"line-number"},[s._v("18")]),l("br"),l("span",{staticClass:"line-number"},[s._v("19")]),l("br"),l("span",{staticClass:"line-number"},[s._v("20")]),l("br"),l("span",{staticClass:"line-number"},[s._v("21")]),l("br"),l("span",{staticClass:"line-number"},[s._v("22")]),l("br")])]),l("ul",[l("li",[s._v("binlog最主要的作用场景")])]),s._v(" "),l("ul",[l("li",[s._v("mysql主从复制")]),s._v(" "),l("li",[s._v("数据库恢复：通过mysqlbinlog 工具来恢复数据库或数据")])]),s._v(" "),l("ul",[l("li",[s._v("binlog日志包含两类文件")])]),s._v(" "),l("ul",[l("li",[s._v("二进制日志索引文件（.index结尾的文件），用于记录所有的二进制文件")]),s._v(" "),l("li",[s._v("二进制binlog文件 ( .00000*结尾的文件)，记录了所有DDL和DML操作事件sql")])]),s._v(" "),l("h2",{attrs:{id:"基本配置"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#基本配置"}},[s._v("#")]),s._v(" 基本配置")]),s._v(" "),l("ul",[l("li",[s._v("binlog是二进制文件，需要配置mysql打开")])]),s._v(" "),l("div",{staticClass:"language- line-numbers-mode"},[l("pre",{pre:!0,attrs:{class:"language-text"}},[l("code",[s._v("前置：配置mysql的my.cnf配置文件，打开binlog，配置参数和主库配置类似\n[mysqld]\nserver_id=1101\n# 开启二进制日志功能\nlog-bin=mysql-mqz-bin\nbinlog_cache_size=1M\n# 设置使用的二进制日志格式（mixed,statement,row）\nbinlog_format=mixed\n# 二进制日志过期清理时间。单位是天，默认值为0，表示不自动清理。\nexpire_logs_days=0\n")])]),s._v(" "),l("div",{staticClass:"line-numbers-wrapper"},[l("span",{staticClass:"line-number"},[s._v("1")]),l("br"),l("span",{staticClass:"line-number"},[s._v("2")]),l("br"),l("span",{staticClass:"line-number"},[s._v("3")]),l("br"),l("span",{staticClass:"line-number"},[s._v("4")]),l("br"),l("span",{staticClass:"line-number"},[s._v("5")]),l("br"),l("span",{staticClass:"line-number"},[s._v("6")]),l("br"),l("span",{staticClass:"line-number"},[s._v("7")]),l("br"),l("span",{staticClass:"line-number"},[s._v("8")]),l("br"),l("span",{staticClass:"line-number"},[s._v("9")]),l("br"),l("span",{staticClass:"line-number"},[s._v("10")]),l("br")])]),l("h2",{attrs:{id:"binary-log操作"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#binary-log操作"}},[s._v("#")]),s._v(" binary log操作")]),s._v(" "),l("p",[l("a",{attrs:{"data-fancybox":"",title:"111",href:"binlog操作1.png"}},[l("img",{attrs:{src:"binlog%E6%93%8D%E4%BD%9C1.png",alt:"img.png"}})]),s._v(" "),l("a",{attrs:{"data-fancybox":"",title:"111",href:"binlog配置1.png"}},[l("img",{attrs:{src:"binlog%E9%85%8D%E7%BD%AE1.png",alt:"img.png"}})])]),s._v(" "),l("ul",[l("li",[l("p",[s._v("查看binlog日志的内容通常有两种方式")]),s._v(" "),l("ul",[l("li",[l("p",[s._v("show binlog events in 'mysql-bin.000001';")])]),s._v(" "),l("li",[l("p",[s._v("mysqlbinlog 'mysql-bin.000001'; # mysqlbinlog 是mysql自带的查看binlog的命令，不需要登录mysql终端，需要进入binlog日志所在目录执行")]),s._v(" "),l("p",[s._v("设置起止位置查询指定的binlog： mysqlbinlog --start-position=116149747 --stop-position=116199337 --base64-output=decode-rows -vv mall-mysql-slave1-bin.000003\n设置只查看某个数据库的binlog： mysqlbinlog --base64-output=decode-rows -vv --database=a-lock mall-mysql-slave1-bin.000003")])])])]),s._v(" "),l("li",[l("p",[s._v("建议把binlog输出成log文件查看，恢复数据，数据库结构需要手动操作，或者借助第三方项目解析binlog文件")])])]),s._v(" "),l("div",{staticClass:"language- line-numbers-mode"},[l("pre",{pre:!0,attrs:{class:"language-text"}},[l("code",[s._v("1. show binary logs; 查看所有的binlog日志文件名及文件大小\n2. show binlog events; 查看binlog日志文件内容\n   show binlog events [IN 'log_name'] [FROM pos] [LIMIT [offset,] row_count];\n   \n   show binlog events in 'mysql-bin.000001'; 查看指定binlog日志文件内容\n   show binlog events in 'mall-mysql-slave1-bin.000003' FROM 121445140 \\G; 从指定的position开始查询，并且格式化\n   \n3. mysql -uroot -p -e \"show binlog events in 'mall-mysql-slave1-bin.000001'\" > binlog-20211018.txt; 将binlog二进制文件解析成txt文件（log），不需要登陆mysql客户端\n4. flush logs; 清空日志重新开始一个日志文件，\n    重启mysql也会新开始一个日志文件，并且之前的从库绑定的主库的binlog文件均会变成最新的（自动）\n    \n5. show master status; 查看当前正在写入的binlog文件    \n")])]),s._v(" "),l("div",{staticClass:"line-numbers-wrapper"},[l("span",{staticClass:"line-number"},[s._v("1")]),l("br"),l("span",{staticClass:"line-number"},[s._v("2")]),l("br"),l("span",{staticClass:"line-number"},[s._v("3")]),l("br"),l("span",{staticClass:"line-number"},[s._v("4")]),l("br"),l("span",{staticClass:"line-number"},[s._v("5")]),l("br"),l("span",{staticClass:"line-number"},[s._v("6")]),l("br"),l("span",{staticClass:"line-number"},[s._v("7")]),l("br"),l("span",{staticClass:"line-number"},[s._v("8")]),l("br"),l("span",{staticClass:"line-number"},[s._v("9")]),l("br"),l("span",{staticClass:"line-number"},[s._v("10")]),l("br"),l("span",{staticClass:"line-number"},[s._v("11")]),l("br"),l("span",{staticClass:"line-number"},[s._v("12")]),l("br")])]),l("h2",{attrs:{id:"binlog配置参数"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#binlog配置参数"}},[s._v("#")]),s._v(" binlog配置参数")]),s._v(" "),l("div",{staticClass:"language- line-numbers-mode"},[l("pre",{pre:!0,attrs:{class:"language-text"}},[l("code",[s._v("[mysqld]\nserver_id=1101 #主从配置需要指定主、从数据库的server_id\nlog-bin=mysql-mqz-bin # 开启二进制 binary log，设置binlog文件名称，默认为mysql-bin。\nbinlog-ignore-db=mysql,admin,dynamic_datasource,kl,manage,nacos_config,wps # 指定不需要同步的数据库名称\nbinlog-do-db=wps # 指定数据库同步的名称\nbinlog-do-table=skate_tab # 指定数据库-表同步的名称\nbinlog_format=mixed # 设置使用的二进制日志格式（mixed,statement,row） statement:记录sql，row：基于行数据复制，只记录某行被修改，不记录sql，mixed：两种混合使用\nbinlog_cache_size=1M # 设置二进制日志使用内存大小（事务）\nexpire_logs_days=0 # 二进制日志过期清理时间。默认值为0，表示不自动清理。\nslave_skip_errors=1062 # 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致\nmax_binlog_size=1GB #此参数配置binlog的日志最大值，最大和默认值是1GB。\nmax_binlog_cache_size=200M #此参数表示binlog使用最大内存的数。\n")])]),s._v(" "),l("div",{staticClass:"line-numbers-wrapper"},[l("span",{staticClass:"line-number"},[s._v("1")]),l("br"),l("span",{staticClass:"line-number"},[s._v("2")]),l("br"),l("span",{staticClass:"line-number"},[s._v("3")]),l("br"),l("span",{staticClass:"line-number"},[s._v("4")]),l("br"),l("span",{staticClass:"line-number"},[s._v("5")]),l("br"),l("span",{staticClass:"line-number"},[s._v("6")]),l("br"),l("span",{staticClass:"line-number"},[s._v("7")]),l("br"),l("span",{staticClass:"line-number"},[s._v("8")]),l("br"),l("span",{staticClass:"line-number"},[s._v("9")]),l("br"),l("span",{staticClass:"line-number"},[s._v("10")]),l("br"),l("span",{staticClass:"line-number"},[s._v("11")]),l("br"),l("span",{staticClass:"line-number"},[s._v("12")]),l("br")])])])}),[],!1,null,null,null);n.default=i.exports}}]);