(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{434:function(a,s,n){"use strict";n.r(s);var e=n(54),t=Object(e.a)({},(function(){var a=this,s=a.$createElement,n=a._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h1",{attrs:{id:"nacos"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nacos"}},[a._v("#")]),a._v(" nacos")]),a._v(" "),n("h2",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),n("ul",[n("li",[a._v("nacos-hostname.env ： nacos持久化配置文件")])]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("SPRING_DATASOURCE_PLATFORM=mysql\nMYSQL_SERVICE_HOST=localhost\nMYSQL_SERVICE_DB_NAME=nacos_config\nMYSQL_SERVICE_PORT=3306\nMYSQL_SERVICE_USER=root\nMYSQL_SERVICE_PASSWORD=mengqizhang\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br")])]),n("ul",[n("li",[a._v("docker-compose 启动nacos")])]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('version: "3.7"\nservices:\n  nacos-1:\n    hostname: nacos-1\n    image: nacos/nacos-server:latest\n    container_name: nsc-1\n    environment:\n      - MODE=standalone\n      - PREFER_HOST_MODE=hostname\n      - NACOS_SERVERS=nacos-1:8848 #nacos-2:8848 nacos-3:8848\n      - TZ=Asia/Shanghai #设置容器时区\n      #  下面的配置已经放到的nacos-hostname.env的配置中\n      # - SPRING_DATASOURCE_PLATFORM=mysql\n      # - MYSQL_SERVICE_HOST=192.168.1.20\n      # - MYSQL_SERVICE_DB_NAME=nacos_config\n      # - MYSQL_SERVICE_PORT=3306\n      # - MYSQL_SERVICE_USER=root\n      # - MYSQL_SERVICE_PASSWORD=mengqizhang\n    env_file:\n      - nacos-hostname.env  #读取mysql的配置文件，nacos使用mysql持久化的方式\n    volumes:\n      # mac和linux目录挂载\n      - /usr/local/nacos-docker/nacos-1/:/home/nacos/logs/  # /home/nacos  是nacos-docker容器的目录， /usr/local/nacos-docker-1 是宿主机的目录\n      # Window目录挂载结构\n      # - /F/mqz/a-mqz-project/docker-mysql-volumn/nacos:/home/nacos/logs/  # /home/nacos  是nacos-docker容器的目录， /usr/local/nacos-docker-1 是宿主机的目录\n    ports:\n      - "8848:8848"\n      - "9555:9555"\n#    networks:\n#      - nacos_net\n    restart: on-failure\n    privileged: true\n\n#networks:\n#  nacos_net:\n#    external: true\n\n')])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br"),n("span",{staticClass:"line-number"},[a._v("15")]),n("br"),n("span",{staticClass:"line-number"},[a._v("16")]),n("br"),n("span",{staticClass:"line-number"},[a._v("17")]),n("br"),n("span",{staticClass:"line-number"},[a._v("18")]),n("br"),n("span",{staticClass:"line-number"},[a._v("19")]),n("br"),n("span",{staticClass:"line-number"},[a._v("20")]),n("br"),n("span",{staticClass:"line-number"},[a._v("21")]),n("br"),n("span",{staticClass:"line-number"},[a._v("22")]),n("br"),n("span",{staticClass:"line-number"},[a._v("23")]),n("br"),n("span",{staticClass:"line-number"},[a._v("24")]),n("br"),n("span",{staticClass:"line-number"},[a._v("25")]),n("br"),n("span",{staticClass:"line-number"},[a._v("26")]),n("br"),n("span",{staticClass:"line-number"},[a._v("27")]),n("br"),n("span",{staticClass:"line-number"},[a._v("28")]),n("br"),n("span",{staticClass:"line-number"},[a._v("29")]),n("br"),n("span",{staticClass:"line-number"},[a._v("30")]),n("br"),n("span",{staticClass:"line-number"},[a._v("31")]),n("br"),n("span",{staticClass:"line-number"},[a._v("32")]),n("br"),n("span",{staticClass:"line-number"},[a._v("33")]),n("br"),n("span",{staticClass:"line-number"},[a._v("34")]),n("br"),n("span",{staticClass:"line-number"},[a._v("35")]),n("br"),n("span",{staticClass:"line-number"},[a._v("36")]),n("br"),n("span",{staticClass:"line-number"},[a._v("37")]),n("br")])]),n("h2",{attrs:{id:"nacos简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nacos简介"}},[a._v("#")]),a._v(" Nacos简介")]),a._v(" "),n("ul",[n("li",[a._v("是啥：\n"),n("ul",[n("li",[a._v("注册中心+配置中心的结合 ： Nacos=Eureka+Config+Bus")])])]),a._v(" "),n("li",[a._v("Nacos支持AP或者CP两种模式，并且还能进行切换\n"),n("ul",[n("li",[a._v("注意：是能切换，而不是支持CAP这种模式。是支持AP或者CP。")]),a._v(" "),n("li",[a._v("CAP理论：（一个分布式系统不可能同时满足C和A，只能在CP或者AP，也就是需要在C和A中寻求平衡）\nC: Consistency ： 一致性：A读取k1库，插入新数据到K1库，随后K1库同步数据到K2库假设失败了，B读取K2库数据，导致和A读取的数据不一致。\nA: Available ： 可以用：部分系统宕机，其他系统还能使用。如：双十一淘宝注册账号不能用，仍能购物下单等。\nP: Partition Tolerance： 分区容错，分布式系统下的两个节点无法通信，导致数据不通什么的，就是称为分区了。")]),a._v(" "),n("li",[a._v("BASE理论：\nBA：Basic Available:基本可用\nS: Soft Status： 中间状态\nE: Eventually Consistency：最终一致性")])])])]),a._v(" "),n("h2",{attrs:{id:"namespace-和-group-和-dataid-之间的区别是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#namespace-和-group-和-dataid-之间的区别是什么"}},[a._v("#")]),a._v(" nameSpace 和 Group 和 DataId 之间的区别是什么？")]),a._v(" "),n("ul",[n("li",[a._v("类似Java里面的package名和类名\n"),n("ul",[n("li",[a._v("最外层的namespace是可以用于区分部署环境的，Group和DataID逻辑上区分两个目标对象。")]),a._v(" "),n("li",[a._v("默认情况")]),a._v(" "),n("li",[a._v("Namespace=public,Group=DEFAULT_GROUP,默认Cluster是DEFAULT")]),a._v(" "),n("li",[a._v("比如现在有多个开发环境，我们就可以创建多个Namespace，不同的Namespace之间是隔离的。")])])])]),a._v(" "),n("h2",{attrs:{id:"nacos-maven多环境配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nacos-maven多环境配置"}},[a._v("#")]),a._v(" Nacos-Maven多环境配置")]),a._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"nacos-maven多环境配置1.jpg"}},[n("img",{attrs:{src:"nacos-maven%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE1.jpg",alt:"Nacos-Maven多环境配置-1"}})]),a._v(" "),n("a",{attrs:{"data-fancybox":"",title:"111",href:"nacos-nameSpace配置.jpg"}},[n("img",{attrs:{src:"nacos-nameSpace%E9%85%8D%E7%BD%AE.jpg",alt:"Nacos-Maven多环境配置-1"}})])]),a._v(" "),n("ul",[n("li",[n("p",[a._v("1.Maven配置文件中配置dev、prod、test的配置分别对应不同的NacosServerAddress、NacosNameSpace等，详情可参考本项目的pom.xml配置")])]),a._v(" "),n("li",[n("p",[a._v("2.NacosServer：localhost:8848/nacos 中分别设置dev、prod、test的nameSpace，需要关联到Maven中的dev、prod、test等")])]),a._v(" "),n("li",[n("p",[a._v("3.Nacos配置文件的命名规则：")])])]),a._v(" "),n("ul",[n("li",[a._v("#${prefix}-${spring.profile.active}.${file-extension}")]),a._v(" "),n("li",[n("h1",{attrs:{id:"spring-application-name-spring-profile-active-file-extension"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#spring-application-name-spring-profile-active-file-extension"}},[a._v("#")]),a._v(" ${spring.application.name}-${spring.profile.active}.${file-extension}")])])]),a._v(" "),n("h2",{attrs:{id:"maven多环境启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#maven多环境启动"}},[a._v("#")]),a._v(" Maven多环境启动")]),a._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"maven多环境启动.jpg"}},[n("img",{attrs:{src:"maven%E5%A4%9A%E7%8E%AF%E5%A2%83%E5%90%AF%E5%8A%A8.jpg",alt:"Maven多环境启动-1"}})])]),a._v(" "),n("ul",[n("li",[a._v("如果是idea直接debug、run启动的话，需要勾选指定环境（maven-Profiles： dev、prod、test等）")]),a._v(" "),n("li",[a._v("使用命令打包： mvn clean install -Pprod (-P指定环境： prod、dev、test，-pl指定模块，-DskipTests=true)")])]),a._v(" "),n("h2",{attrs:{id:"nacos持久化配置-mysql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nacos持久化配置-mysql"}},[a._v("#")]),a._v(" Nacos持久化配置-mysql")]),a._v(" "),n("p",[a._v("1.mysql创建 nacos_config 数据库，\n2.并且执行以下的sql脚本 ：https://github.com/alibaba/nacos/blob/master/config/src/main/resources/META-INF/nacos-db.sql\n3.配置nacos-hostname.env mysql相关的配置参数，请参考 nacos-docker-server/nacos-hostname.env\n4.并且把该外部配置nacos-hostname.env加入到nacos-docker启动中，请参考 nacos-docker-server/nacos-compose-start.yml")]),a._v(" "),n("p",[a._v("MySQL 5.7 (官方镜像和mysql8有冲突的情况)\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"nacos-mysql持久化问题-1.jpg"}},[n("img",{attrs:{src:"nacos-mysql%E6%8C%81%E4%B9%85%E5%8C%96%E9%97%AE%E9%A2%98-1.jpg",alt:"nacos-mysql持久化报错"}})]),a._v(" "),n("a",{attrs:{"data-fancybox":"",title:"111",href:"nacos-mysql持久化报错-1.jpg"}},[n("img",{attrs:{src:"nacos-mysql%E6%8C%81%E4%B9%85%E5%8C%96%E6%8A%A5%E9%94%99-1.jpg",alt:"nacos-mysql持久化报错"}})]),a._v(" "),n("a",{attrs:{"data-fancybox":"",title:"111",href:"nacos-mysql持久化报错-2.jpg"}},[n("img",{attrs:{src:"nacos-mysql%E6%8C%81%E4%B9%85%E5%8C%96%E6%8A%A5%E9%94%99-2.jpg",alt:"nacos-mysql持久化报错"}})])]),a._v(" "),n("h2",{attrs:{id:"配置中心配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置中心配置"}},[a._v("#")]),a._v(" 配置中心配置")]),a._v(" "),n("ul",[n("li",[n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"nacos-配置中心1.jpg"}},[n("img",{attrs:{src:"nacos-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%831.jpg",alt:"nacos配置中心"}})])])]),a._v(" "),n("li",[n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"nacos-配置中心2.jpg"}},[n("img",{attrs:{src:"nacos-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%832.jpg",alt:"nacos配置中心"}})])])]),a._v(" "),n("li",[n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"nacos-配置中心3.jpg"}},[n("img",{attrs:{src:"nacos-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%833.jpg",alt:"nacos配置中心"}})])])]),a._v(" "),n("li",[n("p",[a._v("注意依赖是引用 spring-cloud-starter-alibaba-nacos-config")])]),a._v(" "),n("li",[n("p",[a._v("Nacos配置文件的命名规则：")])])]),a._v(" "),n("ul",[n("li",[a._v("${prefix}-${spring.profile.active}.${file-extension}")]),a._v(" "),n("li",[a._v("${spring.application.name}-${spring.profile.active}.${file-extension}")])]),a._v(" "),n("ul",[n("li",[a._v("spring应用对应nacos配置是以下几个参数控制 ：")])]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("spring.cloud.nacos.config.prefix: qingwang-user  # 应用名称\nspring.cloud.nacos.config.file-extension: yaml # 文件类型\nspring.cloud.nacos.config.group: DEFAULT_GROUP\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br")])]),n("ul",[n("li",[n("p",[a._v("这里Controller使用了@RefreshScope注解 保证Nacos能实现动态刷新功能。")])]),a._v(" "),n("li",[n("p",[a._v("多项目共享配置：")]),a._v(" "),n("ol",[n("li",[n("p",[a._v("spring.cloud.nacos.config.shared-dataids: common-config.yaml\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"springcloud-nacos-config共享配置.png"}},[n("img",{attrs:{src:"springcloud-nacos-config%E5%85%B1%E4%BA%AB%E9%85%8D%E7%BD%AE.png",alt:"nacos配置中心"}})])])]),a._v(" "),n("li",[n("p",[a._v("spring:\ncloud:\nnacos:\nconfig:\next-config:\n- data-id: qingwang-config.yaml\ngroup: DEFAULT_GROUP\nrefresh: true")])])])])]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("A: 通过spring.cloud.nacos.config.shared-dataids定义的共享配置\nB: 通过spring.cloud.nacos.config.ext-config[n]定义的加载配置\nC: 通过内部规则（spring.cloud.nacos.config.prefix、spring.cloud.nacos.config.file-extension、spring.cloud.nacos.config.group这几个参数）拼接出来的配置\n加载的配置原则是会覆盖之前加载的配置，根据启动日志，我们观察可以看出优先级关系是：A < B < C\n\n1、shared-dataids方式：适合于共享配置文件与项目默认配置文件处于相同Group时\n2、ext-config方式：它可以由开发者自定义要读取的共享配置文件的DataId、Group、refresh属性，这样刚好解决了shared-dataids存在的局限性。\n\n\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);