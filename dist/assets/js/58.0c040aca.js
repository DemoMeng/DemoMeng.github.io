(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{449:function(s,e,n){"use strict";n.r(e);var a=n(54),r=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"docker在springboot使用打包上传到镜像仓库-服务器拉取镜像启动docker容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker在springboot使用打包上传到镜像仓库-服务器拉取镜像启动docker容器"}},[s._v("#")]),s._v(" docker在springboot使用打包上传到镜像仓库，服务器拉取镜像启动docker容器")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("参考项目\n"),n("a",{attrs:{href:"https://gitee.com/DemoMeng/simple-life-better.git",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://gitee.com/DemoMeng/simple-life-better.git"),n("OutboundLink")],1),s._v(" "),n("a",{attrs:{href:"https://gitee.com/DemoMeng/nacos-gateway.git",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://gitee.com/DemoMeng/nacos-gateway.git"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[s._v("dockerfile-maven-plugin 本地打包项目成镜像并推送到镜像仓库 这里需要参考maven多模块打包方式！！ 具体可看项目： https://gitee.com/DemoMeng/simple-life-better.git")])])]),s._v(" "),n("h2",{attrs:{id:"步骤概览"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步骤概览"}},[s._v("#")]),s._v(" 步骤概览")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1.打包配置pom\n2.编写Dockerfile文件\n3.运行该插件的机器上定义DOCKER_HOST环境变量，配置访问Docker的URL， \n  如：export DOCKER_HOST=tcp://localhost:2375\n  上面的例子，是在Linux环境下定义的DOCKER_HOST环境变量，因为Docker安装在本机上，因此使用localhost。如果你的Docker运行环境不在本机，\n  请使用Docker所在机器的IP。2375是为Docker开启的远程访问API的端口，如果你开启的是其他端口，请使用具体的端口。如果你的Docker没有开启远程访问API，请自行Google开启。\n4.配置鉴权，在maven的setting.xml中新加一个server节点配置鉴权：\n    <server>\n      <id>registry.cn-hangzhou.aliyuncs.com</id>\n      <username>xxxx</username>\n      <password>xxxx</password>\n      <configuration>\n        <email>xxxx</email>\n      </configuration>\n    </server>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h2",{attrs:{id:"pom-xml父级配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pom-xml父级配置"}},[s._v("#")]),s._v(" pom.xml父级配置")]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"父级pom配置.png"}},[n("img",{attrs:{src:"%E7%88%B6%E7%BA%A7pom%E9%85%8D%E7%BD%AE.png",alt:"父级pom配置.png"}})])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\x3c!-- maven环境配置区分 --\x3e\n<profiles>\n    <profile>\n        <id>dev</id>\n        <properties>\n            <projectActive>dev</projectActive>\n            <zookeeperUrl>127.0.0.1:2181</zookeeperUrl>\n            <javaHome>/usr/local/java</javaHome>\n            <aliNameSpace>nacos-project</aliNameSpace>\x3c!--阿里云镜像仓库命名空间，有一个环境区分dev/prod的命名空间--\x3e\n            <aliRep>simplie-life-better-rep</aliRep>\n            <bdNameSpace>simple-life-better-repository</bdNameSpace>\n            <bdImageName>simple-life-better-image</bdImageName>\n        </properties>\n    </profile>\n    <profile>\n        <id>test</id>\n        <properties>\n            <projectActive>test</projectActive>\n            <zookeeperUrl>192.168.2.11:2181</zookeeperUrl>\n            <javaHome>/usr/local/java</javaHome>\n            <aliNameSpace>nacos-project</aliNameSpace>\x3c!--阿里云镜像仓库命名空间，有一个环境区分dev/prod的命名空间--\x3e\n            <aliRep>simplie-life-better-rep</aliRep>\n            <bdNameSpace>simple-life-better-repository</bdNameSpace>\n            <bdImageName>simple-life-better-image</bdImageName>\n        </properties>\n    </profile>\n    <profile>\n        <id>prod</id>\n        <properties>\n            <projectActive>prod</projectActive>\n            <zookeeperUrl>192.168.2.11:2181</zookeeperUrl>\n            <javaHome>/usr/local/java</javaHome>\n            <aliNameSpace>nacos-project</aliNameSpace>\x3c!--阿里云镜像仓库命名空间，有一个环境区分dev/prod的命名空间--\x3e\n            <aliRep>simplie-life-better-rep</aliRep>\n            <bdNameSpace>simple-life-better-repository</bdNameSpace>\n            <bdImageName>simple-life-better-image</bdImageName>\n        </properties>\n    </profile>\n</profiles>\n\n\n\x3c!-- com.spotify插件： 配置项目打包成docker镜像，上传到aliyun --\x3e\n<build>\n    <pluginManagement>\n        <plugins>\n          \x3c!-- com.spotify提供的Dockerfile的maven项目打包插件，除了需要更改父级pom的plugin依赖配置和当前web主类依赖配置，其他均一致不动 --\x3e\n            <plugin>\n                <groupId>com.spotify</groupId>\n                <artifactId>dockerfile-maven-plugin</artifactId>\n                <version>1.4.0</version>\n                <executions>\n                    <execution>\n                        <id>tag-image</id>\n                        <phase>package</phase>\n                        <goals>\n                            <goal>build</goal>\n                            <goal>tag</goal>\n                            <goal>push</goal>\n                        </goals>\n                    </execution>\n                </executions>\n                <configuration>\n                    \x3c!--Dockerfile默认与pom平级--\x3e\n                    \x3c!--<contextDirectory>${project.basedir}</contextDirectory>--\x3e\n                    \x3c!--docker/config.json 阿里云auth鉴权密码，鉴权放在maven的setting.xml中，参考README.md--\x3e\n                    \x3c!--仓库名--\x3e\n                    \x3c!--<repository>registry.cn-hangzhou.aliyuncs.com/${aliNameSpace}/${aliRep}</repository>--\x3e\n                    <repository>registry.baidubce.com/${bdNameSpace}/${bdImageName}</repository>\n                    <tag>0.0.8</tag>\x3c!--镜像版本--\x3e\n                    <useMavenSettingsForAuth>true</useMavenSettingsForAuth>\n                    <buildArgs>\n                        <JAR_NAME>${project.build.finalName}</JAR_NAME>\x3c!--需要想Dcoekrfile传递的变量--\x3e\n                    </buildArgs>\n                    <skipPush>false</skipPush>\x3c!--是否跳过 docker push 推送本地镜像到dockerHub或者阿里云等镜像仓库--\x3e\n                </configuration>\n            </plugin>\n        </plugins>\n    </pluginManagement>\n</build>\n\n\x3c!-- io.fabric8插件： 配置项目打包成docker镜像，上传到aliyun --\x3e\n<build>\n    <pluginManagement>\n        <plugins>\n          <plugin>\n              <groupId>io.fabric8</groupId>\n              <artifactId>docker-maven-plugin</artifactId>\n              <version>0.32.0</version>\n              <configuration>\n                  \x3c!-- Docker Remote Api --\x3e\n                  \x3c!-- 本地有docker环境即可 --\x3e\n                  <dockerHost>tcp://106.12.187.16:2375</dockerHost>\n                  \x3c!-- Docker 镜像私服 --\x3e\n                  <registry>registry.cn-hangzhou.aliyuncs.com</registry>\n                  \x3c!-- 认证信息--\x3e\n                  <authConfig>\n                      <push>\n                          <username>977466992@qq.com</username>\n                          <password>mengqizhang0304</password>\n                      </push>\n                  </authConfig>\n                  <images>\n                      <image>\n                          \x3c!-- 镜像名称： 172.17.0.111/library/pig-gateway:2.6.3--\x3e\n                          <name>registry.cn-hangzhou.aliyuncs.com/nacos-project/simplie-life-better-rep:0.1.2</name>\n                          <build>\n                              <dockerFile>/Applications/mqz/simple-life-better/better-web/Dockerfile</dockerFile>\n                          </build>\n                          \x3c!-- 别名:用于容器命名和在docker-compose.yml文件只能找到对应名字的配置--\x3e\n                          <alias>${project.name}</alias>\n                          \x3c!-- 配置docker-compose文件--\x3e\n                          <external>\n                              <type>compose</type>\n                              <basedir>/Applications/mqz/simple-life-better/docker</basedir>\n                              <composeFile>simple-life-better-compose.yml</composeFile>\n                          </external>\n                          \x3c!-- 容器run相关配置 --\x3e\n                          <run>\n                              \x3c!-- 配置运行时容器命名策略为:别名,如果不指定则默认为none,即使用随机分配名称 --\x3e\n                              <namingStrategy>alias</namingStrategy>\n                          </run>\n                      </image>\n                  </images>\n              </configuration>\n          </plugin>--\x3e\n        </plugins>\n    </pluginManagement>\n</build>\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br")])]),n("h2",{attrs:{id:"web模块的pom配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#web模块的pom配置"}},[s._v("#")]),s._v(" web模块的pom配置")]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"子pom配置.png"}},[n("img",{attrs:{src:"%E5%AD%90pom%E9%85%8D%E7%BD%AE.png",alt:"子pom配置.png"}})])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\x3c!-- com.spotify提供的Dockerfile的maven项目打包插件，除了需要更改父级pom的plugin依赖配置和当前web主类依赖配置，其他均一致不动 --\x3e\n<plugin>\n    <groupId>com.spotify</groupId>\n    <artifactId>dockerfile-maven-plugin</artifactId>\n    <version>1.4.0</version>\n    <configuration>\n        <skip>false</skip>\n        \x3c!--这里设置是否需要跳过dockerfile-maven打包，true：跳过，本地运行的jar ，false不跳过，则会打成镜像并且上传aliyun（如果父级依赖的skipPush没设置true的话）--\x3e\n    </configuration>\n</plugin>\n\n\n\x3c!-- Dockerfile的maven项目打包依赖插件：io.fabric8，该插件bug比较多，不建议使用 --\x3e\n<plugin>\n  <groupId>io.fabric8</groupId>\n  <artifactId>docker-maven-plugin</artifactId>\n  <version>0.32.0</version>\n  \x3c!--需不需要跳过推送请参考 README.md 指定某些指令即可实现 --\x3e\n</plugin>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h2",{attrs:{id:"web模块下的dockerfile文件配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#web模块下的dockerfile文件配置"}},[s._v("#")]),s._v(" web模块下的Dockerfile文件配置")]),s._v(" "),n("ul",[n("li",[s._v("该Dockerfile和web的pom.xml是同一级别")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#基础镜像\nFROM java:8\n#镜像的制作人\nMAINTAINER mengqizhang\nENV APP_NAME="better-web-0.0.1-SNAPSHOT"\n#定义jar包名称 给个默认值\nARG JAR_NAME=${APP_NAME}.jar\n#此处必须这么指定，ARG参数在最终的ENTRYPOINT执行时会出现问题\nENV FILE_NAME="better-web-0.0.1-SNAPSHOT.jar"\nENV WORK_DIR="/home/mqz/nacos-project/${APP_NAME}"\nENV JAVA_MS="1G"\nENV JAVA_OPTS="-Djava.security.egd=file:/dev/./urandom -Dlog4j.defaultInitOverride=true -Dorg.apache.tomcat.util.http.ServerCookie.ALLOW_EQUALS_IN_VALUE=true -Dorg.apache.tomcat.util.http.ServerCookie.ALLOW_HTTP_SEPARATORS_IN_V0=true -server  -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=256m -Xmn256m -XX:SurvivorRatio=10 -XX:+UseConcMarkSweepGC -XX:CMSMaxAbortablePrecleanTime=5000 -XX:+CMSClassUnloadingEnabled -XX:CMSInitiatingOccupancyFraction=80 -XX:+UseCMSInitiatingOccupancyOnly -XX:+ExplicitGCInvokesConcurrent -Dsun.rmi.dgc.server.gcInterval=2592000000 -Dsun.rmi.dgc.client.gcInterval=2592000000 -XX:ParallelGCThreads=4 -Djava.awt.headless=true -Dsun.net.client.defaultConnectTimeout=10000 -Dsun.net.client.defaultReadTimeout=30000  -Dfile.encoding=utf-8"\nRUN mkdir -p  ${WORK_DIR}\n#目的解决docker容器和宿主机时差的问题！\nRUN /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo \'Asia/Shanghai\' >/etc/timezone\nWORKDIR ${WORK_DIR}\n# 把可执行jar包复制到基础镜像的根目录下\nCOPY target/${FILE_NAME} ${FILE_NAME}\n#声明了容器应该打开的端口并没有实际上将它打开\nEXPOSE 2000\n#健康检查\n#Docker 打包异常 ： [ERROR] Unknown flag: start-period  （ 暂时关闭 ）\n\n#本地打包正常并且能上传到阿里云成功\n#docker版本问题，本地docker（macos）：Docker version 20.10.6, build 370c289\n#服务器（centOS）： Docker version 1.13.1, build 0be3e21/1.13.1\n\n#HEALTHCHECK --start-period=160s --interval=160s --timeout=160s --retries=10 CMD curl --fail localhost:2000/actuator/health || exit 1\n#指定容器启动时要执行的命令，但如果存在CMD指令，CMD中的参数会被附加到ENTRYPOINT指令的后面\nENTRYPOINT ["sh","-c","java ${JAVA_OPTS} -jar ${FILE_NAME}"]\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("h2",{attrs:{id:"maven的setting设置docker仓库鉴权配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#maven的setting设置docker仓库鉴权配置"}},[s._v("#")]),s._v(" maven的setting设置docker仓库鉴权配置")]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"docker打包镜像鉴权配置.png"}},[n("img",{attrs:{src:"docker%E6%89%93%E5%8C%85%E9%95%9C%E5%83%8F%E9%89%B4%E6%9D%83%E9%85%8D%E7%BD%AE.png",alt:"docker打包镜像鉴权配置.png"}})])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("registry.cn-hangzhou.aliyuncs.com 是阿里云镜像仓库的主域名，类比docker.io\n用户名 和 授权密码均可以配置\n\n <server>\n      <id>registry.cn-hangzhou.aliyuncs.com</id>\n      <username>xxxx</username>\n          <password>xxxx</password>\n          <configuration>\n              <email>xxxx@qq.com</email>\n          </configuration>\n </server>\n\n百度云容器镜像仓库同等配置:\n    <server>\n        <id>registry.baidubce.com</id>\n        <username>xxxx</username>\n        <password>xxxx</password>\n    </server>\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h2",{attrs:{id:"执行打包命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#执行打包命令"}},[s._v("#")]),s._v(" 执行打包命令")]),s._v(" "),n("ul",[n("li",[s._v("使用 spotify 的maven打包命令： mvn clean install -pl better-web -am -Pdev -DskipTests")]),s._v(" "),n("li",[s._v("使用 fabric8 的maven打包命令： mvn clean install -pl better-web -am -Pdev -DskipTests docker:remove docker:build docker:push\nfabric8 如果使用了dockerHost，那么打包生成的镜像会在该dockerHost上\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"fabric8的打包插件.png"}},[n("img",{attrs:{src:"fabric8%E7%9A%84%E6%89%93%E5%8C%85%E6%8F%92%E4%BB%B6.png",alt:"fabric8的打包插件.png"}})]),s._v(" "),n("a",{attrs:{"data-fancybox":"",title:"111",href:"fabric8打包后的镜像.png"}},[n("img",{attrs:{src:"fabric8%E6%89%93%E5%8C%85%E5%90%8E%E7%9A%84%E9%95%9C%E5%83%8F.png",alt:"fabric8打包后的镜像.png"}})]),s._v(" "),n("a",{attrs:{"data-fancybox":"",title:"111",href:"fabric8打包后的镜像2.png"}},[n("img",{attrs:{src:"fabric8%E6%89%93%E5%8C%85%E5%90%8E%E7%9A%84%E9%95%9C%E5%83%8F2.png",alt:"fabric8打包后的镜像2.png"}})])])]),s._v(" "),n("h2",{attrs:{id:"fabric8-打包相关命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fabric8-打包相关命令"}},[s._v("#")]),s._v(" fabric8 打包相关命令")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("  maven指令\t     功能\ndocker:start\t        创建和启动容器\ndocker:stop\t            停止并销毁容器\ndocker:build\t        构建镜像\ndocker:watch\t        自动进行重建和重启\ndocker:push\t            将镜像推送到registry\ndocker:remove\t        从本地docker主机删除镜像\ndocker:logs\t            显示容器日志\ndocker:source\t        将docker build archive附加到Maven项目\ndocker:save\t            将镜像保存到文件\ndocker:volume-create\t创建卷以在容器之间共享数据\ndocker:volume-remove\t删除创建的卷\n\n使用示例： mvn clean install -pl better-web -am -Pdev -DskipTests docker:remove docker:build docker:push \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h2",{attrs:{id:"使用fabric8-插件需要配置docker-compose-yml文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用fabric8-插件需要配置docker-compose-yml文件"}},[s._v("#")]),s._v(" 使用fabric8 插件需要配置docker-compose.yml文件")]),s._v(" "),n("ul",[n("li",[s._v("具体参考项目： "),n("a",{attrs:{href:"https://gitee.com/DemoMeng/simple-life-better.git",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://gitee.com/DemoMeng/simple-life-better.git"),n("OutboundLink")],1)])]),s._v(" "),n("h2",{attrs:{id:"dockerfile打包插件区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile打包插件区别"}},[s._v("#")]),s._v(" Dockerfile打包插件区别")]),s._v(" "),n("ul",[n("li",[s._v("io.fabric8 ： dockerfile和docker-compose文件进行docker镜像构造(build),\n镜像推送(push),支持对容器操作(如run,stop,remove等),\n实现对Docker从构建镜像到运行和推送完整的控制流程,这是它独树一帜的地方.")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('\n          \nfabric8io的 的dockerHost支持 tcp 和http（https）两种格式\n1 tcp\n  如果使用tcp则只能使用 2375 和 2376端口，分别对应不加密验证和加密验证\n  这个时候在url里配置其他端口是无效的。\n  （也就是说，服务器设置了监听 tcp:///0.0.0.0:9999，fabric8io的插件设置 tcp:公网ip:9999，也是无效的，这个时候如果启用了ssl加密的话就只能一起用 2376）\n\n2 http/https\n  这个时候端口是可以自定义的\n  即是说直接用 http://公网ip（域名）:9999 即可。\n  \n打开docker的2375端口供remote api使用\nvim /etc/docker/daemon.json\n\n{\n  "hosts": ["tcp://0.0.0.0:2375", "unix:///var/run/docker.sock"]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("ul",[n("li",[s._v("com.spotify ：只能支持dockerfile文件的、并且Dockerfile文件的位置放置需要按照规则放置，对与docker-compose.yml文件几乎不支持")])])])}),[],!1,null,null,null);e.default=r.exports}}]);