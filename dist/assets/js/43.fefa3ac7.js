(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{432:function(s,a,n){"use strict";n.r(a);var e=n(54),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"gateway配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gateway配置"}},[s._v("#")]),s._v(" gateway配置")]),s._v(" "),n("h2",{attrs:{id:"为什么需要网关"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要网关"}},[s._v("#")]),s._v(" 为什么需要网关：")]),s._v(" "),n("ul",[n("li",[s._v("应用api网关是基于服务方调用方式采用api调用的方式 （服务调用方式分为RPC和API）")]),s._v(" "),n("li",[s._v("若不使用api网关可能无法实现流量监控，服务间调用混乱，")]),s._v(" "),n("li",[s._v("使用网关优点：限流、熔断、流量监控、系统鉴权、灰度发布、线上测试")])]),s._v(" "),n("h2",{attrs:{id:"名词解释"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#名词解释"}},[s._v("#")]),s._v(" 名词解释：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("路由（routes）：即配置中的routes，其包括：id、uri、predicates组成，如果predicates为true，这匹配该路由")])]),s._v(" "),n("li",[n("p",[s._v("断言（predicates）：可以匹配http请求中的cookie、header、query、path等，如果匹配成功，则进入该路由")])]),s._v(" "),n("li",[n("p",[s._v("过滤器（filter）： GatewayFilter实例，可以对请求前、后修改请求")])])]),s._v(" "),n("h2",{attrs:{id:"路由配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#路由配置"}},[s._v("#")]),s._v(" 路由配置：")]),s._v(" "),n("ul",[n("li",[s._v("方式1： yml中配置")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("spring:\n  cloud:\n    gateway:\n      routes:\n        - id: nacos-consumer-a # 服务名\n          uri: lb://nacos-consumer-a # 需要路由到的服务地址\n          predicates:\n            - Path=/nacos-consumer-a/** #断言匹配的路由谓词规则\n          metedata:\n            response-timeout: 200 # 响应超时时间设置，  单位：毫秒\n            connect-timeout: 200 # 连接超时时间设置，单位：毫秒 \n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("ul",[n("li",[s._v("方式2：代码中配置")]),s._v(" "),n("li",[s._v("基本和yml配置一致")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Configuration\npublic class Routes {\n    /**\n     *\n     * 代码配置网关路由\n     *\n     * @param routeLocatorBuilder\n     * @return\n     */\n    @Bean\n    public RouteLocator routeLocator1(RouteLocatorBuilder routeLocatorBuilder){\n        return routeLocatorBuilder.routes().route("route-1",r -> r.path("/nacos-consumer-a/**").uri("lb:nacos-consumer-a")).build();\n    }\n\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h2",{attrs:{id:"跨域配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跨域配置"}},[s._v("#")]),s._v(" 跨域配置：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("spring:\n  cloud:\n    gateway:\n      globalcors:\n        cors-configurations:\n          '[/**]':\n            allowedOrigins: \"**\" # **为允许所有域名访问，可以修改 http://mengqizhang.xyz\n            allowedMethods:\n            - GET\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"内置globalfilter过滤器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#内置globalfilter过滤器"}},[s._v("#")]),s._v(" 内置GlobalFilter过滤器：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("官方文档： https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories")])]),s._v(" "),n("li",[n("p",[s._v("AddRequestHeader :添加请求头过滤器")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: add_request_header_route\n        uri: https://example.org\n        filters:\n            - AddRequestHeader=version, 0.0.1 # 添加了一个version=0.0.1的请求头参数和值\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("AddRequestParameter : 添加请求url参数")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n    filters:\n        - AddRequestHeader=version, 0.0.1 # 添加了一个version=0.0.1的请求头参数和值\n        \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[s._v("StripPrefix: 截取掉多少位url")]),s._v(" "),n("li",[s._v("比如原来请求是 http://cloud.com/user/name/getByName，经过这个StripPrefix过滤器，截取掉了域名后面的两位url（不包含 / ）为：http://cloud.com/getByName")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("    filters:\n        - StripPrefix=2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("PrefixPath： 增加域名后url的前缀，和StripPrefix相反")]),s._v(" "),n("li",[s._v("比如原来的请求是 http://cloud.com/user/name/getByName，经过这个PrefixPath后，变成了： http://cloud.com/addPath/user/name/getByName")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("    filters:\n        - PrefixPath=/addPath\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"gateway-路由谓词工厂"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gateway-路由谓词工厂"}},[s._v("#")]),s._v(" Gateway 路由谓词工厂：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n    Path:  请求路径校验谓词\n    Cookie: 请求cookie校验谓词\n    After: 请求时间校验谓词-XX范围之后\n    Before: 请求时间校验谓词-XX范围之前\n    Between: 请求时间校验谓词-XX-XX范围之间\n    Header: 请求头校验谓词\n    Host: 请求客户端Host谓词\n    Method: 请求方法谓词\n    Query: 请求url查询参数校验谓词\n    RemoteAddr: 请求客户端ip地址谓词\n    Weight: \n\n##请求路径校验谓词示例：\nspring:\n    cloud:\n        gateway:\n            routes:\n                - id: nacos-consumer-a #服务的id，可以自定\n                  uri: lb://nacos-consumer-a #负载的服务名，服务项目中的 spring.application.name\n                  predicates:\n                    - Path=/nacos-consumer-a/**,a/**  #Path是路由谓词， \n                    \n                    \n##请求cookie校验谓词：\n\n    predicates:\n        - Path=/user/** #可以两个谓词共同使用\n        - Cookie=version,gray # Cookie种version=gray请求会打到该节点，这里也能使用正则表达式！！\n        \n##请求时间校验谓词-XX范围之后示例：\n\n    predicates:\n        - After=2019-09-15T21:05:50.187697+08:00[Asia/Shanghai] # 这里的时间格式是java种的ZonedDateTime对象\n        \n        \n##请求时间校验谓词-XX范围之前示例：\n\n    predicates:\n        - Before=2019-09-10T21:05:50.187697+08:00[Asia/Shanghai] # 这里的时间格式是java种的ZonedDateTime对象\n        \n        \n##请求时间校验谓词-XX-XX范围之间示例：\n\n    predicates:\n        - Between=2019-09-10T21:05:50.187697+08:00[Asia/Shanghai],2019-09-15T21:05:50.187697+08:00[Asia/Shanghai] # 这里的时间格式是java种的ZonedDateTime对象\n        \n\n##请求头校验谓词示例：\n\n    predicates:\n        - Header=token,^(?!\\d+$)[\\da-zA-Z]+$ # 这里可以使用正则表达式进行匹配指定的格式的token值\n\n\n##请求Host校验谓词示例：\n\n\n    predicates:\n        - Host=**.megnqizhang.xyz,**.aliyun.com  # 匹配域名下的子域名可访问，逗号隔开表示多个值\n\n##请求参数校验谓词示例：\n\n\n    predicates:\n        - Query=token # Query匹配 支持传入两个参数，一个是属性名，一个为属性值，属性值可以是正则表达式。\n        - Query=token, \\d+ # 只有属性名token，表示只要有token参数就行，不管值是什么，即可路由\n\n\n##请求方法校验谓词示例：\n\n\n    predicates:\n        - Method=GET,POST # GET、POST、DELETE、PUT。\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);