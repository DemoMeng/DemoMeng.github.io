(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{475:function(s,a,n){"use strict";n.r(a);var e=n(54),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"redis6-0新特性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis6-0新特性"}},[s._v("#")]),s._v(" redis6.0新特性")]),s._v(" "),n("p",[s._v("Redis 6.0（2021 年 10 月 GA）引入了\nSSL、\n新的 RESP3 协议、\nACL、\n客户端缓存、\n无盘副本、\nI/O 线程、\n更快的 RDB 加载、\n新模块 API 以及更多改进。")]),s._v(" "),n("h2",{attrs:{id:"ssl"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ssl"}},[s._v("#")]),s._v(" SSL")]),s._v(" "),n("p",[s._v("Redis 6连接支持SSL，更加安全。")]),s._v(" "),n("h2",{attrs:{id:"在resp2的基础上出了resp3协议"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在resp2的基础上出了resp3协议"}},[s._v("#")]),s._v(" 在RESP2的基础上出了RESP3协议")]),s._v(" "),n("ul",[n("li",[s._v("RESP （Redis Serialization Protocol） 是Redis服务端和客户端之间的通信协议。\nRedis5使用的RESP2，Redis6.0在RESP2的基础上，开发出了RESP3。")]),s._v(" "),n("li",[s._v("在 RESP2 中，所有的返回内容，都是一个字符串数组的形式，不管是 list 还是 sorted set。因此客户端需要自行去根据类型进行解读，增加了客户端实现的复杂性。")])]),s._v(" "),n("h2",{attrs:{id:"客户端缓存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#客户端缓存"}},[s._v("#")]),s._v(" 客户端缓存")]),s._v(" "),n("p",[s._v("redis客户端将数据缓存在业务服务器中，实现快速读取数据")]),s._v(" "),n("h2",{attrs:{id:"无盘副本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#无盘副本"}},[s._v("#")]),s._v(" 无盘副本")]),s._v(" "),n("p",[s._v("指的是在Redis主从模式下，Master不会将RDB文件文件存储到磁盘，会将RDB文件直接通过网络传输到slave中。如果服务器上的磁盘是普通的机械硬盘（磁盘读写效率低下）这种情况下，就能使用无磁盘复制的方式。\nRedis主从模式下，RDB文件若没有配置使用的话则会立即删除， 参考repl-diskless-load disabled配置。\n如果不使用无盘副本的配置，Master会将RDB文件存储到磁盘，随后才会吧RDB文件发送给从节点。有些磁盘是传统到机械硬盘，所以存在主从复制场景下效率低下的问题。")]),s._v(" "),n("p",[s._v("配置文件配置，")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 大带宽，网速好可以使用scoket复制方式\n# repl-diskless-sync no\n# 延迟以秒为单位指定，默认为 5 秒。要完全禁用它，只需将其设置为 0 秒，传输将尽快开始。\n# repl-diskless-sync-delay 5\n\n# 在很多情况下，磁盘比网络慢，存储和加载 RDB 文件可能会增加复制时间，甚至增加主服务器的 Copy on Write 内存和从缓冲区\n# "disabled"    - “禁用” - 不要使用无盘加载（先将 rdb 文件存储到磁盘）\n# "on-empty-db" - 仅在完全安全的情况下才使用无盘加载。\n# "swapdb"      - 在直接从socket字解析数据的同时，在 RAM 中保留当前数据库内容的副本。请注意，这需要足够的内存，如果没有，则可能会面临 OOM 杀死的风险。\n# repl-diskless-load disabled\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h2",{attrs:{id:"更快的-rdb-加载、"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更快的-rdb-加载、"}},[s._v("#")]),s._v(" 更快的 RDB 加载、")]),s._v(" "),n("p",[s._v("Redis 6.0，RDB 文件的加载速度比之前变得更快了。根据文件的实际组成（较大或较小的值），大概可以获得 20-30％ 的改进")]),s._v(" "),n("h2",{attrs:{id:"acl-访问权限控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#acl-访问权限控制"}},[s._v("#")]),s._v(" ACL 访问权限控制")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("redis6.0之前只提供了设置密码来控制安全访问，而6.0之后采用了更颗粒度细化的权限访问控制。")])]),s._v(" "),n("li",[n("p",[s._v("主要的命令")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("acl <command> args args ... \n    load              ：加载一个外部的acl文件\n    save              ：保存acl文件\n    list              ：查看所有acl用户，包含权限，状态等信息\n    users             ：查看所有用户名\n    setuser           ：创建用户\n    getuser           ：获取用户\n    deluser           ：删除用户\n    cat               ：查看category类\n    cat <category>    ：查看category类的命令\n    genpass           ：随机生成一个密码\n    whoami            : 查看当前的redis用户\n    log               : 查看acl的日志\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("ul",[n("li",[n("p",[s._v("auth mqz 123 : 切换用户为mqz")])]),s._v(" "),n("li",[n("p",[s._v("登陆redis客户端 ：redis-cli -h 127.0.0.1 -p 6379 -a mengqizhang")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("root@4b69cb513dff:/data# redis-cli -h 127.0.0.1 -p 6379 -a mengqizhang\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n127.0.0.1:6379> \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("使用acl whoami 查看当前用户，默认用户是 'default' ，拥有redis的root权限")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> acl whoami\n"default"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("创建一个用户mqz设置密码123，并且设置拥有所有key的权限")]),s._v(" "),n("li",[s._v("acl setuser mqz on >123 +@all ~*")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("127.0.0.1:6379> acl setuser mqz on >123 +@all ~*\nOK\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("只赋予mqz只有set命令的权限")]),s._v(" "),n("li",[s._v("acl setuser mqz -set")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("127.0.0.1:6379> acl setuser mqz -set\nOK\n127.0.0.1:6379> set key 1\n(error) NOPERM this user has no permissions to run the 'set' command or its subcommand\n127.0.0.1:6379> \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[n("p",[s._v("设置用户 normaluser 只能调用 Hash 类型的命令操作，而不能调用 String 类型的命令操作\nACL SETUSER normaluser +@hash -@string")])]),s._v(" "),n("li",[n("p",[s._v("设置用户 normaluser 只能对以“user:”为前缀的 key 进行命令操作\nACL SETUSER normaluser ~user:* +@all")])]),s._v(" "),n("li",[n("p",[s._v("acl支持粒度设置命令的操作访问权限")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("+<command> 将一个命令添加到用户可以调用的命令列表中\n-<command> 将一个命令从用户可以调用的命令列表移除\n+@<category> 将一类命令添加到用户可以调用的命令列表中\n-@<category> 将一类命令从到用户可以调用的命令列表移除\n+@all 允许用户调用所有命令操作\n-@all 禁止用户调用所有命令操作\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("ul",[n("li",[s._v("acl cat ： 查看 category")]),s._v(" "),n("li",[s._v("category可以看作是acl的类资源")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> acl cat\n 1) "keyspace"\n 2) "read"\n 3) "write"\n 4) "set"\n 5) "sortedset"\n 6) "list"\n 7) "hash"\n 8) "string"\n 9) "bitmap"\n10) "hyperloglog"\n11) "geo"\n12) "stream"\n13) "pubsub"\n14) "admin"\n15) "fast"\n16) "slow"\n17) "blocking"\n18) "dangerous"\n19) "connection"\n20) "transaction"\n21) "scripting"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("ul",[n("li",[s._v("acl cat category： 查看 category下的所有命令")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> acl cat set \n 1) "smove"\n 2) "sscan"\n 3) "sinter"\n 4) "srandmember"\n 5) "sinterstore"\n 6) "sunion"\n 7) "scard"\n 8) "sdiff"\n 9) "srem"\n10) "sdiffstore"\n11) "spop"\n12) "sadd"\n13) "sort"\n14) "sismember"\n15) "sunionstore"\n16) "smembers"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("ul",[n("li",[s._v("acl cat 查看 危险的category")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> acl cat dangerous \n 1) "flushdb"\n 2) "bgrewriteaof"\n 3) "swapdb"\n 4) "sync"\n 5) "slowlog"\n 6) "info"\n 7) "migrate"\n 8) "role"\n 9) "monitor"\n10) "psync"\n11) "restore-asking"\n12) "bgsave"\n13) "cluster"\n14) "replconf"\n15) "restore"\n16) "config"\n17) "replicaof"\n18) "lastsave"\n19) "flushall"\n20) "acl"\n21) "shutdown"\n22) "pfdebug"\n23) "debug"\n24) "sort"\n25) "slaveof"\n26) "keys"\n27) "client"\n28) "latency"\n29) "module"\n30) "save"\n31) "pfselftest"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("ul",[n("li",[s._v("acl getuser mqz 查看用户所有的权限及信息")]),s._v(" "),n("li",[s._v("用户支持多个密码！")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> auth mqz 123\nOK\n127.0.0.1:6379> acl getuser mqz\n1) "flags"\n2) 1) "on"\n   2) "allkeys"\n3) "passwords"\n4) 1) "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3"\n   2) "d9b76e73f74e659b11b26e4fac3aaf3d9d4da1e7b5d3f354bc0b04016f013c20"\n   3) "a32df4cf1279c8c1532ef759fbfd1ec7878dd7de07247c8c916f39ea32ec749c"\n5) "commands"\n6) "+@all -set"\n7) "keys"\n8) 1) "*"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("ul",[n("li",[s._v("acl list查看用户列表及权限")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> acl list\n1) "user default on #5e5224113e437c4a9600eb4f7b7b2c2d96782493f390880549353221d91f973b ~* +@all"\n2) "user mqz on #a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3 #d9b76e73f74e659b11b26e4fac3aaf3d9d4da1e7b5d3f354bc0b04016f013c20 #a32df4cf1279c8c1532ef759fbfd1ec7878dd7de07247c8c916f39ea32ec749c ~* +@all -set"\n3) "user mqznotset off -@all"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("on: 启用用户\noff:禁用用户，不能再使用该用户进行 AUTH 进行身份认证，若已经连接redis-cli的该用户仍然可以使用")]),s._v(" "),n("p",[s._v("~：添加可以在命令中提及的键模式。例如~和 allkeys 允许所有键。")]),s._v(" "),n("blockquote",[n("p",[s._v("mypass : 会将该用户密码list添加一个mypass的密码\n<mypass : 会将该用户密码list移除一个mypass的密码")])]),s._v(" "),n("ul",[n("li",[s._v("acl log 记录拒绝的命令，密钥访问和身份验证")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> acl log\n1)  1) "count"\n    2) (integer) 1\n    3) "reason"\n    4) "command"\n    5) "context"\n    6) "toplevel"\n    7) "object"\n    8) "set"\n    9) "username"\n   10) "mqz"\n   11) "age-seconds"\n   12) "3811.8359999999998"\n   13) "client-info"\n   14) "id=8 addr=127.0.0.1:38040 fd=10 name= age=186 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=29 qbuf-free=32739 argv-mem=7 obl=0 oll=0 omem=0 tot-mem=61471 events=r cmd=set user=mqz"\n2)  1) "count"\n    2) (integer) 1\n    3) "reason"\n    4) "auth"\n    5) "context"\n    6) "toplevel"\n    7) "object"\n    8) "auth"\n    9) "username"\n   10) "default"\n   11) "age-seconds"\n   12) "3858.8679999999999"\n   13) "client-info"\n   14) "id=8 addr=127.0.0.1:38040 fd=10 name= age=139 idle=1 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=29 qbuf-free=32739 argv-mem=13 obl=0 oll=0 omem=0 tot-mem=61469 events=r cmd=auth user=mqz"\n127.0.0.1:6379> \n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])]),n("ul",[n("li",[s._v("acl 可以使用外部的 .acl 文件来配置用户权限，该文件内容和 acl list内容一致")])]),s._v(" "),n("p",[s._v("acl deluser mqz 删除用户")]),s._v(" "),n("h2",{attrs:{id:"多io线程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多io线程"}},[s._v("#")]),s._v(" 多IO线程")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("Redis4.0版本之前使用的是单线程模型，它的单线程指的是网络IO处理、get、set命令操作是由单个线程上完成的\n但是Redis的持久化、集群同步还是使用其他线程、子线程（非主线程）完成的。")])]),s._v(" "),n("li",[n("p",[s._v("Redis4.0之后加入了多线程的支持，主要还是体现再大数据的异步删除功能，比如：unlink key、flushdb async、fluashall async\nAOF文件的重写（持久化方式之一） 都是在另外一个线程中执行的")])]),s._v(" "),n("li",[n("p",[s._v("Redis6.0之前的网络IO处理都是单线程的操作，在6.0之后，将网络IO处理改为了多线程，get、set的命令操作还是保持单线程的。\n因为Redis在处理请求的时候，网络处理经常是瓶颈，通过多个IO线程并行处理网络操作，可以提升Redis整体处理性能 （吞吐量提高）")])])]),s._v(" "),n("ul",[n("li",[s._v("IO多线程机制在6.0版本的配置文件中是默认关闭的状态，若要开启网络IO多线程处理，需要手动打开，配置线程个数\n官方建议： 4核的机器建议设置为2或3个线程，8核的建议设置为6个线程，线程数一定要小于机器核数。还需要注意的是，线程数并不是越大越好，官方认为超过了8个基本就没什么意义了。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("io-threads-do-reads no # on:开启 off：关闭\nio-threads 4 # 配置多线程数量，需要根据服务器的实际硬件情况设置，一般来说不得大于cpu核数\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("主要流程")])]),s._v(" "),n("ol",[n("li",[s._v("建立连接、分配线程、解析请求 和 执行命令：")]),s._v(" "),n("li",[s._v("回写Socket\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"网络IO流程A.png"}},[n("img",{attrs:{src:"%E7%BD%91%E7%BB%9CIO%E6%B5%81%E7%A8%8BA.png",alt:"img.png"}})]),s._v(" "),n("a",{attrs:{"data-fancybox":"",title:"111",href:"网络IO流程1.png"}},[n("img",{attrs:{src:"%E7%BD%91%E7%BB%9CIO%E6%B5%81%E7%A8%8B1.png",alt:"img.png"}})]),s._v(" "),n("a",{attrs:{"data-fancybox":"",title:"111",href:"网络IO流程2.png"}},[n("img",{attrs:{src:"%E7%BD%91%E7%BB%9CIO%E6%B5%81%E7%A8%8B2.png",alt:"img.png"}})])])]),s._v(" "),n("HideArticle")],1)}),[],!1,null,null,null);a.default=t.exports}}]);