(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{454:function(s,a,n){"use strict";n.r(a);var e=n(54),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"mysql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql"}},[s._v("#")]),s._v(" mysql")]),s._v(" "),n("h2",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),n("ul",[n("li",[s._v("docker run 安装单机版")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("  docker run -p 3306:3306 --name mysql5.7ByRun  --privileged=true -v /data/log:/var/log/mysql -v /data/data:/var/lib/mysql -v /data/conf:/etc/mysql -e MYSQL_ROOT_PASSWORD=mengqizhang -d mysql:5.7  \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("docker-compose 安装单机版")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("version: '3'\nservices:\n  mysql:\n    image: mysql:5.7\n    container_name: mysql7ByCompose\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - /data/log:/var/log/mysql\n      - /data/data:/var/lib/mysql\n      - /data/conf:/etc/mysql\n      # 下面是windows环境下目录挂载示例，和mac、linux稍微有点不同\n      # - /F/mqz/a-mqz-project/docker-mysql-volumn/log:/var/log/mysql\n      # - /F/mqz/a-mqz-project/docker-mysql-volumn/mysql/data/data:/var/lib/mysql\n      # - /F/mqz/a-mqz-project/docker-mysql-volumn/conf:/etc/mysql\n    privileged: true #针对chown: changing ownership of '/var/lib/mysql/': Input/output error 没权限的情况下\n    restart: on-failure\n    environment:\n      - MYSQL_ROOT_PASSWORD=mengqizhang\n      - TZ=Asia/Shanghai #设置容器时区\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h2",{attrs:{id:"mysql权限问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql权限问题"}},[s._v("#")]),s._v(" mysql权限问题")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"mysql权限问题.png"}},[n("img",{attrs:{src:"mysql%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98.png",alt:"权限问题"}})])]),s._v(" "),n("li",[s._v("查看权限： "),n("a",{attrs:{"data-fancybox":"",title:"111",href:"查看mysql权限.png"}},[n("img",{attrs:{src:"%E6%9F%A5%E7%9C%8Bmysql%E6%9D%83%E9%99%90.png",alt:"查看权限"}})])]),s._v(" "),n("li",[s._v("解决：\n"),n("ol",[n("li",[s._v("grant all privileges on "),n("em",[s._v(".")]),s._v(" to 'root'@'%' with grant option;")]),s._v(" "),n("li",[s._v("flush privileges;\nGRANT ALL PRIVILEGES ON "),n("em",[s._v(".")]),s._v(" TO 'root'@'%' IDENTIFIED BY 'mengqizhang' WITH GRANT OPTION;")])])])]),s._v(" "),n("h2",{attrs:{id:"数据库引擎"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据库引擎"}},[s._v("#")]),s._v(" 数据库引擎")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("查看mysql支持的数据库引擎： show engines;\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"mysql支持的数据库引擎.png"}},[n("img",{attrs:{src:"mysql%E6%94%AF%E6%8C%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%95%E6%93%8E.png",alt:"img.png"}})])])]),s._v(" "),n("li",[n("p",[s._v("默认使用的数据库引擎是： innoDB")])]),s._v(" "),n("li",[n("p",[s._v("InnoDB和MyISAM的区别：")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("MyISAM\n    mysql 5.5之前默认数据库引擎\n    不支持事务，当数据库崩溃后，无法安全恢复。查询速度比InnoDB快\n    只能支持表级所（table-level locking），不支持事务和行级锁\nInnoDB\n    InnoDB 支持行级锁(row-level locking)和表级锁,默认为行级锁\n    支持事务、并且具有事务(commit)、回滚(rollback)和崩溃修复能力(crash recovery capabilities)的事务安全(transaction-safe (ACID compliant))型表\n    mysql 5.5之后默认数据库引擎 \n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"数据库-navicat-ssh连接方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据库-navicat-ssh连接方式"}},[s._v("#")]),s._v(" 数据库 Navicat SSH连接方式")]),s._v(" "),n("ul",[n("li",[s._v("本质就是通过ssh登录一个服务器（mysql所在服务器或其他服务器），然后在这个服务器上连接mysql\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"navicate-ssh连接mysql-1.png"}},[n("img",{attrs:{src:"navicate-ssh%E8%BF%9E%E6%8E%A5mysql-1.png",alt:"navicate-ssh连接mysql-1.png"}})]),s._v(" "),n("a",{attrs:{"data-fancybox":"",title:"111",href:"navicate-ssh连接mysql-2.png"}},[n("img",{attrs:{src:"navicate-ssh%E8%BF%9E%E6%8E%A5mysql-2.png",alt:"navicate-ssh连接mysql-2.png"}})])])]),s._v(" "),n("h2",{attrs:{id:"springboot使用-jsch-实现-ssh连接mysql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#springboot使用-jsch-实现-ssh连接mysql"}},[s._v("#")]),s._v(" springboot使用 Jsch 实现 SSH连接mysql")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://gitee.com/DemoMeng/better-skills/tree/master/a-ssh",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://gitee.com/DemoMeng/better-skills/tree/master/a-ssh"),n("OutboundLink")],1)]),s._v(" "),n("h3",{attrs:{id:"jsch"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jsch"}},[s._v("#")]),s._v(" Jsch")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("JSch 是SSH2的一个纯Java实现。它允许你连接到一个sshd 服务器，使用端口转发，X11转发，文件传输等等。\n你可以将它的功能集成到你自己的 程序中。同时该项目也提供一个J2ME版本用来在手机上直连SSHD服务器。")])]),s._v(" "),n("li",[n("p",[s._v("常用的通道是： shell （构建shell窗口 ）、exec （执行命令）、sftp （文件操作）")])])]),s._v(" "),n("h3",{attrs:{id:"使用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用场景"}},[s._v("#")]),s._v(" 使用场景")]),s._v(" "),n("ul",[n("li",[s._v("程序操作完数据后需要定时执行脚本完成其他操作")]),s._v(" "),n("li",[s._v("springboot连接mysql采用ssh方式，间接访问ip限制的正式库")]),s._v(" "),n("li",[s._v("编辑服务器上的文件，主要为了修改一些配置文件")])]),s._v(" "),n("h3",{attrs:{id:"channelexec"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#channelexec"}},[s._v("#")]),s._v(" ChannelExec")]),s._v(" "),n("ul",[n("li",[s._v('执行某几条命令\n需要设置命令：channelExec.setCommand("cat /root/mqz/tomcat-erp/start.sh");\n并且需要读取返回的流')])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('InputStream in = channel.getInputStream();\nBufferedReader bufferedReader = new BufferedReader(new InputStreamReader(in,"UTF-8"));\nString buf = null;\nwhile((buf = bufferedReader.readLine()) != null) {\n  System.out.println("返回： "+ buf);\n}\nin.close();\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"channelshell"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#channelshell"}},[s._v("#")]),s._v(" ChannelShell")]),s._v(" "),n("ul",[n("li",[s._v("执行返回一个shell\n需要设置输入流： channelShell.setInputStream(System.in); //接收控制台输入")])]),s._v(" "),n("h3",{attrs:{id:"channelsftp"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#channelsftp"}},[s._v("#")]),s._v(" ChannelSftp")]),s._v(" "),n("ul",[n("li",[s._v("文件上传、下载对象")]),s._v(" "),n("li",[s._v("主要方法： 就是操作服务器的那些方法")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("put()：      文件上传\nget()：      文件下载\ncd()：       进入指定目录\nls()：       得到指定目录下的文件列表\nrename()：   重命名指定文件或目录\nrm()：       删除指定文件\nmkdir()：    创建目录\nrmdir()：    删除目录\nchmod():     文件授权\npwd():       获取当前目录\ngetHome():   获取home目录\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"sshconfiguration"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sshconfiguration"}},[s._v("#")]),s._v(" SSHConfiguration")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('// 构造函数\npublic SSHConfiguration(){\n    try{\n        log.info("SSH INIT.");\n        Session session=new JSch().getSession(\n                "root", // ssh用户名\n                "192.168.2.11",// 跳板机服务器（需要能登录正式服务器）\n                22);// 默认ssh端口\n        session.setConfig("StrictHostKeyChecking","no");// 跳过主机密钥检查\n        session.setPassword("123456"); // ssh登录密码\n        session.connect();\n        session.setPortForwardingL(\n                "localhost",// 绑定监听的地址\n                3308,// 绑定监听的端口\n                "xxx.xxx.xxx.xxx",// 正式服mysql的ip\n                3306); // 正式服mysql的端口\n    } catch(JSchException e ){\n        log.error("SSH JSchExceptionfailed.",e);\n    }catch(Exception e){\n        log.error("SSH settingsisfailed.skip!",e);\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("h1",{attrs:{id:"select-from-table-name-for-update-是行锁还是表锁"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#select-from-table-name-for-update-是行锁还是表锁"}},[s._v("#")]),s._v(" select * from table_name for update; 是行锁还是表锁 ？")]),s._v(" "),n("p",[s._v("select * from table_name for update; 会给行或者表加锁，这个锁是悲观锁，需要等别的进程释放才能使用资源\n具体实际操作步骤如下图：\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"forupdate是行锁还是表锁-设置关闭自动提交.png"}},[n("img",{attrs:{src:"forupdate%E6%98%AF%E8%A1%8C%E9%94%81%E8%BF%98%E6%98%AF%E8%A1%A8%E9%94%81-%E8%AE%BE%E7%BD%AE%E5%85%B3%E9%97%AD%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4.png",alt:"img.png"}})])]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"forupdate是行锁还是表锁-列有索引.png"}},[n("img",{attrs:{src:"forupdate%E6%98%AF%E8%A1%8C%E9%94%81%E8%BF%98%E6%98%AF%E8%A1%A8%E9%94%81-%E5%88%97%E6%9C%89%E7%B4%A2%E5%BC%95.png",alt:"img.png"}})])]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"forupdate是行锁还是表锁-列没有索引.png"}},[n("img",{attrs:{src:"forupdate%E6%98%AF%E8%A1%8C%E9%94%81%E8%BF%98%E6%98%AF%E8%A1%A8%E9%94%81-%E5%88%97%E6%B2%A1%E6%9C%89%E7%B4%A2%E5%BC%95.png",alt:"img.png"}})])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("最后发现：\n\n1. 当 where 条件字段上是主键或者是有索引的列，那么就是行级锁\n2. 当 where 条件字段上没有索引，就是表级锁\n3. 当 for update 查询出来语句没有查到数据，则不会添加锁！\n      如： select * from table_name where id = 0 for update;\n4. for update 是写锁，读操作不会被锁住\n5. 若不开启事务，则 for update 不会加锁      \n      \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("ul",[n("li",[s._v("mysql 的锁：\n当数据库有并发事务的时候，可能会产生数据不一致，这个时候需要用锁机制来进行协调和计算。")])]),s._v(" "),n("ul",[n("li",[s._v("InnoDB与MYISAM的最大不同有两点：\nInnoDB支持事务\nInnoDB支持行级锁\nMYISAM： 采用表级锁\nInnoDB:  支持表级锁和行级锁，默认是行级锁")])]),s._v(" "),n("p",[s._v("1.性能上划分： 悲观锁、乐观锁")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("    悲观锁： 假设会发生并发冲突，（考虑到存在并且肯跟会发生的并发冲突下）屏蔽一切可能违反数据完整性的操作，在查询完数据的时候就把事务锁起来，知道事务提交。\n           实现方式 ： 数据库中的锁机制 （读锁、写锁）\n    乐观锁： 假设不会发生并发冲突，只在提交的操作检查是否违反了数据完整性，在修改数据的时候把事务锁起来，通过version方式来进行处理\n           实现方式 ： 版本号方式，或者CAS算法实现\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("2.操作类型划分：（读锁和写锁都是悲观锁）")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("    读锁（共享锁、S锁(Shared) ）： 针对同一份数据，多个读操作可以同时进行而不会互相影响。\n    写锁（排他锁、X锁(eXclusive) ）：当前写操作没有完成前，它会阻断其他写锁和读锁。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("3.数据操作的粒度：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("        表级锁： （颗粒度最大的锁）对整个表加锁，实现简单，资源消耗少，别大部分Mysql引擎支持（MYISAM 和 InnoDB均支持 表级锁），表级锁定氛围共享锁（读锁）和拍他锁（写锁）\n                特点： 开销小，加锁快，不会出现思索，锁定颗粒度大，发出锁冲突的概率最高，并发度最低。\n        行级锁： （颗粒度最小的锁）行锁每次操作锁住一行数据，一个session开启事务更新不提交，另一个session更新同一条记录会阻塞，更新不同记录不会阻塞 （这个看具体字段，id/索引字段不会阻塞，否则会阻塞）。\n                特点： 开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度最高。\n                \n        页级锁： 颗粒度介于行级锁和表级锁之间的一种锁，表级锁加锁速度快，但是冲突多，行级锁加锁速度慢。所以折中的页级锁，一次锁定相邻的一组记录\n                特点： 开销和加锁速度介于表锁和行锁之间，会出现死锁，加锁粒度介于表锁和行锁之间，并发度也处于二者之间\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h1",{attrs:{id:"mysql函数-group-concat、find-in-set使用-及其二者搭配使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql函数-group-concat、find-in-set使用-及其二者搭配使用"}},[s._v("#")]),s._v(" Mysql函数 GROUP_CONCAT、FIND_IN_SET使用，及其二者搭配使用")]),s._v(" "),n("h3",{attrs:{id:"group-concat-使用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#group-concat-使用场景"}},[s._v("#")]),s._v(" GROUP_CONCAT 使用场景：")]),s._v(" "),n("ol",[n("li",[s._v("用户角色： 多个角色用逗号隔开 如： 管理员、超级管理员")]),s._v(" "),n("li",[s._v("用户爱好： 多个爱好用逗号隔开 如： 篮球、足球")]),s._v(" "),n("li",[s._v("博客、文章、产品创建标签： 如： 运动、旅行、知识内容")])]),s._v(" "),n("h3",{attrs:{id:"group-concat-函数使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#group-concat-函数使用"}},[s._v("#")]),s._v(" GROUP_CONCAT 函数使用")]),s._v(" "),n("p",[s._v('语法： GROUP_CONCAT(DISTINCT 字段 ORDER BY 字段 SEPARATOR "," )\n解析：\nDISTINCT 用于消除字段的重复值\nORDER BY 用于对字段进行排序，最终结果显示在连接后的字符中，默认情况下按照升序\nSEPARATOR 用于在组之间进行分割的字符，默认是 ","\nGROUP_CONCAT 忽略NULL值，如果找不到匹配的行或者所有参数都为NULL，则最后也返回NULL\nGROUP_CONCAT 返回二进制或者非二进制字符串，这取决雨参数，默认情况下，返回字符串的最大长度为1024。\n可以通过设置 group_concat_max_len 系统变量来扩展最大长度')]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SET GLOBAL group_concat_max_len=102400;\nSET SESSION group_concat_mac_len=102400;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("或者修改配置文件：my.ini\n[mysqld]\ngroup_concat_max_len = 102400")]),s._v(" "),n("p",[s._v("现有 角色表：user_sys_role 和 用户角色表：user_role，表大概结构和数据如下：\nuser_sys_role:\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"GROUP_CONCAT和FIND_IN_SET使用-user_sys_role表结构数据.png"}},[n("img",{attrs:{src:"GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-user_sys_role%E8%A1%A8%E7%BB%93%E6%9E%84%E6%95%B0%E6%8D%AE.png",alt:"img.png"}})]),s._v("\nuser_role:\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"GROUP_CONCAT和FIND_IN_SET使用-user-role数据和结构.png"}},[n("img",{attrs:{src:"GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-user-role%E6%95%B0%E6%8D%AE%E5%92%8C%E7%BB%93%E6%9E%84.png",alt:"img_1.png"}})])]),s._v(" "),n("ul",[n("li",[s._v("单表\n单表使用 group_concat()函数能将组中的字符串连接成具有某个连接符连接的单个字符\n如下：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('select \n\tGROUP_CONCAT(name order by id desc SEPARATOR ",") as all_role\nfrom user_sys_role   \n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"GROUP_CONCAT和FIND_IN_SET使用-group_concat单表使用.png"}},[n("img",{attrs:{src:"GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-group_concat%E5%8D%95%E8%A1%A8%E4%BD%BF%E7%94%A8.png",alt:"img_2.png"}})])]),s._v(" "),n("ul",[n("li",[s._v("多表\n场景： 一个用户拥有多个角色，现在要查询所有用户的所有角色在一个字段上显示，可以使用GROUP_CONCAT()函数，并且搭配group by分组函数使用\n如下：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("select\n      l.user_id as user_id,\n      GROUP_CONCAT(i.id order by i.id desc SEPARATOR ',') as role_id,\n      GROUP_CONCAT(i.name order by i.name asc SEPARATOR ',' ) as role_name\nfrom user_sys_user_role l\nleft join user_sys_role i ON l.role_id = i.id\ngroup by l.user_id\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"GROUP_CONCAT和FIND_IN_SET使用-group_concat多表使用.png"}},[n("img",{attrs:{src:"GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-group_concat%E5%A4%9A%E8%A1%A8%E4%BD%BF%E7%94%A8.png",alt:"img_3.png"}})])]),s._v(" "),n("h3",{attrs:{id:"group-concat-使用注意事项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#group-concat-使用注意事项"}},[s._v("#")]),s._v(" GROUP_CONCAT 使用注意事项")]),s._v(" "),n("ol",[n("li",[s._v("GROUP_CONCAT 返回单个字符串，而不是值列表，所以不能在使用 IN、NOT IN 进行查询")]),s._v(" "),n("li",[s._v("GROUP_CONCAT 返回的结果，作为子查询使用，可以使用 FIND_IN_SET 函数")]),s._v(" "),n("li",[s._v("GROUP_CONCAT 函数是一个聚合函数，如果要对值进行排序，需要在GROUP_CONCAT 函数内使用ORDER BY，而不是在 SELECT语句中使用 ORDER BY\n若需要对非 GROUP_CONCAT操作的列排序，可以再嵌套一层查询 ！！")])]),s._v(" "),n("h3",{attrs:{id:"group-concat-和-find-in-set-搭配使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#group-concat-和-find-in-set-搭配使用"}},[s._v("#")]),s._v(" GROUP_CONCAT 和 FIND_IN_SET 搭配使用")]),s._v(" "),n("p",[s._v("查询那些用户是有超级管理员权限：\n如：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('select * from (\nselect\n      l.user_id as user_id,\n      GROUP_CONCAT(i.id ) as role_id,\n      GROUP_CONCAT(i.name ) as role_name\nfrom user_sys_user_role l\nleft join user_sys_role i ON l.role_id = i.id\ngroup by l.user_id\n) x where FIND_IN_SET("1",x.role_id)\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"GROUP_CONCAT和FIND_IN_SET使用-group_concat和find_in_set搭配使用.png"}},[n("img",{attrs:{src:"GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-group_concat%E5%92%8Cfind_in_set%E6%90%AD%E9%85%8D%E4%BD%BF%E7%94%A8.png",alt:"img_4.png"}})])]),s._v(" "),n("h3",{attrs:{id:"find-in-set"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#find-in-set"}},[s._v("#")]),s._v(" FIND_IN_SET")]),s._v(" "),n("p",[s._v('FIND_IN_SET(str,strlist)\n假如str在N个字符组成strlist中，返回值则为1到N之间，strlist之间的连接符号以 "," 连接。如果是查询数据表，则返回数据\n若str不在strlist中，则返回0。若str或strlist有一个是null，则返回是null')]),s._v(" "),n("p",[s._v("语法： FIND_IN_SET(str,strlist)\nstr 要查询的字符串\nstrlist 是被查询字段组，并且按 ',' 分隔，如：(1,2)\n查询字段(strList)中包含的结果，返回结果null、记录、或者所在位置")]),s._v(" "),n("p",[s._v("使用场景：\n1. 角色权限字段若是在一个字段中，则可以根据 FIND_IN_SET 进行精准匹配\n2. 多表的时候，主表的状态需要根据子表决定，可以搭配使用 GROUP_CONCAT 和 FIND_IN_SET 使用\n如：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('select * from (\nselect\n      l.user_id as user_id,\n      GROUP_CONCAT(i.id ) as role_id,\n      GROUP_CONCAT(i.name ) as role_name\nfrom user_sys_user_role l\nleft join user_sys_role i ON l.role_id = i.id\ngroup by l.user_id\n) x where FIND_IN_SET("1",x.role_id)\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[n("a",{attrs:{"data-fancybox":"",title:"111",href:"GROUP_CONCAT和FIND_IN_SET使用-group_concat和find_in_set搭配使用.png"}},[n("img",{attrs:{src:"GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-group_concat%E5%92%8Cfind_in_set%E6%90%AD%E9%85%8D%E4%BD%BF%E7%94%A8.png",alt:"img_4.png"}})])]),s._v(" "),n("p",[s._v("使用")]),s._v(" "),n("ul",[n("li",[n("p",[s._v('select FIND_IN_SET("蒙大拿","蒙大难,mengdana,mememme,蒙大,蒙大拿")\n'),n("a",{attrs:{"data-fancybox":"",title:"111",href:"GROUP_CONCAT和FIND_IN_SET使用-find_in_set使用1.png"}},[n("img",{attrs:{src:"GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-find_in_set%E4%BD%BF%E7%94%A81.png",alt:"img_5.png"}})])])]),s._v(" "),n("li",[n("p",[s._v("select id,name,remarks from user_sys_role where FIND_IN_SET('篮球',remarks)\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"GROUP_CONCAT和FIND_IN_SET使用-find_in_set使用2.png"}},[n("img",{attrs:{src:"GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-find_in_set%E4%BD%BF%E7%94%A82.png",alt:"img_6.png"}})])])])]),s._v(" "),n("h3",{attrs:{id:"find-in-set-和-in-区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#find-in-set-和-in-区别"}},[s._v("#")]),s._v(" FIND_IN_SET 和 IN 区别")]),s._v(" "),n("p",[s._v("IN 需要字段的所有值均相等的时候才会满足，\nFIND_IN_SET 只要 ',' 分隔的字符有一个匹配就会命中查询\n所以FIND_IN_SET相比于IN查询，IN精准把握不准确")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("select id,name,remarks from user_sys_role where FIND_IN_SET('篮球',remarks)\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"GROUP_CONCAT和FIND_IN_SET使用-find_in_set使用2.png"}},[n("img",{attrs:{src:"GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-find_in_set%E4%BD%BF%E7%94%A82.png",alt:"img_6.png"}})])])]),s._v(" "),n("li",[n("p",[s._v("select id,name,remarks from user_sys_role where remarks in('篮球')\n"),n("a",{attrs:{"data-fancybox":"",title:"111",href:"GROUP_CONCAT和FIND_IN_SET使用-find_in_set使用3.png"}},[n("img",{attrs:{src:"GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-find_in_set%E4%BD%BF%E7%94%A83.png",alt:"img_7.png"}})])])])])])}),[],!1,null,null,null);a.default=t.exports}}]);