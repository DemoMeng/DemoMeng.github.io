<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mysql | 蒙大拿</title>
    <meta name="generator" content="VuePress 1.9.5">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script charset="utf-8" src="https://my.openwrite.cn/js/readmore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <meta name="description" content="蒙大拿的博客">
    
    <link rel="preload" href="/mengqizhang/assets/css/0.styles.a1d09170.css" as="style"><link rel="preload" href="/mengqizhang/assets/js/app.a8d21a83.js" as="script"><link rel="preload" href="/mengqizhang/assets/js/2.e69c46bd.js" as="script"><link rel="preload" href="/mengqizhang/assets/js/67.15d5b718.js" as="script"><link rel="prefetch" href="/mengqizhang/assets/js/10.11174a82.js"><link rel="prefetch" href="/mengqizhang/assets/js/100.bd6553c3.js"><link rel="prefetch" href="/mengqizhang/assets/js/101.ac07962b.js"><link rel="prefetch" href="/mengqizhang/assets/js/102.79bec0af.js"><link rel="prefetch" href="/mengqizhang/assets/js/103.0c0a0808.js"><link rel="prefetch" href="/mengqizhang/assets/js/104.3ed6d392.js"><link rel="prefetch" href="/mengqizhang/assets/js/105.be22e8c8.js"><link rel="prefetch" href="/mengqizhang/assets/js/106.efa39ac4.js"><link rel="prefetch" href="/mengqizhang/assets/js/107.545ffb45.js"><link rel="prefetch" href="/mengqizhang/assets/js/108.cf23c097.js"><link rel="prefetch" href="/mengqizhang/assets/js/109.3339ffad.js"><link rel="prefetch" href="/mengqizhang/assets/js/11.08defbae.js"><link rel="prefetch" href="/mengqizhang/assets/js/110.bafd2f00.js"><link rel="prefetch" href="/mengqizhang/assets/js/12.25a3365c.js"><link rel="prefetch" href="/mengqizhang/assets/js/13.9b88bf7d.js"><link rel="prefetch" href="/mengqizhang/assets/js/14.c4d7ed3a.js"><link rel="prefetch" href="/mengqizhang/assets/js/15.b407b696.js"><link rel="prefetch" href="/mengqizhang/assets/js/16.1c08698a.js"><link rel="prefetch" href="/mengqizhang/assets/js/17.8a25e983.js"><link rel="prefetch" href="/mengqizhang/assets/js/18.e34bf6a6.js"><link rel="prefetch" href="/mengqizhang/assets/js/19.68d7669f.js"><link rel="prefetch" href="/mengqizhang/assets/js/20.de14558d.js"><link rel="prefetch" href="/mengqizhang/assets/js/21.56869e5e.js"><link rel="prefetch" href="/mengqizhang/assets/js/22.aea26c9b.js"><link rel="prefetch" href="/mengqizhang/assets/js/23.4a0b2ea3.js"><link rel="prefetch" href="/mengqizhang/assets/js/24.58c270f0.js"><link rel="prefetch" href="/mengqizhang/assets/js/25.413aed44.js"><link rel="prefetch" href="/mengqizhang/assets/js/26.5ebfde8b.js"><link rel="prefetch" href="/mengqizhang/assets/js/27.48dd442a.js"><link rel="prefetch" href="/mengqizhang/assets/js/28.d2afcf03.js"><link rel="prefetch" href="/mengqizhang/assets/js/29.b928e199.js"><link rel="prefetch" href="/mengqizhang/assets/js/3.7aafc190.js"><link rel="prefetch" href="/mengqizhang/assets/js/30.4c1cbe1a.js"><link rel="prefetch" href="/mengqizhang/assets/js/31.77073e2d.js"><link rel="prefetch" href="/mengqizhang/assets/js/32.5f66f7a2.js"><link rel="prefetch" href="/mengqizhang/assets/js/33.a8272e84.js"><link rel="prefetch" href="/mengqizhang/assets/js/34.3b8ea135.js"><link rel="prefetch" href="/mengqizhang/assets/js/35.100b34a0.js"><link rel="prefetch" href="/mengqizhang/assets/js/36.06cb633d.js"><link rel="prefetch" href="/mengqizhang/assets/js/37.f3d4b763.js"><link rel="prefetch" href="/mengqizhang/assets/js/38.733d311d.js"><link rel="prefetch" href="/mengqizhang/assets/js/39.8434909a.js"><link rel="prefetch" href="/mengqizhang/assets/js/4.000c3dbd.js"><link rel="prefetch" href="/mengqizhang/assets/js/40.dd341745.js"><link rel="prefetch" href="/mengqizhang/assets/js/41.1fcf309c.js"><link rel="prefetch" href="/mengqizhang/assets/js/42.1cc69bad.js"><link rel="prefetch" href="/mengqizhang/assets/js/43.fefa3ac7.js"><link rel="prefetch" href="/mengqizhang/assets/js/44.d284f8c1.js"><link rel="prefetch" href="/mengqizhang/assets/js/45.2564339d.js"><link rel="prefetch" href="/mengqizhang/assets/js/46.23627a8c.js"><link rel="prefetch" href="/mengqizhang/assets/js/47.cecbf290.js"><link rel="prefetch" href="/mengqizhang/assets/js/48.bad75ece.js"><link rel="prefetch" href="/mengqizhang/assets/js/49.2fa60a3e.js"><link rel="prefetch" href="/mengqizhang/assets/js/5.9832e234.js"><link rel="prefetch" href="/mengqizhang/assets/js/50.f3159852.js"><link rel="prefetch" href="/mengqizhang/assets/js/51.738bce4a.js"><link rel="prefetch" href="/mengqizhang/assets/js/52.efc0fa7e.js"><link rel="prefetch" href="/mengqizhang/assets/js/53.8d0c00f1.js"><link rel="prefetch" href="/mengqizhang/assets/js/54.a519e682.js"><link rel="prefetch" href="/mengqizhang/assets/js/55.9652e586.js"><link rel="prefetch" href="/mengqizhang/assets/js/56.c88f759b.js"><link rel="prefetch" href="/mengqizhang/assets/js/57.c6f3cd20.js"><link rel="prefetch" href="/mengqizhang/assets/js/58.0c040aca.js"><link rel="prefetch" href="/mengqizhang/assets/js/59.fc5ce388.js"><link rel="prefetch" href="/mengqizhang/assets/js/6.48810bdc.js"><link rel="prefetch" href="/mengqizhang/assets/js/60.a50c0285.js"><link rel="prefetch" href="/mengqizhang/assets/js/61.ab6648f5.js"><link rel="prefetch" href="/mengqizhang/assets/js/62.f589c0b8.js"><link rel="prefetch" href="/mengqizhang/assets/js/63.df4a0587.js"><link rel="prefetch" href="/mengqizhang/assets/js/64.e5f1a0d6.js"><link rel="prefetch" href="/mengqizhang/assets/js/65.94e94ec2.js"><link rel="prefetch" href="/mengqizhang/assets/js/66.9a0f92dc.js"><link rel="prefetch" href="/mengqizhang/assets/js/68.ca0d798d.js"><link rel="prefetch" href="/mengqizhang/assets/js/69.4de863fa.js"><link rel="prefetch" href="/mengqizhang/assets/js/7.2f8cbddd.js"><link rel="prefetch" href="/mengqizhang/assets/js/70.7c1bcd59.js"><link rel="prefetch" href="/mengqizhang/assets/js/71.70f3e9ec.js"><link rel="prefetch" href="/mengqizhang/assets/js/72.ca361407.js"><link rel="prefetch" href="/mengqizhang/assets/js/73.95c0b000.js"><link rel="prefetch" href="/mengqizhang/assets/js/74.673e240c.js"><link rel="prefetch" href="/mengqizhang/assets/js/75.f5cf8815.js"><link rel="prefetch" href="/mengqizhang/assets/js/76.30b8a8fb.js"><link rel="prefetch" href="/mengqizhang/assets/js/77.0bdfd82b.js"><link rel="prefetch" href="/mengqizhang/assets/js/78.a21a9dee.js"><link rel="prefetch" href="/mengqizhang/assets/js/79.5c55aff9.js"><link rel="prefetch" href="/mengqizhang/assets/js/8.507fce61.js"><link rel="prefetch" href="/mengqizhang/assets/js/80.aa70b0e8.js"><link rel="prefetch" href="/mengqizhang/assets/js/81.1cb55142.js"><link rel="prefetch" href="/mengqizhang/assets/js/82.50b720b1.js"><link rel="prefetch" href="/mengqizhang/assets/js/83.85834849.js"><link rel="prefetch" href="/mengqizhang/assets/js/84.e2f1cab8.js"><link rel="prefetch" href="/mengqizhang/assets/js/85.c154565c.js"><link rel="prefetch" href="/mengqizhang/assets/js/86.c5dbbd95.js"><link rel="prefetch" href="/mengqizhang/assets/js/87.2b62cc5e.js"><link rel="prefetch" href="/mengqizhang/assets/js/88.5deb957d.js"><link rel="prefetch" href="/mengqizhang/assets/js/89.fbed7b0f.js"><link rel="prefetch" href="/mengqizhang/assets/js/9.70c1c418.js"><link rel="prefetch" href="/mengqizhang/assets/js/90.8efb35d5.js"><link rel="prefetch" href="/mengqizhang/assets/js/91.a3da2ba6.js"><link rel="prefetch" href="/mengqizhang/assets/js/92.1f9bf6c0.js"><link rel="prefetch" href="/mengqizhang/assets/js/93.862f4101.js"><link rel="prefetch" href="/mengqizhang/assets/js/94.1a0c5762.js"><link rel="prefetch" href="/mengqizhang/assets/js/95.6df0f77b.js"><link rel="prefetch" href="/mengqizhang/assets/js/96.90bef310.js"><link rel="prefetch" href="/mengqizhang/assets/js/97.fa2b5f10.js"><link rel="prefetch" href="/mengqizhang/assets/js/98.d84c6b84.js"><link rel="prefetch" href="/mengqizhang/assets/js/99.785b4a31.js">
    <link rel="stylesheet" href="/mengqizhang/assets/css/0.styles.a1d09170.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mengqizhang/" class="home-link router-link-active"><!----> <span class="site-name">蒙大拿</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mengqizhang/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://gitee.com/DemoMeng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mengqizhang/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://gitee.com/DemoMeng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试 📖🔥🔥</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/环境配置/" class="sidebar-heading clickable"><span>环境配置 🔧</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/消息队列/" class="sidebar-heading clickable"><span>消息队列 🔥🔥🔥</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/数据层/" class="sidebar-heading clickable open"><span>数据层 🔥🔥🔥</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>mysql</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mengqizhang/%E6%95%B0%E6%8D%AE%E5%B1%82/mysql/" aria-current="page" class="active sidebar-link">简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mengqizhang/%E6%95%B0%E6%8D%AE%E5%B1%82/mysql/#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/%E6%95%B0%E6%8D%AE%E5%B1%82/mysql/#mysql权限问题" class="sidebar-link">mysql权限问题</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/%E6%95%B0%E6%8D%AE%E5%B1%82/mysql/#数据库引擎" class="sidebar-link">数据库引擎</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/%E6%95%B0%E6%8D%AE%E5%B1%82/mysql/#数据库-navicat-ssh连接方式" class="sidebar-link">数据库 Navicat SSH连接方式</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/%E6%95%B0%E6%8D%AE%E5%B1%82/mysql/#springboot使用-jsch-实现-ssh连接mysql" class="sidebar-link">springboot使用 Jsch 实现 SSH连接mysql</a></li></ul></li><li><a href="/mengqizhang/数据层/mysql/mysql集群.html" class="sidebar-link">集群</a></li><li><a href="/mengqizhang/数据层/mysql/读写分离.html" class="sidebar-link">读写分离</a></li><li><a href="/mengqizhang/数据层/mysql/ApacheShardingSphere介绍.html" class="sidebar-link">ApacheShardingSphere</a></li><li><a href="/mengqizhang/数据层/mysql/binlog.html" class="sidebar-link">binlog</a></li><li><a href="/mengqizhang/数据层/mysql/分库分表.html" class="sidebar-link">分库分表</a></li><li><a href="/mengqizhang/数据层/mysql/SQL.html" class="sidebar-link">SQL优化</a></li><li><a href="/mengqizhang/数据层/mysql/redo.html" class="sidebar-link">redo日志</a></li><li><a href="/mengqizhang/数据层/mysql/mysql索引数据结构.html" class="sidebar-link">mysql索引数据结构</a></li><li><a href="/mengqizhang/数据层/mysql/面试题.html" class="sidebar-link">面试题</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>mybatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/容器化/" class="sidebar-heading clickable"><span>容器化 🐳</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java ☕️</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式事务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式系统 ☁️</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webSocket</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ELK 🔍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx 🇷🇺</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>jenkins 👴</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器 💰</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>测试 😓</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>监控告警</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql"><a href="#mysql" class="header-anchor">#</a> mysql</h1> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <ul><li>docker run 安装单机版</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>  docker run -p 3306:3306 --name mysql5.7ByRun  --privileged=true -v /data/log:/var/log/mysql -v /data/data:/var/lib/mysql -v /data/conf:/etc/mysql -e MYSQL_ROOT_PASSWORD=mengqizhang -d mysql:5.7  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>docker-compose 安装单机版</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3'
services:
  mysql:
    image: mysql:5.7
    container_name: mysql7ByCompose
    ports:
      - &quot;3306:3306&quot;
    volumes:
      - /data/log:/var/log/mysql
      - /data/data:/var/lib/mysql
      - /data/conf:/etc/mysql
      # 下面是windows环境下目录挂载示例，和mac、linux稍微有点不同
      # - /F/mqz/a-mqz-project/docker-mysql-volumn/log:/var/log/mysql
      # - /F/mqz/a-mqz-project/docker-mysql-volumn/mysql/data/data:/var/lib/mysql
      # - /F/mqz/a-mqz-project/docker-mysql-volumn/conf:/etc/mysql
    privileged: true #针对chown: changing ownership of '/var/lib/mysql/': Input/output error 没权限的情况下
    restart: on-failure
    environment:
      - MYSQL_ROOT_PASSWORD=mengqizhang
      - TZ=Asia/Shanghai #设置容器时区
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="mysql权限问题"><a href="#mysql权限问题" class="header-anchor">#</a> mysql权限问题</h2> <ul><li><a data-fancybox="" title="111" href="mysql权限问题.png"><img src="mysql%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98.png" alt="权限问题"></a></li> <li>查看权限： <a data-fancybox="" title="111" href="查看mysql权限.png"><img src="%E6%9F%A5%E7%9C%8Bmysql%E6%9D%83%E9%99%90.png" alt="查看权限"></a></li> <li>解决：
<ol><li>grant all privileges on <em>.</em> to 'root'@'%' with grant option;</li> <li>flush privileges;
GRANT ALL PRIVILEGES ON <em>.</em> TO 'root'@'%' IDENTIFIED BY 'mengqizhang' WITH GRANT OPTION;</li></ol></li></ul> <h2 id="数据库引擎"><a href="#数据库引擎" class="header-anchor">#</a> 数据库引擎</h2> <ul><li><p>查看mysql支持的数据库引擎： show engines;
<a data-fancybox="" title="111" href="mysql支持的数据库引擎.png"><img src="mysql%E6%94%AF%E6%8C%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%95%E6%93%8E.png" alt="img.png"></a></p></li> <li><p>默认使用的数据库引擎是： innoDB</p></li> <li><p>InnoDB和MyISAM的区别：</p></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>MyISAM
    mysql 5.5之前默认数据库引擎
    不支持事务，当数据库崩溃后，无法安全恢复。查询速度比InnoDB快
    只能支持表级所（table-level locking），不支持事务和行级锁
InnoDB
    InnoDB 支持行级锁(row-level locking)和表级锁,默认为行级锁
    支持事务、并且具有事务(commit)、回滚(rollback)和崩溃修复能力(crash recovery capabilities)的事务安全(transaction-safe (ACID compliant))型表
    mysql 5.5之后默认数据库引擎 

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="数据库-navicat-ssh连接方式"><a href="#数据库-navicat-ssh连接方式" class="header-anchor">#</a> 数据库 Navicat SSH连接方式</h2> <ul><li>本质就是通过ssh登录一个服务器（mysql所在服务器或其他服务器），然后在这个服务器上连接mysql
<a data-fancybox="" title="111" href="navicate-ssh连接mysql-1.png"><img src="navicate-ssh%E8%BF%9E%E6%8E%A5mysql-1.png" alt="navicate-ssh连接mysql-1.png"></a> <a data-fancybox="" title="111" href="navicate-ssh连接mysql-2.png"><img src="navicate-ssh%E8%BF%9E%E6%8E%A5mysql-2.png" alt="navicate-ssh连接mysql-2.png"></a></li></ul> <h2 id="springboot使用-jsch-实现-ssh连接mysql"><a href="#springboot使用-jsch-实现-ssh连接mysql" class="header-anchor">#</a> springboot使用 Jsch 实现 SSH连接mysql</h2> <p><a href="https://gitee.com/DemoMeng/better-skills/tree/master/a-ssh" target="_blank" rel="noopener noreferrer">https://gitee.com/DemoMeng/better-skills/tree/master/a-ssh<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="jsch"><a href="#jsch" class="header-anchor">#</a> Jsch</h3> <ul><li><p>JSch 是SSH2的一个纯Java实现。它允许你连接到一个sshd 服务器，使用端口转发，X11转发，文件传输等等。
你可以将它的功能集成到你自己的 程序中。同时该项目也提供一个J2ME版本用来在手机上直连SSHD服务器。</p></li> <li><p>常用的通道是： shell （构建shell窗口 ）、exec （执行命令）、sftp （文件操作）</p></li></ul> <h3 id="使用场景"><a href="#使用场景" class="header-anchor">#</a> 使用场景</h3> <ul><li>程序操作完数据后需要定时执行脚本完成其他操作</li> <li>springboot连接mysql采用ssh方式，间接访问ip限制的正式库</li> <li>编辑服务器上的文件，主要为了修改一些配置文件</li></ul> <h3 id="channelexec"><a href="#channelexec" class="header-anchor">#</a> ChannelExec</h3> <ul><li>执行某几条命令
需要设置命令：channelExec.setCommand(&quot;cat /root/mqz/tomcat-erp/start.sh&quot;);
并且需要读取返回的流</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>InputStream in = channel.getInputStream();
BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(in,&quot;UTF-8&quot;));
String buf = null;
while((buf = bufferedReader.readLine()) != null) {
  System.out.println(&quot;返回： &quot;+ buf);
}
in.close();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="channelshell"><a href="#channelshell" class="header-anchor">#</a> ChannelShell</h3> <ul><li>执行返回一个shell
需要设置输入流： channelShell.setInputStream(System.in); //接收控制台输入</li></ul> <h3 id="channelsftp"><a href="#channelsftp" class="header-anchor">#</a> ChannelSftp</h3> <ul><li>文件上传、下载对象</li> <li>主要方法： 就是操作服务器的那些方法</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>put()：      文件上传
get()：      文件下载
cd()：       进入指定目录
ls()：       得到指定目录下的文件列表
rename()：   重命名指定文件或目录
rm()：       删除指定文件
mkdir()：    创建目录
rmdir()：    删除目录
chmod():     文件授权
pwd():       获取当前目录
getHome():   获取home目录
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="sshconfiguration"><a href="#sshconfiguration" class="header-anchor">#</a> SSHConfiguration</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 构造函数
public SSHConfiguration(){
    try{
        log.info(&quot;SSH INIT.&quot;);
        Session session=new JSch().getSession(
                &quot;root&quot;, // ssh用户名
                &quot;192.168.2.11&quot;,// 跳板机服务器（需要能登录正式服务器）
                22);// 默认ssh端口
        session.setConfig(&quot;StrictHostKeyChecking&quot;,&quot;no&quot;);// 跳过主机密钥检查
        session.setPassword(&quot;123456&quot;); // ssh登录密码
        session.connect();
        session.setPortForwardingL(
                &quot;localhost&quot;,// 绑定监听的地址
                3308,// 绑定监听的端口
                &quot;xxx.xxx.xxx.xxx&quot;,// 正式服mysql的ip
                3306); // 正式服mysql的端口
    } catch(JSchException e ){
        log.error(&quot;SSH JSchExceptionfailed.&quot;,e);
    }catch(Exception e){
        log.error(&quot;SSH settingsisfailed.skip!&quot;,e);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h1 id="select-from-table-name-for-update-是行锁还是表锁"><a href="#select-from-table-name-for-update-是行锁还是表锁" class="header-anchor">#</a> select * from table_name for update; 是行锁还是表锁 ？</h1> <p>select * from table_name for update; 会给行或者表加锁，这个锁是悲观锁，需要等别的进程释放才能使用资源
具体实际操作步骤如下图：
<a data-fancybox="" title="111" href="forupdate是行锁还是表锁-设置关闭自动提交.png"><img src="forupdate%E6%98%AF%E8%A1%8C%E9%94%81%E8%BF%98%E6%98%AF%E8%A1%A8%E9%94%81-%E8%AE%BE%E7%BD%AE%E5%85%B3%E9%97%AD%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4.png" alt="img.png"></a></p> <p><a data-fancybox="" title="111" href="forupdate是行锁还是表锁-列有索引.png"><img src="forupdate%E6%98%AF%E8%A1%8C%E9%94%81%E8%BF%98%E6%98%AF%E8%A1%A8%E9%94%81-%E5%88%97%E6%9C%89%E7%B4%A2%E5%BC%95.png" alt="img.png"></a></p> <p><a data-fancybox="" title="111" href="forupdate是行锁还是表锁-列没有索引.png"><img src="forupdate%E6%98%AF%E8%A1%8C%E9%94%81%E8%BF%98%E6%98%AF%E8%A1%A8%E9%94%81-%E5%88%97%E6%B2%A1%E6%9C%89%E7%B4%A2%E5%BC%95.png" alt="img.png"></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>最后发现：

1. 当 where 条件字段上是主键或者是有索引的列，那么就是行级锁
2. 当 where 条件字段上没有索引，就是表级锁
3. 当 for update 查询出来语句没有查到数据，则不会添加锁！
      如： select * from table_name where id = 0 for update;
4. for update 是写锁，读操作不会被锁住
5. 若不开启事务，则 for update 不会加锁      
      
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>mysql 的锁：
当数据库有并发事务的时候，可能会产生数据不一致，这个时候需要用锁机制来进行协调和计算。</li></ul> <ul><li>InnoDB与MYISAM的最大不同有两点：
InnoDB支持事务
InnoDB支持行级锁
MYISAM： 采用表级锁
InnoDB:  支持表级锁和行级锁，默认是行级锁</li></ul> <p>1.性能上划分： 悲观锁、乐观锁</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    悲观锁： 假设会发生并发冲突，（考虑到存在并且肯跟会发生的并发冲突下）屏蔽一切可能违反数据完整性的操作，在查询完数据的时候就把事务锁起来，知道事务提交。
           实现方式 ： 数据库中的锁机制 （读锁、写锁）
    乐观锁： 假设不会发生并发冲突，只在提交的操作检查是否违反了数据完整性，在修改数据的时候把事务锁起来，通过version方式来进行处理
           实现方式 ： 版本号方式，或者CAS算法实现
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>2.操作类型划分：（读锁和写锁都是悲观锁）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    读锁（共享锁、S锁(Shared) ）： 针对同一份数据，多个读操作可以同时进行而不会互相影响。
    写锁（排他锁、X锁(eXclusive) ）：当前写操作没有完成前，它会阻断其他写锁和读锁。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>3.数据操作的粒度：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>        表级锁： （颗粒度最大的锁）对整个表加锁，实现简单，资源消耗少，别大部分Mysql引擎支持（MYISAM 和 InnoDB均支持 表级锁），表级锁定氛围共享锁（读锁）和拍他锁（写锁）
                特点： 开销小，加锁快，不会出现思索，锁定颗粒度大，发出锁冲突的概率最高，并发度最低。
        行级锁： （颗粒度最小的锁）行锁每次操作锁住一行数据，一个session开启事务更新不提交，另一个session更新同一条记录会阻塞，更新不同记录不会阻塞 （这个看具体字段，id/索引字段不会阻塞，否则会阻塞）。
                特点： 开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度最高。
                
        页级锁： 颗粒度介于行级锁和表级锁之间的一种锁，表级锁加锁速度快，但是冲突多，行级锁加锁速度慢。所以折中的页级锁，一次锁定相邻的一组记录
                特点： 开销和加锁速度介于表锁和行锁之间，会出现死锁，加锁粒度介于表锁和行锁之间，并发度也处于二者之间
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h1 id="mysql函数-group-concat、find-in-set使用-及其二者搭配使用"><a href="#mysql函数-group-concat、find-in-set使用-及其二者搭配使用" class="header-anchor">#</a> Mysql函数 GROUP_CONCAT、FIND_IN_SET使用，及其二者搭配使用</h1> <h3 id="group-concat-使用场景"><a href="#group-concat-使用场景" class="header-anchor">#</a> GROUP_CONCAT 使用场景：</h3> <ol><li>用户角色： 多个角色用逗号隔开 如： 管理员、超级管理员</li> <li>用户爱好： 多个爱好用逗号隔开 如： 篮球、足球</li> <li>博客、文章、产品创建标签： 如： 运动、旅行、知识内容</li></ol> <h3 id="group-concat-函数使用"><a href="#group-concat-函数使用" class="header-anchor">#</a> GROUP_CONCAT 函数使用</h3> <p>语法： GROUP_CONCAT(DISTINCT 字段 ORDER BY 字段 SEPARATOR &quot;,&quot; )
解析：
DISTINCT 用于消除字段的重复值
ORDER BY 用于对字段进行排序，最终结果显示在连接后的字符中，默认情况下按照升序
SEPARATOR 用于在组之间进行分割的字符，默认是 &quot;,&quot;
GROUP_CONCAT 忽略NULL值，如果找不到匹配的行或者所有参数都为NULL，则最后也返回NULL
GROUP_CONCAT 返回二进制或者非二进制字符串，这取决雨参数，默认情况下，返回字符串的最大长度为1024。
可以通过设置 group_concat_max_len 系统变量来扩展最大长度</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SET GLOBAL group_concat_max_len=102400;
SET SESSION group_concat_mac_len=102400;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>或者修改配置文件：my.ini
[mysqld]
group_concat_max_len = 102400</p> <p>现有 角色表：user_sys_role 和 用户角色表：user_role，表大概结构和数据如下：
user_sys_role:
<a data-fancybox="" title="111" href="GROUP_CONCAT和FIND_IN_SET使用-user_sys_role表结构数据.png"><img src="GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-user_sys_role%E8%A1%A8%E7%BB%93%E6%9E%84%E6%95%B0%E6%8D%AE.png" alt="img.png"></a>
user_role:
<a data-fancybox="" title="111" href="GROUP_CONCAT和FIND_IN_SET使用-user-role数据和结构.png"><img src="GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-user-role%E6%95%B0%E6%8D%AE%E5%92%8C%E7%BB%93%E6%9E%84.png" alt="img_1.png"></a></p> <ul><li>单表
单表使用 group_concat()函数能将组中的字符串连接成具有某个连接符连接的单个字符
如下：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>select 
	GROUP_CONCAT(name order by id desc SEPARATOR &quot;,&quot;) as all_role
from user_sys_role   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><a data-fancybox="" title="111" href="GROUP_CONCAT和FIND_IN_SET使用-group_concat单表使用.png"><img src="GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-group_concat%E5%8D%95%E8%A1%A8%E4%BD%BF%E7%94%A8.png" alt="img_2.png"></a></p> <ul><li>多表
场景： 一个用户拥有多个角色，现在要查询所有用户的所有角色在一个字段上显示，可以使用GROUP_CONCAT()函数，并且搭配group by分组函数使用
如下：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>select
      l.user_id as user_id,
      GROUP_CONCAT(i.id order by i.id desc SEPARATOR ',') as role_id,
      GROUP_CONCAT(i.name order by i.name asc SEPARATOR ',' ) as role_name
from user_sys_user_role l
left join user_sys_role i ON l.role_id = i.id
group by l.user_id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><a data-fancybox="" title="111" href="GROUP_CONCAT和FIND_IN_SET使用-group_concat多表使用.png"><img src="GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-group_concat%E5%A4%9A%E8%A1%A8%E4%BD%BF%E7%94%A8.png" alt="img_3.png"></a></p> <h3 id="group-concat-使用注意事项"><a href="#group-concat-使用注意事项" class="header-anchor">#</a> GROUP_CONCAT 使用注意事项</h3> <ol><li>GROUP_CONCAT 返回单个字符串，而不是值列表，所以不能在使用 IN、NOT IN 进行查询</li> <li>GROUP_CONCAT 返回的结果，作为子查询使用，可以使用 FIND_IN_SET 函数</li> <li>GROUP_CONCAT 函数是一个聚合函数，如果要对值进行排序，需要在GROUP_CONCAT 函数内使用ORDER BY，而不是在 SELECT语句中使用 ORDER BY
若需要对非 GROUP_CONCAT操作的列排序，可以再嵌套一层查询 ！！</li></ol> <h3 id="group-concat-和-find-in-set-搭配使用"><a href="#group-concat-和-find-in-set-搭配使用" class="header-anchor">#</a> GROUP_CONCAT 和 FIND_IN_SET 搭配使用</h3> <p>查询那些用户是有超级管理员权限：
如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>select * from (
select
      l.user_id as user_id,
      GROUP_CONCAT(i.id ) as role_id,
      GROUP_CONCAT(i.name ) as role_name
from user_sys_user_role l
left join user_sys_role i ON l.role_id = i.id
group by l.user_id
) x where FIND_IN_SET(&quot;1&quot;,x.role_id)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><a data-fancybox="" title="111" href="GROUP_CONCAT和FIND_IN_SET使用-group_concat和find_in_set搭配使用.png"><img src="GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-group_concat%E5%92%8Cfind_in_set%E6%90%AD%E9%85%8D%E4%BD%BF%E7%94%A8.png" alt="img_4.png"></a></p> <h3 id="find-in-set"><a href="#find-in-set" class="header-anchor">#</a> FIND_IN_SET</h3> <p>FIND_IN_SET(str,strlist)
假如str在N个字符组成strlist中，返回值则为1到N之间，strlist之间的连接符号以 &quot;,&quot; 连接。如果是查询数据表，则返回数据
若str不在strlist中，则返回0。若str或strlist有一个是null，则返回是null</p> <p>语法： FIND_IN_SET(str,strlist)
str 要查询的字符串
strlist 是被查询字段组，并且按 ',' 分隔，如：(1,2)
查询字段(strList)中包含的结果，返回结果null、记录、或者所在位置</p> <p>使用场景：
1. 角色权限字段若是在一个字段中，则可以根据 FIND_IN_SET 进行精准匹配
2. 多表的时候，主表的状态需要根据子表决定，可以搭配使用 GROUP_CONCAT 和 FIND_IN_SET 使用
如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>select * from (
select
      l.user_id as user_id,
      GROUP_CONCAT(i.id ) as role_id,
      GROUP_CONCAT(i.name ) as role_name
from user_sys_user_role l
left join user_sys_role i ON l.role_id = i.id
group by l.user_id
) x where FIND_IN_SET(&quot;1&quot;,x.role_id)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><a data-fancybox="" title="111" href="GROUP_CONCAT和FIND_IN_SET使用-group_concat和find_in_set搭配使用.png"><img src="GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-group_concat%E5%92%8Cfind_in_set%E6%90%AD%E9%85%8D%E4%BD%BF%E7%94%A8.png" alt="img_4.png"></a></p> <p>使用</p> <ul><li><p>select FIND_IN_SET(&quot;蒙大拿&quot;,&quot;蒙大难,mengdana,mememme,蒙大,蒙大拿&quot;)
<a data-fancybox="" title="111" href="GROUP_CONCAT和FIND_IN_SET使用-find_in_set使用1.png"><img src="GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-find_in_set%E4%BD%BF%E7%94%A81.png" alt="img_5.png"></a></p></li> <li><p>select id,name,remarks from user_sys_role where FIND_IN_SET('篮球',remarks)
<a data-fancybox="" title="111" href="GROUP_CONCAT和FIND_IN_SET使用-find_in_set使用2.png"><img src="GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-find_in_set%E4%BD%BF%E7%94%A82.png" alt="img_6.png"></a></p></li></ul> <h3 id="find-in-set-和-in-区别"><a href="#find-in-set-和-in-区别" class="header-anchor">#</a> FIND_IN_SET 和 IN 区别</h3> <p>IN 需要字段的所有值均相等的时候才会满足，
FIND_IN_SET 只要 ',' 分隔的字符有一个匹配就会命中查询
所以FIND_IN_SET相比于IN查询，IN精准把握不准确</p> <ul><li><p>select id,name,remarks from user_sys_role where FIND_IN_SET('篮球',remarks)
<a data-fancybox="" title="111" href="GROUP_CONCAT和FIND_IN_SET使用-find_in_set使用2.png"><img src="GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-find_in_set%E4%BD%BF%E7%94%A82.png" alt="img_6.png"></a></p></li> <li><p>select id,name,remarks from user_sys_role where remarks in('篮球')
<a data-fancybox="" title="111" href="GROUP_CONCAT和FIND_IN_SET使用-find_in_set使用3.png"><img src="GROUP_CONCAT%E5%92%8CFIND_IN_SET%E4%BD%BF%E7%94%A8-find_in_set%E4%BD%BF%E7%94%A83.png" alt="img_7.png"></a></p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/mengqizhang/assets/js/app.a8d21a83.js" defer></script><script src="/mengqizhang/assets/js/2.e69c46bd.js" defer></script><script src="/mengqizhang/assets/js/67.15d5b718.js" defer></script>
  </body>
</html>
