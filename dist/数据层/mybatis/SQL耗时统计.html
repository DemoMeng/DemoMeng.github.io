<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SQLè€—æ—¶ç»Ÿè®¡ | è’™å¤§æ‹¿</title>
    <meta name="generator" content="VuePress 1.9.5">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script charset="utf-8" src="https://my.openwrite.cn/js/readmore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <meta name="description" content="è’™å¤§æ‹¿çš„åšå®¢">
    
    <link rel="preload" href="/mengqizhang/assets/css/0.styles.a1d09170.css" as="style"><link rel="preload" href="/mengqizhang/assets/js/app.a8d21a83.js" as="script"><link rel="preload" href="/mengqizhang/assets/js/2.e69c46bd.js" as="script"><link rel="preload" href="/mengqizhang/assets/js/65.94e94ec2.js" as="script"><link rel="prefetch" href="/mengqizhang/assets/js/10.11174a82.js"><link rel="prefetch" href="/mengqizhang/assets/js/100.bd6553c3.js"><link rel="prefetch" href="/mengqizhang/assets/js/101.ac07962b.js"><link rel="prefetch" href="/mengqizhang/assets/js/102.79bec0af.js"><link rel="prefetch" href="/mengqizhang/assets/js/103.0c0a0808.js"><link rel="prefetch" href="/mengqizhang/assets/js/104.3ed6d392.js"><link rel="prefetch" href="/mengqizhang/assets/js/105.be22e8c8.js"><link rel="prefetch" href="/mengqizhang/assets/js/106.efa39ac4.js"><link rel="prefetch" href="/mengqizhang/assets/js/107.545ffb45.js"><link rel="prefetch" href="/mengqizhang/assets/js/108.cf23c097.js"><link rel="prefetch" href="/mengqizhang/assets/js/109.3339ffad.js"><link rel="prefetch" href="/mengqizhang/assets/js/11.08defbae.js"><link rel="prefetch" href="/mengqizhang/assets/js/110.bafd2f00.js"><link rel="prefetch" href="/mengqizhang/assets/js/12.25a3365c.js"><link rel="prefetch" href="/mengqizhang/assets/js/13.9b88bf7d.js"><link rel="prefetch" href="/mengqizhang/assets/js/14.c4d7ed3a.js"><link rel="prefetch" href="/mengqizhang/assets/js/15.b407b696.js"><link rel="prefetch" href="/mengqizhang/assets/js/16.1c08698a.js"><link rel="prefetch" href="/mengqizhang/assets/js/17.8a25e983.js"><link rel="prefetch" href="/mengqizhang/assets/js/18.e34bf6a6.js"><link rel="prefetch" href="/mengqizhang/assets/js/19.68d7669f.js"><link rel="prefetch" href="/mengqizhang/assets/js/20.de14558d.js"><link rel="prefetch" href="/mengqizhang/assets/js/21.56869e5e.js"><link rel="prefetch" href="/mengqizhang/assets/js/22.aea26c9b.js"><link rel="prefetch" href="/mengqizhang/assets/js/23.4a0b2ea3.js"><link rel="prefetch" href="/mengqizhang/assets/js/24.58c270f0.js"><link rel="prefetch" href="/mengqizhang/assets/js/25.413aed44.js"><link rel="prefetch" href="/mengqizhang/assets/js/26.5ebfde8b.js"><link rel="prefetch" href="/mengqizhang/assets/js/27.48dd442a.js"><link rel="prefetch" href="/mengqizhang/assets/js/28.d2afcf03.js"><link rel="prefetch" href="/mengqizhang/assets/js/29.b928e199.js"><link rel="prefetch" href="/mengqizhang/assets/js/3.7aafc190.js"><link rel="prefetch" href="/mengqizhang/assets/js/30.4c1cbe1a.js"><link rel="prefetch" href="/mengqizhang/assets/js/31.77073e2d.js"><link rel="prefetch" href="/mengqizhang/assets/js/32.5f66f7a2.js"><link rel="prefetch" href="/mengqizhang/assets/js/33.a8272e84.js"><link rel="prefetch" href="/mengqizhang/assets/js/34.3b8ea135.js"><link rel="prefetch" href="/mengqizhang/assets/js/35.100b34a0.js"><link rel="prefetch" href="/mengqizhang/assets/js/36.06cb633d.js"><link rel="prefetch" href="/mengqizhang/assets/js/37.f3d4b763.js"><link rel="prefetch" href="/mengqizhang/assets/js/38.733d311d.js"><link rel="prefetch" href="/mengqizhang/assets/js/39.8434909a.js"><link rel="prefetch" href="/mengqizhang/assets/js/4.000c3dbd.js"><link rel="prefetch" href="/mengqizhang/assets/js/40.dd341745.js"><link rel="prefetch" href="/mengqizhang/assets/js/41.1fcf309c.js"><link rel="prefetch" href="/mengqizhang/assets/js/42.1cc69bad.js"><link rel="prefetch" href="/mengqizhang/assets/js/43.fefa3ac7.js"><link rel="prefetch" href="/mengqizhang/assets/js/44.d284f8c1.js"><link rel="prefetch" href="/mengqizhang/assets/js/45.2564339d.js"><link rel="prefetch" href="/mengqizhang/assets/js/46.23627a8c.js"><link rel="prefetch" href="/mengqizhang/assets/js/47.cecbf290.js"><link rel="prefetch" href="/mengqizhang/assets/js/48.bad75ece.js"><link rel="prefetch" href="/mengqizhang/assets/js/49.2fa60a3e.js"><link rel="prefetch" href="/mengqizhang/assets/js/5.9832e234.js"><link rel="prefetch" href="/mengqizhang/assets/js/50.f3159852.js"><link rel="prefetch" href="/mengqizhang/assets/js/51.738bce4a.js"><link rel="prefetch" href="/mengqizhang/assets/js/52.efc0fa7e.js"><link rel="prefetch" href="/mengqizhang/assets/js/53.8d0c00f1.js"><link rel="prefetch" href="/mengqizhang/assets/js/54.a519e682.js"><link rel="prefetch" href="/mengqizhang/assets/js/55.9652e586.js"><link rel="prefetch" href="/mengqizhang/assets/js/56.c88f759b.js"><link rel="prefetch" href="/mengqizhang/assets/js/57.c6f3cd20.js"><link rel="prefetch" href="/mengqizhang/assets/js/58.0c040aca.js"><link rel="prefetch" href="/mengqizhang/assets/js/59.fc5ce388.js"><link rel="prefetch" href="/mengqizhang/assets/js/6.48810bdc.js"><link rel="prefetch" href="/mengqizhang/assets/js/60.a50c0285.js"><link rel="prefetch" href="/mengqizhang/assets/js/61.ab6648f5.js"><link rel="prefetch" href="/mengqizhang/assets/js/62.f589c0b8.js"><link rel="prefetch" href="/mengqizhang/assets/js/63.df4a0587.js"><link rel="prefetch" href="/mengqizhang/assets/js/64.e5f1a0d6.js"><link rel="prefetch" href="/mengqizhang/assets/js/66.9a0f92dc.js"><link rel="prefetch" href="/mengqizhang/assets/js/67.15d5b718.js"><link rel="prefetch" href="/mengqizhang/assets/js/68.ca0d798d.js"><link rel="prefetch" href="/mengqizhang/assets/js/69.4de863fa.js"><link rel="prefetch" href="/mengqizhang/assets/js/7.2f8cbddd.js"><link rel="prefetch" href="/mengqizhang/assets/js/70.7c1bcd59.js"><link rel="prefetch" href="/mengqizhang/assets/js/71.70f3e9ec.js"><link rel="prefetch" href="/mengqizhang/assets/js/72.ca361407.js"><link rel="prefetch" href="/mengqizhang/assets/js/73.95c0b000.js"><link rel="prefetch" href="/mengqizhang/assets/js/74.673e240c.js"><link rel="prefetch" href="/mengqizhang/assets/js/75.f5cf8815.js"><link rel="prefetch" href="/mengqizhang/assets/js/76.30b8a8fb.js"><link rel="prefetch" href="/mengqizhang/assets/js/77.0bdfd82b.js"><link rel="prefetch" href="/mengqizhang/assets/js/78.a21a9dee.js"><link rel="prefetch" href="/mengqizhang/assets/js/79.5c55aff9.js"><link rel="prefetch" href="/mengqizhang/assets/js/8.507fce61.js"><link rel="prefetch" href="/mengqizhang/assets/js/80.aa70b0e8.js"><link rel="prefetch" href="/mengqizhang/assets/js/81.1cb55142.js"><link rel="prefetch" href="/mengqizhang/assets/js/82.50b720b1.js"><link rel="prefetch" href="/mengqizhang/assets/js/83.85834849.js"><link rel="prefetch" href="/mengqizhang/assets/js/84.e2f1cab8.js"><link rel="prefetch" href="/mengqizhang/assets/js/85.c154565c.js"><link rel="prefetch" href="/mengqizhang/assets/js/86.c5dbbd95.js"><link rel="prefetch" href="/mengqizhang/assets/js/87.2b62cc5e.js"><link rel="prefetch" href="/mengqizhang/assets/js/88.5deb957d.js"><link rel="prefetch" href="/mengqizhang/assets/js/89.fbed7b0f.js"><link rel="prefetch" href="/mengqizhang/assets/js/9.70c1c418.js"><link rel="prefetch" href="/mengqizhang/assets/js/90.8efb35d5.js"><link rel="prefetch" href="/mengqizhang/assets/js/91.a3da2ba6.js"><link rel="prefetch" href="/mengqizhang/assets/js/92.1f9bf6c0.js"><link rel="prefetch" href="/mengqizhang/assets/js/93.862f4101.js"><link rel="prefetch" href="/mengqizhang/assets/js/94.1a0c5762.js"><link rel="prefetch" href="/mengqizhang/assets/js/95.6df0f77b.js"><link rel="prefetch" href="/mengqizhang/assets/js/96.90bef310.js"><link rel="prefetch" href="/mengqizhang/assets/js/97.fa2b5f10.js"><link rel="prefetch" href="/mengqizhang/assets/js/98.d84c6b84.js"><link rel="prefetch" href="/mengqizhang/assets/js/99.785b4a31.js">
    <link rel="stylesheet" href="/mengqizhang/assets/css/0.styles.a1d09170.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mengqizhang/" class="home-link router-link-active"><!----> <span class="site-name">è’™å¤§æ‹¿</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mengqizhang/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="https://gitee.com/DemoMeng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å…³äºæˆ‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mengqizhang/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="https://gitee.com/DemoMeng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å…³äºæˆ‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>é¢è¯• ğŸ“–ğŸ”¥ğŸ”¥</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/ç¯å¢ƒé…ç½®/" class="sidebar-heading clickable"><span>ç¯å¢ƒé…ç½® ğŸ”§</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/æ¶ˆæ¯é˜Ÿåˆ—/" class="sidebar-heading clickable"><span>æ¶ˆæ¯é˜Ÿåˆ— ğŸ”¥ğŸ”¥ğŸ”¥</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/æ•°æ®å±‚/" class="sidebar-heading clickable open"><span>æ•°æ®å±‚ ğŸ”¥ğŸ”¥ğŸ”¥</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>mybatis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mengqizhang/%E6%95%B0%E6%8D%AE%E5%B1%82/mybatis/" aria-current="page" class="sidebar-link">ä»‹ç»</a></li><li><a href="/mengqizhang/æ•°æ®å±‚/mybatis/SQLè€—æ—¶ç»Ÿè®¡.html" class="active sidebar-link">SQLè€—æ—¶ç»Ÿè®¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mengqizhang/æ•°æ®å±‚/mybatis/SQLè€—æ—¶ç»Ÿè®¡.html#_1-åˆ©ç”¨aopå®ç°sqlè€—æ—¶ç»Ÿè®¡" class="sidebar-link">1. åˆ©ç”¨aopå®ç°sqlè€—æ—¶ç»Ÿè®¡</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/æ•°æ®å±‚/mybatis/SQLè€—æ—¶ç»Ÿè®¡.html#_2-å®ç°ibatisçš„interceptor-å¯¹æŒ‡å®šç±»ã€ç±»çš„æ–¹æ³•æ‹¦æˆª" class="sidebar-link">2. å®ç°ibatisçš„interceptor å¯¹æŒ‡å®šç±»ã€ç±»çš„æ–¹æ³•æ‹¦æˆª</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/æ•°æ®å±‚/mybatis/SQLè€—æ—¶ç»Ÿè®¡.html#_3-ä½¿ç”¨-druid-è¿æ¥æ± æ‹¦æˆª" class="sidebar-link">3. ä½¿ç”¨ druid è¿æ¥æ± æ‹¦æˆª</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/å®¹å™¨åŒ–/" class="sidebar-heading clickable"><span>å®¹å™¨åŒ– ğŸ³</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java â˜•ï¸</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>åˆ†å¸ƒå¼äº‹åŠ¡</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>åˆ†å¸ƒå¼ç³»ç»Ÿ â˜ï¸</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webSocket</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ELK ğŸ”</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx ğŸ‡·ğŸ‡º</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>jenkins ğŸ‘´</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æœåŠ¡å™¨ ğŸ’°</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æµ‹è¯• ğŸ˜“</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç›‘æ§å‘Šè­¦</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sqlè€—æ—¶ç»Ÿè®¡"><a href="#sqlè€—æ—¶ç»Ÿè®¡" class="header-anchor">#</a> SQLè€—æ—¶ç»Ÿè®¡</h1> <ul><li><ol><li>åˆ©ç”¨aopå®ç°sqlè€—æ—¶ç»Ÿè®¡</li></ol></li> <li><ol start="2"><li>å®ç°ibatisçš„interceptor å¯¹æŒ‡å®šç±»ã€ç±»çš„æ–¹æ³•æ‹¦æˆª</li></ol></li> <li><ol start="3"><li>ä½¿ç”¨ druid è¿æ¥æ± æ‹¦æˆª</li></ol></li></ul> <h2 id="_1-åˆ©ç”¨aopå®ç°sqlè€—æ—¶ç»Ÿè®¡"><a href="#_1-åˆ©ç”¨aopå®ç°sqlè€—æ—¶ç»Ÿè®¡" class="header-anchor">#</a> 1. åˆ©ç”¨aopå®ç°sqlè€—æ—¶ç»Ÿè®¡</h2> <ul><li>ä½¿ç”¨aopå®ç°ï¼Œéœ€è¦å¯¼å…¥aopä¾èµ–</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>ç¼–å†™aopåˆ‡é¢ä»£ç </li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.qingwang.mars.mybatis.config;

import org.aspectj.lang.JoinPoint;
import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.AfterReturning;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Pointcut;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Component;
/**
 * ç‰ˆæƒæ‰€æœ‰  copyrightÂ© è’™å¤§æ‹¿
 *
 * @author mqz
 * @date 2022/4/14
 * @about https://www.gitee.com/DemoMeng
 * @description
 */
@Aspect
@Component
public class MapperAspect {

    private final static Logger log = LoggerFactory.getLogger(MapperAspect.class);

    // æŒ‡å®šè¦è¿›è¡Œå¤„ç†åŒ…
    @AfterReturning(&quot;execution(* com.qingwang.*.*.core.mapper.*Mapper.*(..))&quot;)
    public void logServiceAccess(JoinPoint joinPoint) {
        log.info(&quot;Mapperç»“æœè¿”å›: {} &quot;,joinPoint);
    }

    // æŒ‡å®šè¦è¿›è¡Œå¤„ç†åŒ…
    @Pointcut(&quot;execution(* com.qingwang.*.*.core.mapper.*Mapper.*(..))&quot;)
    private void pointCutMethod() {
    }

    @Around(&quot;pointCutMethod()&quot;)
    public Object doAround(ProceedingJoinPoint pjp) throws Throwable {
        long start = System.currentTimeMillis();
        Object obj = pjp.proceed();
        long end = System.currentTimeMillis();
        log.info(&quot;Mapperæ–¹æ³•ï¼š{}ï¼Œæ‰§è¡Œè€—æ—¶ï¼š{} æ¯«ç§’ &quot;,pjp.getSignature().toString(),(end - start));
        return obj;
    }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h2 id="_2-å®ç°ibatisçš„interceptor-å¯¹æŒ‡å®šç±»ã€ç±»çš„æ–¹æ³•æ‹¦æˆª"><a href="#_2-å®ç°ibatisçš„interceptor-å¯¹æŒ‡å®šç±»ã€ç±»çš„æ–¹æ³•æ‹¦æˆª" class="header-anchor">#</a> 2. å®ç°ibatisçš„interceptor å¯¹æŒ‡å®šç±»ã€ç±»çš„æ–¹æ³•æ‹¦æˆª</h2> <ul><li>sqlSession å››å¤§å¯¹è±¡ï¼šExecutorã€ParameterHandlerã€StatementHandlerã€ResultSetHandler</li></ul> <ul><li>Executorï¼šæ‰§è¡Œå™¨ï¼Œç”±å®ƒæ¥è°ƒåº¦ ParameterHandlerã€StatementHandlerã€ResultSetHandler æ‰§è¡ŒSQLï¼Œå…¶ä¸­ï¼ŒStatementHandleræ˜¯æœ€é‡è¦çš„</li> <li>ParameterHandlerï¼šå¤„ç†SQLå‚æ•°å¯¹åº”çš„JDBCå‚æ•°</li> <li>StatementHandlerï¼šä½¿ç”¨æ•°æ®åº“çš„ statementã€prepareStatement æ¥æ‰§è¡Œæ“ä½œï¼ŒStatementHandleræ˜¯å››å¤§å¯¹è±¡çš„æ ¸å¿ƒï¼Œè®¸å¤šé‡è¦çš„æ’ä»¶éƒ½æ˜¯é€šè¿‡æ‹¦æˆª StatementHandlerå®ç°çš„</li> <li>ResultSetHandlerï¼šè¿›è¡Œæ•°æ®ç»“æœé›†å°è£…å¤„ç†è¿”å›çš„</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.qingwang.qingbang.crm.web.config.component;

import lombok.extern.slf4j.Slf4j;
import org.apache.ibatis.plugin.Interceptor;
import org.apache.ibatis.plugin.Invocation;
import org.springframework.stereotype.Component;
import org.apache.ibatis.executor.statement.StatementHandler;
import org.apache.ibatis.mapping.BoundSql;
import org.apache.ibatis.mapping.ParameterMapping;
import org.apache.ibatis.plugin.Intercepts;
import org.apache.ibatis.plugin.Plugin;
import org.apache.ibatis.plugin.Signature;
import org.apache.ibatis.session.ResultHandler;

import java.sql.Connection;
import java.sql.Statement;
import java.util.List;
import java.util.Properties;


/**
 * ç‰ˆæƒæ‰€æœ‰  copyrightÂ© è’™å¤§æ‹¿
 *
 * @author mqz
 * @date 2022/4/15
 * @about https://www.gitee.com/DemoMeng
 * @description
 *
 *   @Signatur type é€‰é¡¹å€¼ï¼š å®šä¹‰æ‹¦æˆªçš„ç±» Executorã€ParameterHandlerã€StatementHandlerã€ResultSetHandlerå½“ä¸­çš„ä¸€ä¸ª
 *   @Signature method é€‰é¡¹å€¼ï¼š typeå®šä¹‰æ‹¦æˆªçš„ç±»ä¸­çš„æ–¹æ³•
 *   @Signature args é€‰é¡¹å€¼ï¼š methodæ–¹æ³•çš„å‚æ•°çš„classå¯¹è±¡
 */
@Intercepts({
        @Signature(type = StatementHandler.class, method = &quot;query&quot;, args = {Statement.class, ResultHandler.class}),
        @Signature(type = StatementHandler.class, method = &quot;update&quot;, args = {Statement.class}),
        @Signature(type = StatementHandler.class, method = &quot;batch&quot;, args = {Statement.class}),
        @Signature(type = StatementHandler.class, method = &quot;prepare&quot;, args = {Connection.class,Integer.class}),
        @Signature(type = StatementHandler.class, method = &quot;parameterize&quot;, args = {Statement.class}),
        @Signature(type = StatementHandler.class, method = &quot;queryCursor&quot;, args = {Statement.class}),
        @Signature(type = StatementHandler.class, method = &quot;getParameterHandler&quot;, args = {}),
        @Signature(type = StatementHandler.class, method = &quot;getBoundSql&quot;, args = {})
})
@Component
@Slf4j
public class SqlCostTimeInterceptor implements Interceptor {

    @Override
    public Object intercept(Invocation invocation) throws Throwable {
        long startTime = System.currentTimeMillis();
        Object target = invocation.getTarget();
        StatementHandler statementHandler = (StatementHandler) target;
        try {
            return invocation.proceed();
        } finally {
            long endTime = System.currentTimeMillis();
            long costTime = endTime - startTime;
            BoundSql boundSql = statementHandler.getBoundSql();
            String sql = boundSql.getSql();
            Object parameterObject = boundSql.getParameterObject();
            List&lt;ParameterMapping&gt; parameterMappingList = boundSql.getParameterMappings();
            log.info(&quot;Mapperè€—æ—¶ï¼šè€—æ—¶ï¼š{} æ¯«ç§’ &quot;,costTime);
        }
    }

    @Override
    public Object plugin(Object target) {
        return Plugin.wrap(target, this);
    }

    @Override
    public void setProperties(Properties properties) {

    }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><h2 id="_3-ä½¿ç”¨-druid-è¿æ¥æ± æ‹¦æˆª"><a href="#_3-ä½¿ç”¨-druid-è¿æ¥æ± æ‹¦æˆª" class="header-anchor">#</a> 3. ä½¿ç”¨ druid è¿æ¥æ± æ‹¦æˆª</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>spring:
  datasource:
    username: root
    password: mengqizhang
    url: jdbc:mysql://106.12.187.16:3306/master-slave-db?useServerPrepStmts=true&amp;cachePrepStmts=true&amp;serverTimezone=UTC # sharding proxyçš„é…ç½®é€»è¾‘æ•°æ®åº“åŠè¿æ¥
    driver-class-name: com.mysql.jdbc.Driver # com.mysql.cj.jdbc.Driver
#    password: ENC(BbXrXIL5KnnqLXKPGJPFT2kU4TwoHIfq/vZdLcC/HgZmOO8035gODPD0j+Y23oJd)
#    username: ENC(LQ9LQAtaW+ZZLtQetLnlvt/EjDxAFATtmOPVQfPwTv+FXbhGq7VPWjYFKZToWJyS)
#    url: ENC(uphtJvYVQKJvKzgtbZBVxlsJmk1uZvHvB5Eisao43f9PT9OwIEViYHTwrGWdwgd48SAfboG+gcLMvsv9qa7nZWQu0gNAUYRWuE5+a+Z7u0X5DJpqsIGDSam2mmaQ89dRiz3vShBipYCjXr5uhP7REK54b4sacswKK6R3DL3waB977i5+5WT8+KFpW+62a0jX)
    druid:
      # é…ç½®åˆå§‹åŒ–å¤§å°ã€æœ€å°ã€æœ€å¤§
      initial-size: 5
      minIdle: 10
      max-active: 20
      # é…ç½®è·å–è¿æ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´(å•ä½ï¼šæ¯«ç§’)
      max-wait: 60000
      # é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’
      time-between-eviction-runs-millis: 2000
      # é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’
      min-evictable-idle-time-millis: 600000
      max-evictable-idle-time-millis: 900000
      # ç”¨æ¥æµ‹è¯•è¿æ¥æ˜¯å¦å¯ç”¨çš„SQLè¯­å¥,é»˜è®¤å€¼æ¯ç§æ•°æ®åº“éƒ½ä¸ç›¸åŒ,è¿™æ˜¯mysql
      validationQuery: select 1
      # åº”ç”¨å‘è¿æ¥æ± ç”³è¯·è¿æ¥ï¼Œå¹¶ä¸”testOnBorrowä¸ºfalseæ—¶ï¼Œè¿æ¥æ± å°†ä¼šåˆ¤æ–­è¿æ¥æ˜¯å¦å¤„äºç©ºé—²çŠ¶æ€ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™éªŒè¯è¿™æ¡è¿æ¥æ˜¯å¦å¯ç”¨
      testWhileIdle: true
      # å¦‚æœä¸ºtrueï¼Œé»˜è®¤æ˜¯falseï¼Œåº”ç”¨å‘è¿æ¥æ± ç”³è¯·è¿æ¥æ—¶ï¼Œè¿æ¥æ± ä¼šåˆ¤æ–­è¿™æ¡è¿æ¥æ˜¯å¦æ˜¯å¯ç”¨çš„
      testOnBorrow: false
      # å¦‚æœä¸ºtrueï¼ˆé»˜è®¤falseï¼‰ï¼Œå½“åº”ç”¨ä½¿ç”¨å®Œè¿æ¥ï¼Œè¿æ¥æ± å›æ”¶è¿æ¥çš„æ—¶å€™ä¼šåˆ¤æ–­è¯¥è¿æ¥æ˜¯å¦è¿˜å¯ç”¨
      testOnReturn: false
      # æ˜¯å¦ç¼“å­˜preparedStatementï¼Œä¹Ÿå°±æ˜¯PSCacheã€‚PSCacheå¯¹æ”¯æŒæ¸¸æ ‡çš„æ•°æ®åº“æ€§èƒ½æå‡å·¨å¤§ï¼Œæ¯”å¦‚è¯´oracle
      poolPreparedStatements: true
      # è¦å¯ç”¨PSCacheï¼Œå¿…é¡»é…ç½®å¤§äº0ï¼Œå½“å¤§äº0æ—¶ï¼Œ poolPreparedStatementsè‡ªåŠ¨è§¦å‘ä¿®æ”¹ä¸ºtrueï¼Œ
      # åœ¨Druidä¸­ï¼Œä¸ä¼šå­˜åœ¨Oracleä¸‹PSCacheå ç”¨å†…å­˜è¿‡å¤šçš„é—®é¢˜ï¼Œ
      # å¯ä»¥æŠŠè¿™ä¸ªæ•°å€¼é…ç½®å¤§ä¸€äº›ï¼Œæ¯”å¦‚è¯´100
      maxOpenPreparedStatements: 20
      # è¿æ¥æ± ä¸­çš„minIdleæ•°é‡ä»¥å†…çš„è¿æ¥ï¼Œç©ºé—²æ—¶é—´è¶…è¿‡minEvictableIdleTimeMillisï¼Œåˆ™ä¼šæ‰§è¡ŒkeepAliveæ“ä½œ
      keepAlive: true
      # Spring ç›‘æ§ï¼Œåˆ©ç”¨aop å¯¹æŒ‡å®šæ¥å£çš„æ‰§è¡Œæ—¶é—´ï¼Œjdbcæ•°è¿›è¡Œè®°å½•
      aop-patterns: &quot;com.springboot.template.dao.*&quot;
      ########### å¯ç”¨å†…ç½®è¿‡æ»¤å™¨ï¼ˆç¬¬ä¸€ä¸ª statå¿…é¡»ï¼Œå¦åˆ™ç›‘æ§ä¸åˆ°SQLï¼‰##########
      filters: stat,wall,log4j2
      # è‡ªå·±é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filter
      filter:
        # å¼€å¯druiddatasourceçš„çŠ¶æ€ç›‘æ§
        stat:
          enabled: true
          db-type: mysql
          # å¼€å¯æ…¢sqlç›‘æ§ï¼Œè¶…è¿‡2s å°±è®¤ä¸ºæ˜¯æ…¢sqlï¼Œè®°å½•åˆ°æ—¥å¿—ä¸­
          log-slow-sql: true
          slow-sql-millis: 2000
        # æ—¥å¿—ç›‘æ§ï¼Œä½¿ç”¨slf4j è¿›è¡Œæ—¥å¿—è¾“å‡º
        slf4j:
          enabled: true
          statement-log-error-enabled: true
          statement-create-after-log-enabled: false
          statement-close-after-log-enabled: false
          result-set-open-after-log-enabled: false
          result-set-close-after-log-enabled: false
      ########## é…ç½®WebStatFilterï¼Œç”¨äºé‡‡é›†webå…³è”ç›‘æ§çš„æ•°æ® ##########
      web-stat-filter:
        enabled: true                   # å¯åŠ¨ StatFilter
        url-pattern: /*                 # è¿‡æ»¤æ‰€æœ‰url
        exclusions: &quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot; # æ’é™¤ä¸€äº›ä¸å¿…è¦çš„url
        session-stat-enable: true       # å¼€å¯sessionç»Ÿè®¡åŠŸèƒ½
        session-stat-max-count: 1000    # sessionçš„æœ€å¤§ä¸ªæ•°,é»˜è®¤100
      ########## é…ç½®StatViewServletï¼ˆç›‘æ§é¡µé¢ï¼‰ï¼Œç”¨äºå±•ç¤ºDruidçš„ç»Ÿè®¡ä¿¡æ¯ ##########
      stat-view-servlet:
        enabled: true                  # å¯ç”¨StatViewServlet
        url-pattern: /druid/*          # è®¿é—®å†…ç½®ç›‘æ§é¡µé¢çš„è·¯å¾„ï¼Œå†…ç½®ç›‘æ§é¡µé¢çš„é¦–é¡µæ˜¯/druid/index.html
        reset-enable: false            # ä¸å…è®¸æ¸…ç©ºç»Ÿè®¡æ•°æ®,é‡æ–°è®¡ç®—
        login-username: mqz            # é…ç½®ç›‘æ§é¡µé¢è®¿é—®å¯†ç 
        login-password: mqz
        allow: 127.0.0.1           # å…è®¸è®¿é—®çš„åœ°å€ï¼Œå¦‚æœallowæ²¡æœ‰é…ç½®æˆ–è€…ä¸ºç©ºï¼Œåˆ™å…è®¸æ‰€æœ‰è®¿é—®
        deny:                      # æ‹’ç»è®¿é—®çš„åœ°å€ï¼Œdenyä¼˜å…ˆäºallowï¼Œå¦‚æœåœ¨denyåˆ—è¡¨ä¸­ï¼Œå°±ç®—åœ¨allowåˆ—è¡¨ä¸­ï¼Œä¹Ÿä¼šè¢«æ‹’ç»

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/mengqizhang/%E6%95%B0%E6%8D%AE%E5%B1%82/mybatis/" class="prev router-link-active">
        ä»‹ç»
      </a></span> <span class="next"><a href="/mengqizhang/%E6%95%B0%E6%8D%AE%E5%B1%82/redis/">
        redis
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/mengqizhang/assets/js/app.a8d21a83.js" defer></script><script src="/mengqizhang/assets/js/2.e69c46bd.js" defer></script><script src="/mengqizhang/assets/js/65.94e94ec2.js" defer></script>
  </body>
</html>
