<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>redis6.0新特性 | 蒙大拿</title>
    <meta name="generator" content="VuePress 1.9.5">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script charset="utf-8" src="https://my.openwrite.cn/js/readmore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <meta name="description" content="蒙大拿的博客">
    
    <link rel="preload" href="/mengqizhang/assets/css/0.styles.a1d09170.css" as="style"><link rel="preload" href="/mengqizhang/assets/js/app.a8d21a83.js" as="script"><link rel="preload" href="/mengqizhang/assets/js/2.e69c46bd.js" as="script"><link rel="preload" href="/mengqizhang/assets/js/83.85834849.js" as="script"><link rel="preload" href="/mengqizhang/assets/js/6.48810bdc.js" as="script"><link rel="prefetch" href="/mengqizhang/assets/js/10.11174a82.js"><link rel="prefetch" href="/mengqizhang/assets/js/100.bd6553c3.js"><link rel="prefetch" href="/mengqizhang/assets/js/101.ac07962b.js"><link rel="prefetch" href="/mengqizhang/assets/js/102.79bec0af.js"><link rel="prefetch" href="/mengqizhang/assets/js/103.0c0a0808.js"><link rel="prefetch" href="/mengqizhang/assets/js/104.3ed6d392.js"><link rel="prefetch" href="/mengqizhang/assets/js/105.be22e8c8.js"><link rel="prefetch" href="/mengqizhang/assets/js/106.efa39ac4.js"><link rel="prefetch" href="/mengqizhang/assets/js/107.545ffb45.js"><link rel="prefetch" href="/mengqizhang/assets/js/108.cf23c097.js"><link rel="prefetch" href="/mengqizhang/assets/js/109.3339ffad.js"><link rel="prefetch" href="/mengqizhang/assets/js/11.08defbae.js"><link rel="prefetch" href="/mengqizhang/assets/js/110.bafd2f00.js"><link rel="prefetch" href="/mengqizhang/assets/js/12.25a3365c.js"><link rel="prefetch" href="/mengqizhang/assets/js/13.9b88bf7d.js"><link rel="prefetch" href="/mengqizhang/assets/js/14.c4d7ed3a.js"><link rel="prefetch" href="/mengqizhang/assets/js/15.b407b696.js"><link rel="prefetch" href="/mengqizhang/assets/js/16.1c08698a.js"><link rel="prefetch" href="/mengqizhang/assets/js/17.8a25e983.js"><link rel="prefetch" href="/mengqizhang/assets/js/18.e34bf6a6.js"><link rel="prefetch" href="/mengqizhang/assets/js/19.68d7669f.js"><link rel="prefetch" href="/mengqizhang/assets/js/20.de14558d.js"><link rel="prefetch" href="/mengqizhang/assets/js/21.56869e5e.js"><link rel="prefetch" href="/mengqizhang/assets/js/22.aea26c9b.js"><link rel="prefetch" href="/mengqizhang/assets/js/23.4a0b2ea3.js"><link rel="prefetch" href="/mengqizhang/assets/js/24.58c270f0.js"><link rel="prefetch" href="/mengqizhang/assets/js/25.413aed44.js"><link rel="prefetch" href="/mengqizhang/assets/js/26.5ebfde8b.js"><link rel="prefetch" href="/mengqizhang/assets/js/27.48dd442a.js"><link rel="prefetch" href="/mengqizhang/assets/js/28.d2afcf03.js"><link rel="prefetch" href="/mengqizhang/assets/js/29.b928e199.js"><link rel="prefetch" href="/mengqizhang/assets/js/3.7aafc190.js"><link rel="prefetch" href="/mengqizhang/assets/js/30.4c1cbe1a.js"><link rel="prefetch" href="/mengqizhang/assets/js/31.77073e2d.js"><link rel="prefetch" href="/mengqizhang/assets/js/32.5f66f7a2.js"><link rel="prefetch" href="/mengqizhang/assets/js/33.a8272e84.js"><link rel="prefetch" href="/mengqizhang/assets/js/34.3b8ea135.js"><link rel="prefetch" href="/mengqizhang/assets/js/35.100b34a0.js"><link rel="prefetch" href="/mengqizhang/assets/js/36.06cb633d.js"><link rel="prefetch" href="/mengqizhang/assets/js/37.f3d4b763.js"><link rel="prefetch" href="/mengqizhang/assets/js/38.733d311d.js"><link rel="prefetch" href="/mengqizhang/assets/js/39.8434909a.js"><link rel="prefetch" href="/mengqizhang/assets/js/4.000c3dbd.js"><link rel="prefetch" href="/mengqizhang/assets/js/40.dd341745.js"><link rel="prefetch" href="/mengqizhang/assets/js/41.1fcf309c.js"><link rel="prefetch" href="/mengqizhang/assets/js/42.1cc69bad.js"><link rel="prefetch" href="/mengqizhang/assets/js/43.fefa3ac7.js"><link rel="prefetch" href="/mengqizhang/assets/js/44.d284f8c1.js"><link rel="prefetch" href="/mengqizhang/assets/js/45.2564339d.js"><link rel="prefetch" href="/mengqizhang/assets/js/46.23627a8c.js"><link rel="prefetch" href="/mengqizhang/assets/js/47.cecbf290.js"><link rel="prefetch" href="/mengqizhang/assets/js/48.bad75ece.js"><link rel="prefetch" href="/mengqizhang/assets/js/49.2fa60a3e.js"><link rel="prefetch" href="/mengqizhang/assets/js/5.9832e234.js"><link rel="prefetch" href="/mengqizhang/assets/js/50.f3159852.js"><link rel="prefetch" href="/mengqizhang/assets/js/51.738bce4a.js"><link rel="prefetch" href="/mengqizhang/assets/js/52.efc0fa7e.js"><link rel="prefetch" href="/mengqizhang/assets/js/53.8d0c00f1.js"><link rel="prefetch" href="/mengqizhang/assets/js/54.a519e682.js"><link rel="prefetch" href="/mengqizhang/assets/js/55.9652e586.js"><link rel="prefetch" href="/mengqizhang/assets/js/56.c88f759b.js"><link rel="prefetch" href="/mengqizhang/assets/js/57.c6f3cd20.js"><link rel="prefetch" href="/mengqizhang/assets/js/58.0c040aca.js"><link rel="prefetch" href="/mengqizhang/assets/js/59.fc5ce388.js"><link rel="prefetch" href="/mengqizhang/assets/js/60.a50c0285.js"><link rel="prefetch" href="/mengqizhang/assets/js/61.ab6648f5.js"><link rel="prefetch" href="/mengqizhang/assets/js/62.f589c0b8.js"><link rel="prefetch" href="/mengqizhang/assets/js/63.df4a0587.js"><link rel="prefetch" href="/mengqizhang/assets/js/64.e5f1a0d6.js"><link rel="prefetch" href="/mengqizhang/assets/js/65.94e94ec2.js"><link rel="prefetch" href="/mengqizhang/assets/js/66.9a0f92dc.js"><link rel="prefetch" href="/mengqizhang/assets/js/67.15d5b718.js"><link rel="prefetch" href="/mengqizhang/assets/js/68.ca0d798d.js"><link rel="prefetch" href="/mengqizhang/assets/js/69.4de863fa.js"><link rel="prefetch" href="/mengqizhang/assets/js/7.2f8cbddd.js"><link rel="prefetch" href="/mengqizhang/assets/js/70.7c1bcd59.js"><link rel="prefetch" href="/mengqizhang/assets/js/71.70f3e9ec.js"><link rel="prefetch" href="/mengqizhang/assets/js/72.ca361407.js"><link rel="prefetch" href="/mengqizhang/assets/js/73.95c0b000.js"><link rel="prefetch" href="/mengqizhang/assets/js/74.673e240c.js"><link rel="prefetch" href="/mengqizhang/assets/js/75.f5cf8815.js"><link rel="prefetch" href="/mengqizhang/assets/js/76.30b8a8fb.js"><link rel="prefetch" href="/mengqizhang/assets/js/77.0bdfd82b.js"><link rel="prefetch" href="/mengqizhang/assets/js/78.a21a9dee.js"><link rel="prefetch" href="/mengqizhang/assets/js/79.5c55aff9.js"><link rel="prefetch" href="/mengqizhang/assets/js/8.507fce61.js"><link rel="prefetch" href="/mengqizhang/assets/js/80.aa70b0e8.js"><link rel="prefetch" href="/mengqizhang/assets/js/81.1cb55142.js"><link rel="prefetch" href="/mengqizhang/assets/js/82.50b720b1.js"><link rel="prefetch" href="/mengqizhang/assets/js/84.e2f1cab8.js"><link rel="prefetch" href="/mengqizhang/assets/js/85.c154565c.js"><link rel="prefetch" href="/mengqizhang/assets/js/86.c5dbbd95.js"><link rel="prefetch" href="/mengqizhang/assets/js/87.2b62cc5e.js"><link rel="prefetch" href="/mengqizhang/assets/js/88.5deb957d.js"><link rel="prefetch" href="/mengqizhang/assets/js/89.fbed7b0f.js"><link rel="prefetch" href="/mengqizhang/assets/js/9.70c1c418.js"><link rel="prefetch" href="/mengqizhang/assets/js/90.8efb35d5.js"><link rel="prefetch" href="/mengqizhang/assets/js/91.a3da2ba6.js"><link rel="prefetch" href="/mengqizhang/assets/js/92.1f9bf6c0.js"><link rel="prefetch" href="/mengqizhang/assets/js/93.862f4101.js"><link rel="prefetch" href="/mengqizhang/assets/js/94.1a0c5762.js"><link rel="prefetch" href="/mengqizhang/assets/js/95.6df0f77b.js"><link rel="prefetch" href="/mengqizhang/assets/js/96.90bef310.js"><link rel="prefetch" href="/mengqizhang/assets/js/97.fa2b5f10.js"><link rel="prefetch" href="/mengqizhang/assets/js/98.d84c6b84.js"><link rel="prefetch" href="/mengqizhang/assets/js/99.785b4a31.js">
    <link rel="stylesheet" href="/mengqizhang/assets/css/0.styles.a1d09170.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mengqizhang/" class="home-link router-link-active"><!----> <span class="site-name">蒙大拿</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mengqizhang/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://gitee.com/DemoMeng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mengqizhang/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://gitee.com/DemoMeng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试 📖🔥🔥</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/环境配置/" class="sidebar-heading clickable"><span>环境配置 🔧</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/消息队列/" class="sidebar-heading clickable"><span>消息队列 🔥🔥🔥</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/数据层/" class="sidebar-heading clickable open"><span>数据层 🔥🔥🔥</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>mybatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Redis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>redis基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mengqizhang/%E6%95%B0%E6%8D%AE%E5%B1%82/redis/" aria-current="page" class="sidebar-link">redis</a></li><li><a href="/mengqizhang/数据层/redis/redis6.0新特性.html" class="active sidebar-link">redis6新特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mengqizhang/数据层/redis/redis6.0新特性.html#ssl" class="sidebar-link">SSL</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/数据层/redis/redis6.0新特性.html#在resp2的基础上出了resp3协议" class="sidebar-link">在RESP2的基础上出了RESP3协议</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/数据层/redis/redis6.0新特性.html#客户端缓存" class="sidebar-link">客户端缓存</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/数据层/redis/redis6.0新特性.html#无盘副本" class="sidebar-link">无盘副本</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/数据层/redis/redis6.0新特性.html#更快的-rdb-加载、" class="sidebar-link">更快的 RDB 加载、</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/数据层/redis/redis6.0新特性.html#acl-访问权限控制" class="sidebar-link">ACL 访问权限控制</a></li><li class="sidebar-sub-header"><a href="/mengqizhang/数据层/redis/redis6.0新特性.html#多io线程" class="sidebar-link">多IO线程</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>redis配置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>redis高可用</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>redis应用场景</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/mengqizhang/容器化/" class="sidebar-heading clickable"><span>容器化 🐳</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java ☕️</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式事务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式系统 ☁️</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webSocket</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ELK 🔍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx 🇷🇺</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>jenkins 👴</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器 💰</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>测试 😓</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>监控告警</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis6-0新特性"><a href="#redis6-0新特性" class="header-anchor">#</a> redis6.0新特性</h1> <p>Redis 6.0（2021 年 10 月 GA）引入了
SSL、
新的 RESP3 协议、
ACL、
客户端缓存、
无盘副本、
I/O 线程、
更快的 RDB 加载、
新模块 API 以及更多改进。</p> <h2 id="ssl"><a href="#ssl" class="header-anchor">#</a> SSL</h2> <p>Redis 6连接支持SSL，更加安全。</p> <h2 id="在resp2的基础上出了resp3协议"><a href="#在resp2的基础上出了resp3协议" class="header-anchor">#</a> 在RESP2的基础上出了RESP3协议</h2> <ul><li>RESP （Redis Serialization Protocol） 是Redis服务端和客户端之间的通信协议。
Redis5使用的RESP2，Redis6.0在RESP2的基础上，开发出了RESP3。</li> <li>在 RESP2 中，所有的返回内容，都是一个字符串数组的形式，不管是 list 还是 sorted set。因此客户端需要自行去根据类型进行解读，增加了客户端实现的复杂性。</li></ul> <h2 id="客户端缓存"><a href="#客户端缓存" class="header-anchor">#</a> 客户端缓存</h2> <p>redis客户端将数据缓存在业务服务器中，实现快速读取数据</p> <h2 id="无盘副本"><a href="#无盘副本" class="header-anchor">#</a> 无盘副本</h2> <p>指的是在Redis主从模式下，Master不会将RDB文件文件存储到磁盘，会将RDB文件直接通过网络传输到slave中。如果服务器上的磁盘是普通的机械硬盘（磁盘读写效率低下）这种情况下，就能使用无磁盘复制的方式。
Redis主从模式下，RDB文件若没有配置使用的话则会立即删除， 参考repl-diskless-load disabled配置。
如果不使用无盘副本的配置，Master会将RDB文件存储到磁盘，随后才会吧RDB文件发送给从节点。有些磁盘是传统到机械硬盘，所以存在主从复制场景下效率低下的问题。</p> <p>配置文件配置，</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 大带宽，网速好可以使用scoket复制方式
# repl-diskless-sync no
# 延迟以秒为单位指定，默认为 5 秒。要完全禁用它，只需将其设置为 0 秒，传输将尽快开始。
# repl-diskless-sync-delay 5

# 在很多情况下，磁盘比网络慢，存储和加载 RDB 文件可能会增加复制时间，甚至增加主服务器的 Copy on Write 内存和从缓冲区
# &quot;disabled&quot;    - “禁用” - 不要使用无盘加载（先将 rdb 文件存储到磁盘）
# &quot;on-empty-db&quot; - 仅在完全安全的情况下才使用无盘加载。
# &quot;swapdb&quot;      - 在直接从socket字解析数据的同时，在 RAM 中保留当前数据库内容的副本。请注意，这需要足够的内存，如果没有，则可能会面临 OOM 杀死的风险。
# repl-diskless-load disabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="更快的-rdb-加载、"><a href="#更快的-rdb-加载、" class="header-anchor">#</a> 更快的 RDB 加载、</h2> <p>Redis 6.0，RDB 文件的加载速度比之前变得更快了。根据文件的实际组成（较大或较小的值），大概可以获得 20-30％ 的改进</p> <h2 id="acl-访问权限控制"><a href="#acl-访问权限控制" class="header-anchor">#</a> ACL 访问权限控制</h2> <ul><li><p>redis6.0之前只提供了设置密码来控制安全访问，而6.0之后采用了更颗粒度细化的权限访问控制。</p></li> <li><p>主要的命令</p></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>acl &lt;command&gt; args args ... 
    load              ：加载一个外部的acl文件
    save              ：保存acl文件
    list              ：查看所有acl用户，包含权限，状态等信息
    users             ：查看所有用户名
    setuser           ：创建用户
    getuser           ：获取用户
    deluser           ：删除用户
    cat               ：查看category类
    cat &lt;category&gt;    ：查看category类的命令
    genpass           ：随机生成一个密码
    whoami            : 查看当前的redis用户
    log               : 查看acl的日志
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li><p>auth mqz 123 : 切换用户为mqz</p></li> <li><p>登陆redis客户端 ：redis-cli -h 127.0.0.1 -p 6379 -a mengqizhang</p></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>root@4b69cb513dff:/data# redis-cli -h 127.0.0.1 -p 6379 -a mengqizhang
Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe.
127.0.0.1:6379&gt; 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>使用acl whoami 查看当前用户，默认用户是 'default' ，拥有redis的root权限</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>127.0.0.1:6379&gt; acl whoami
&quot;default&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>创建一个用户mqz设置密码123，并且设置拥有所有key的权限</li> <li>acl setuser mqz on &gt;123 +@all ~*</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>127.0.0.1:6379&gt; acl setuser mqz on &gt;123 +@all ~*
OK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>只赋予mqz只有set命令的权限</li> <li>acl setuser mqz -set</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>127.0.0.1:6379&gt; acl setuser mqz -set
OK
127.0.0.1:6379&gt; set key 1
(error) NOPERM this user has no permissions to run the 'set' command or its subcommand
127.0.0.1:6379&gt; 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><p>设置用户 normaluser 只能调用 Hash 类型的命令操作，而不能调用 String 类型的命令操作
ACL SETUSER normaluser +@hash -@string</p></li> <li><p>设置用户 normaluser 只能对以“user:”为前缀的 key 进行命令操作
ACL SETUSER normaluser ~user:* +@all</p></li> <li><p>acl支持粒度设置命令的操作访问权限</p></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>+&lt;command&gt; 将一个命令添加到用户可以调用的命令列表中
-&lt;command&gt; 将一个命令从用户可以调用的命令列表移除
+@&lt;category&gt; 将一类命令添加到用户可以调用的命令列表中
-@&lt;category&gt; 将一类命令从到用户可以调用的命令列表移除
+@all 允许用户调用所有命令操作
-@all 禁止用户调用所有命令操作
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>acl cat ： 查看 category</li> <li>category可以看作是acl的类资源</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>127.0.0.1:6379&gt; acl cat
 1) &quot;keyspace&quot;
 2) &quot;read&quot;
 3) &quot;write&quot;
 4) &quot;set&quot;
 5) &quot;sortedset&quot;
 6) &quot;list&quot;
 7) &quot;hash&quot;
 8) &quot;string&quot;
 9) &quot;bitmap&quot;
10) &quot;hyperloglog&quot;
11) &quot;geo&quot;
12) &quot;stream&quot;
13) &quot;pubsub&quot;
14) &quot;admin&quot;
15) &quot;fast&quot;
16) &quot;slow&quot;
17) &quot;blocking&quot;
18) &quot;dangerous&quot;
19) &quot;connection&quot;
20) &quot;transaction&quot;
21) &quot;scripting&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ul><li>acl cat category： 查看 category下的所有命令</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>127.0.0.1:6379&gt; acl cat set 
 1) &quot;smove&quot;
 2) &quot;sscan&quot;
 3) &quot;sinter&quot;
 4) &quot;srandmember&quot;
 5) &quot;sinterstore&quot;
 6) &quot;sunion&quot;
 7) &quot;scard&quot;
 8) &quot;sdiff&quot;
 9) &quot;srem&quot;
10) &quot;sdiffstore&quot;
11) &quot;spop&quot;
12) &quot;sadd&quot;
13) &quot;sort&quot;
14) &quot;sismember&quot;
15) &quot;sunionstore&quot;
16) &quot;smembers&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>acl cat 查看 危险的category</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>127.0.0.1:6379&gt; acl cat dangerous 
 1) &quot;flushdb&quot;
 2) &quot;bgrewriteaof&quot;
 3) &quot;swapdb&quot;
 4) &quot;sync&quot;
 5) &quot;slowlog&quot;
 6) &quot;info&quot;
 7) &quot;migrate&quot;
 8) &quot;role&quot;
 9) &quot;monitor&quot;
10) &quot;psync&quot;
11) &quot;restore-asking&quot;
12) &quot;bgsave&quot;
13) &quot;cluster&quot;
14) &quot;replconf&quot;
15) &quot;restore&quot;
16) &quot;config&quot;
17) &quot;replicaof&quot;
18) &quot;lastsave&quot;
19) &quot;flushall&quot;
20) &quot;acl&quot;
21) &quot;shutdown&quot;
22) &quot;pfdebug&quot;
23) &quot;debug&quot;
24) &quot;sort&quot;
25) &quot;slaveof&quot;
26) &quot;keys&quot;
27) &quot;client&quot;
28) &quot;latency&quot;
29) &quot;module&quot;
30) &quot;save&quot;
31) &quot;pfselftest&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ul><li>acl getuser mqz 查看用户所有的权限及信息</li> <li>用户支持多个密码！</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>127.0.0.1:6379&gt; auth mqz 123
OK
127.0.0.1:6379&gt; acl getuser mqz
1) &quot;flags&quot;
2) 1) &quot;on&quot;
   2) &quot;allkeys&quot;
3) &quot;passwords&quot;
4) 1) &quot;a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3&quot;
   2) &quot;d9b76e73f74e659b11b26e4fac3aaf3d9d4da1e7b5d3f354bc0b04016f013c20&quot;
   3) &quot;a32df4cf1279c8c1532ef759fbfd1ec7878dd7de07247c8c916f39ea32ec749c&quot;
5) &quot;commands&quot;
6) &quot;+@all -set&quot;
7) &quot;keys&quot;
8) 1) &quot;*&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>acl list查看用户列表及权限</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>127.0.0.1:6379&gt; acl list
1) &quot;user default on #5e5224113e437c4a9600eb4f7b7b2c2d96782493f390880549353221d91f973b ~* +@all&quot;
2) &quot;user mqz on #a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3 #d9b76e73f74e659b11b26e4fac3aaf3d9d4da1e7b5d3f354bc0b04016f013c20 #a32df4cf1279c8c1532ef759fbfd1ec7878dd7de07247c8c916f39ea32ec749c ~* +@all -set&quot;
3) &quot;user mqznotset off -@all&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>on: 启用用户
off:禁用用户，不能再使用该用户进行 AUTH 进行身份认证，若已经连接redis-cli的该用户仍然可以使用</p> <p>~：添加可以在命令中提及的键模式。例如~和 allkeys 允许所有键。</p> <blockquote><p>mypass : 会将该用户密码list添加一个mypass的密码
&lt;mypass : 会将该用户密码list移除一个mypass的密码</p></blockquote> <ul><li>acl log 记录拒绝的命令，密钥访问和身份验证</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>127.0.0.1:6379&gt; acl log
1)  1) &quot;count&quot;
    2) (integer) 1
    3) &quot;reason&quot;
    4) &quot;command&quot;
    5) &quot;context&quot;
    6) &quot;toplevel&quot;
    7) &quot;object&quot;
    8) &quot;set&quot;
    9) &quot;username&quot;
   10) &quot;mqz&quot;
   11) &quot;age-seconds&quot;
   12) &quot;3811.8359999999998&quot;
   13) &quot;client-info&quot;
   14) &quot;id=8 addr=127.0.0.1:38040 fd=10 name= age=186 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=29 qbuf-free=32739 argv-mem=7 obl=0 oll=0 omem=0 tot-mem=61471 events=r cmd=set user=mqz&quot;
2)  1) &quot;count&quot;
    2) (integer) 1
    3) &quot;reason&quot;
    4) &quot;auth&quot;
    5) &quot;context&quot;
    6) &quot;toplevel&quot;
    7) &quot;object&quot;
    8) &quot;auth&quot;
    9) &quot;username&quot;
   10) &quot;default&quot;
   11) &quot;age-seconds&quot;
   12) &quot;3858.8679999999999&quot;
   13) &quot;client-info&quot;
   14) &quot;id=8 addr=127.0.0.1:38040 fd=10 name= age=139 idle=1 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=29 qbuf-free=32739 argv-mem=13 obl=0 oll=0 omem=0 tot-mem=61469 events=r cmd=auth user=mqz&quot;
127.0.0.1:6379&gt; 

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><ul><li>acl 可以使用外部的 .acl 文件来配置用户权限，该文件内容和 acl list内容一致</li></ul> <p>acl deluser mqz 删除用户</p> <h2 id="多io线程"><a href="#多io线程" class="header-anchor">#</a> 多IO线程</h2> <ol><li><p>Redis4.0版本之前使用的是单线程模型，它的单线程指的是网络IO处理、get、set命令操作是由单个线程上完成的
但是Redis的持久化、集群同步还是使用其他线程、子线程（非主线程）完成的。</p></li> <li><p>Redis4.0之后加入了多线程的支持，主要还是体现再大数据的异步删除功能，比如：unlink key、flushdb async、fluashall async
AOF文件的重写（持久化方式之一） 都是在另外一个线程中执行的</p></li> <li><p>Redis6.0之前的网络IO处理都是单线程的操作，在6.0之后，将网络IO处理改为了多线程，get、set的命令操作还是保持单线程的。
因为Redis在处理请求的时候，网络处理经常是瓶颈，通过多个IO线程并行处理网络操作，可以提升Redis整体处理性能 （吞吐量提高）</p></li></ol> <ul><li>IO多线程机制在6.0版本的配置文件中是默认关闭的状态，若要开启网络IO多线程处理，需要手动打开，配置线程个数
官方建议： 4核的机器建议设置为2或3个线程，8核的建议设置为6个线程，线程数一定要小于机器核数。还需要注意的是，线程数并不是越大越好，官方认为超过了8个基本就没什么意义了。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>io-threads-do-reads no # on:开启 off：关闭
io-threads 4 # 配置多线程数量，需要根据服务器的实际硬件情况设置，一般来说不得大于cpu核数
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>主要流程</li></ul> <ol><li>建立连接、分配线程、解析请求 和 执行命令：</li> <li>回写Socket
<a data-fancybox="" title="111" href="网络IO流程A.png"><img src="%E7%BD%91%E7%BB%9CIO%E6%B5%81%E7%A8%8BA.png" alt="img.png"></a> <a data-fancybox="" title="111" href="网络IO流程1.png"><img src="%E7%BD%91%E7%BB%9CIO%E6%B5%81%E7%A8%8B1.png" alt="img.png"></a> <a data-fancybox="" title="111" href="网络IO流程2.png"><img src="%E7%BD%91%E7%BB%9CIO%E6%B5%81%E7%A8%8B2.png" alt="img.png"></a></li></ol> <div data-v-1f2b5245></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mengqizhang/%E6%95%B0%E6%8D%AE%E5%B1%82/redis/" class="prev router-link-active">
        redis
      </a></span> <span class="next"><a href="/mengqizhang/数据层/redis/redis-conf.html">
        redis配置文件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/mengqizhang/assets/js/app.a8d21a83.js" defer></script><script src="/mengqizhang/assets/js/2.e69c46bd.js" defer></script><script src="/mengqizhang/assets/js/83.85834849.js" defer></script><script src="/mengqizhang/assets/js/6.48810bdc.js" defer></script>
  </body>
</html>
